<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>「ElasticSearch」ES 任务管理机制和常见任务介绍</title>
    <link href="/2023/08/28/%E3%80%8CElasticSearch%E3%80%8DES%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6%E5%92%8C%E5%B8%B8%E8%A7%81%E4%BB%BB%E5%8A%A1%E4%BB%8B%E7%BB%8D/"/>
    <url>/2023/08/28/%E3%80%8CElasticSearch%E3%80%8DES%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6%E5%92%8C%E5%B8%B8%E8%A7%81%E4%BB%BB%E5%8A%A1%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>ES 里面会有一些长时间运行的任务(ES中所有请求都被看做是任务，无论是内部还是外部的请求)，为了管理这些任务，ES在5.0中引入了一个通用的任务管理机制。通过这个管理机制，我们可以方便的查看任务的运行状态、进度，甚至能进行一定的管理操作，比如取消。 该机制会提供一个 task management 的 API 来查看和获取当前在执行的所有任务，实现上会基于现有的 TransportAction 框架，这样就可以将所有的 transport action 请求都变成 task 进行管理。 还会提供父子关系的 Task 类型，主要是由协调节点触发的父任务和下发到其他节点的子任务组成。</p><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p>1、获取Tasks</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/_tasks/</span>&lt;task_id&gt;<br><br><span class="hljs-regexp">//</span>GET <span class="hljs-regexp">/_cat/</span>pending_tasks 用于获取在排队等待更新master节点state的任务，与本次分享task不一样<br></code></pre></td></tr></table></figure><p>命令参数</p><table><thead><tr><th>参数</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>timeout</td><td>请求超时时间，如果超时时间内没有响应，则请求失败并返回错误信息</td><td>30s</td></tr><tr><td>wait_for_completion</td><td>如果为true，则等待匹配的任务完成</td><td>false</td></tr><tr><td>nodes</td><td>逗号分隔的节点id或节点名等。检索指定节点的任务信息</td><td></td></tr><tr><td>parent_task_id</td><td>指定父任务id，检索其所有子任务信息</td><td></td></tr><tr><td>actions</td><td>指定任务功能，返回指定功能的任务信息。接受通配符表达式</td><td></td></tr><tr><td>detailed</td><td>如果为true，返回任务信息中会额外包括description任务描述信息</td><td>false</td></tr><tr><td>group_by</td><td>对返回结果进行分组，可选值为nodes(按节点分组) none(禁用分组) parents(按父任务分组)</td><td></td></tr><tr><td>nodes</td><td></td><td></td></tr></tbody></table><p>命令返回</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>  <span class="hljs-string">&quot;nodes&quot;</span> : &#123;<br>    <span class="hljs-string">&quot;_0tUFfY7TnmTtgnuuu-1vQ&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;name&quot;</span> : &quot;<span class="hljs-type">node1</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>transport_address<span class="hljs-string">&quot; : &quot;</span>xxx:<span class="hljs-number">28207</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>host<span class="hljs-string">&quot; : &quot;</span>xxx<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>ip<span class="hljs-string">&quot; : &quot;</span>xxx<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>roles<span class="hljs-string">&quot; : [</span><br><span class="hljs-string">        &quot;</span>data<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>data_cold<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>data_content<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>data_frozen<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>data_hot<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>data_warm<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>ingest<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>ml<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>remote_cluster_client<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>transform<span class="hljs-string">&quot;</span><br><span class="hljs-string">      ],</span><br><span class="hljs-string">      &quot;</span>attributes<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">        &quot;</span>ml.machine_memory<span class="hljs-string">&quot; : &quot;</span><span class="hljs-number">25165824000</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>ml.max_open_jobs<span class="hljs-string">&quot; : &quot;</span><span class="hljs-number">512</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>box_type<span class="hljs-string">&quot; : &quot;</span>cold<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>xpack.installed<span class="hljs-string">&quot; : &quot;</span><span class="hljs-literal">true</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>ml.max_jvm_size<span class="hljs-string">&quot; : &quot;</span><span class="hljs-number">19327352832</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>transform.node<span class="hljs-string">&quot; : &quot;</span><span class="hljs-literal">true</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">      &#125;,</span><br><span class="hljs-string">      &quot;</span>tasks<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">        &quot;</span>_0tUFfY7TnmTtgnuuu-<span class="hljs-number">1</span>vQ:<span class="hljs-number">403526893</span><span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span>node<span class="hljs-string">&quot; : &quot;</span>_0tUFfY7TnmTtgnuuu-<span class="hljs-number">1</span>vQ<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>id<span class="hljs-string">&quot; : 403526893,</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>transport<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>action<span class="hljs-string">&quot; : &quot;</span>cluster:monitor/tasks/lists[n]<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>start_time_in_millis<span class="hljs-string">&quot; : 1692017271538,</span><br><span class="hljs-string">          &quot;</span>running_time_in_nanos<span class="hljs-string">&quot; : 435359,</span><br><span class="hljs-string">          &quot;</span>cancellable<span class="hljs-string">&quot; : false,</span><br><span class="hljs-string">          &quot;</span>parent_task_id<span class="hljs-string">&quot; : &quot;</span>Qwlc397-TaWQZOma2vwU3g:<span class="hljs-number">296638302</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>headers<span class="hljs-string">&quot; : &#123; &#125;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>_0tUFfY7TnmTtgnuuu-<span class="hljs-number">1</span>vQ:<span class="hljs-number">403526847</span><span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span>node<span class="hljs-string">&quot; : &quot;</span>_0tUFfY7TnmTtgnuuu-<span class="hljs-number">1</span>vQ<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>id<span class="hljs-string">&quot; : 403526847,</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>transport<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>action<span class="hljs-string">&quot; : &quot;</span>indices:data/write/bulk[s][r]<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>start_time_in_millis<span class="hljs-string">&quot; : 1692017271460,</span><br><span class="hljs-string">          &quot;</span>running_time_in_nanos<span class="hljs-string">&quot; : 79076675,</span><br><span class="hljs-string">          &quot;</span>cancellable<span class="hljs-string">&quot; : false,</span><br><span class="hljs-string">          &quot;</span>parent_task_id<span class="hljs-string">&quot; : &quot;</span>jCFCnGK-SmWp7BSRGo6qpw:<span class="hljs-number">301696757</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>headers<span class="hljs-string">&quot; : &#123; &#125;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>node</td><td>节点id</td></tr><tr><td>id</td><td>任务编号</td></tr><tr><td>type</td><td>任务类型, transport、direct、persistent</td></tr><tr><td>action</td><td>任务功能</td></tr><tr><td>description</td><td>任务描述信息，detailed为true时返回</td></tr><tr><td>start_time_in_millis</td><td>任务开始时间</td></tr><tr><td>running_time_in_nanos</td><td>任务执行纳秒数</td></tr><tr><td>cancellable</td><td>任务是否支持取消操作</td></tr><tr><td>parent_task_id</td><td>父任务id</td></tr><tr><td>headers</td><td>头信息</td></tr><tr><td>取消任务</td><td></td></tr></tbody></table><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST <span class="hljs-regexp">/_tasks/</span>&lt;task_id&gt;/_cancel<br></code></pre></td></tr></table></figure><table class="drag-preview-element" style="min-width: 997px;">        <tbody>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="mqTXQTSb_">                    <div class="container-blocks">                        <div class="text-block" id="mZJ3lPsRL" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="r3L6QXc2S">                    <div class="container-blocks">                        <div class="text-block" id="rHSTkAkzf" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">action</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="rASUHJLiJ">                    <div class="container-blocks">                        <div class="text-block" id="ruj2IQMDc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">说明</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sJVhmLDFN">                    <div class="container-blocks">                        <div class="text-block" id="szBKGERR1" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">备注</span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="s2nfimxvr">                    <div class="container-blocks">                        <div class="text-block" id="sgbgF51SK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">1</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sEsisoCR2">                    <div class="container-blocks">                        <div class="text-block" id="sequSAVHa" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/allocation/explain</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sM3wPOrwV">                    <div class="container-blocks">                        <div class="text-block" id="s5SkXybAc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">用于获取集群中shard分配相关的信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sNkxoGl4R">                    <div class="container-blocks">                        <div class="text-block" id="sci25MTUi" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="tmWCSojWZ">                    <div class="container-blocks">                        <div class="text-block" id="t9RSDTTPu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">2</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="taTeHsq5B">                    <div class="container-blocks">                        <div class="text-block" id="tUMs4k8NH" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/voting_config/add_exclusions</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="te1G07kp_">                    <div class="container-blocks">                        <div class="text-block" id="t4cREoPoP" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">用于对集群投票配置添加排除点</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="uCSH2s77I">                    <div class="container-blocks">                        <div class="text-block" id="uiWiQry7P" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="ghXAisJjh">                    <div class="container-blocks">                        <div class="text-block" id="gJF5Ie9P0" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">3</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gZRhcgVu9">                    <div class="container-blocks">                        <div class="text-block" id="g1bvt37nG" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/voting_config/clear_exclusions</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gl8PjCgfk">                    <div class="container-blocks">                        <div class="text-block" id="g991v_XOs" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">用于清空集群投票排除点</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="hwvIsA0n6">                    <div class="container-blocks">                        <div class="text-block" id="h9GE1NZWU" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Q0hO7ehuz">                    <div class="container-blocks">                        <div class="text-block" id="Q71zvABEV" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">4</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Ry2tBqeck">                    <div class="container-blocks">                        <div class="text-block" id="RrdT8T6Ac" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/health</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="RWGHxHnpB">                    <div class="container-blocks">                        <div class="text-block" id="Rd7fGzTLy" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群状态</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ReKDJHpZa">                    <div class="container-blocks">                        <div class="text-block" id="RdUf9Qfpq" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="yd3SWq1Ya">                    <div class="container-blocks">                        <div class="text-block" id="yIRo7rULF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">5</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ARuDjVpYz">                    <div class="container-blocks">                        <div class="text-block" id="AzjTebb31" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/migration/get_system_feature</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="APy5bDxAb">                    <div class="container-blocks">                        <div class="text-block" id="AlaPi7V2F" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群迁移相关的信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BXTsTOOY3">                    <div class="container-blocks">                        <div class="text-block" id="BEb8chVsr" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="kIbNkeLtG">                    <div class="container-blocks">                        <div class="text-block" id="kM5NPz6Sg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">6</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="pwyv8OaXJ">                    <div class="container-blocks">                        <div class="text-block" id="prwu5bNfd" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/nodes/hot_threads</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="rpGjvPXKr">                    <div class="container-blocks">                        <div class="text-block" id="rQvR_gusn" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群hot线程</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="s6K6qTpCr">                    <div class="container-blocks">                        <div class="text-block" id="sqgW_8skD" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Xp3n1UIa7">                    <div class="container-blocks">                        <div class="text-block" id="XaGl4VY_A" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">7</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cJpyzuhLe">                    <div class="container-blocks">                        <div class="text-block" id="c9SiBgyVf" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/nodes/info</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cyHreCrZI">                    <div class="container-blocks">                        <div class="text-block" id="cw6o3sxfO" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群节点信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="czBCYh4nf">                    <div class="container-blocks">                        <div class="text-block" id="csNzbP1zv" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="HFtcyxjZ3">                    <div class="container-blocks">                        <div class="text-block" id="HpOgtvzKm" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">8</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="L7VhRYQ7u">                    <div class="container-blocks">                        <div class="text-block" id="LnUetraYT" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/nodes/reload_secure_settings</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LWTUNfHr0">                    <div class="container-blocks">                        <div class="text-block" id="LoXGR9Cc9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">reload权限设置</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LwY1GG2pQ">                    <div class="container-blocks">                        <div class="text-block" id="LcszYdAO3" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Elg2Of69B">                    <div class="container-blocks">                        <div class="text-block" id="Eqnb5s4j2" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">9</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KlVR0blVc">                    <div class="container-blocks">                        <div class="text-block" id="KzOZr2Wm0" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/nodes/stats</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LkOapqWXs">                    <div class="container-blocks">                        <div class="text-block" id="LCqYz1fLh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群状态信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LPhkaLwVB">                    <div class="container-blocks">                        <div class="text-block" id="LV74wahou" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="NQmImAudC">                    <div class="container-blocks">                        <div class="text-block" id="NCJaekaS4" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">10</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NGGouwOaS">                    <div class="container-blocks">                        <div class="text-block" id="NZmKbgu8a" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/tasks/cancel</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="N54JuWE4y">                    <div class="container-blocks">                        <div class="text-block" id="NtfJ5Onvd" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">取消task</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NjRUotN7L">                    <div class="container-blocks">                        <div class="text-block" id="N_iZ_AjcW" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="viSSxpnth">                    <div class="container-blocks">                        <div class="text-block" id="v12xf4Xld" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">11</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="vsa0W4NPz">                    <div class="container-blocks">                        <div class="text-block" id="v3BMb4UYg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/task/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="v61Z7MQor">                    <div class="container-blocks">                        <div class="text-block" id="v1KRnxrCZ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取指定task</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="vNbe02P1I">                    <div class="container-blocks">                        <div class="text-block" id="vEzwoikhh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="fOioJ67fn">                    <div class="container-blocks">                        <div class="text-block" id="fMUMIpzM9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">12</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="fCyPOFl2M">                    <div class="container-blocks">                        <div class="text-block" id="fQDchLIXc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/tasks/lists</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="fW9p0UHrk">                    <div class="container-blocks">                        <div class="text-block" id="fQg78xeKK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取全部task</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gfxa3AXOl">                    <div class="container-blocks">                        <div class="text-block" id="gtLhL8DOK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="MTawzl0OZ">                    <div class="container-blocks">                        <div class="text-block" id="MpEgzxWfk" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">13</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="MRyhNy5wg">                    <div class="container-blocks">                        <div class="text-block" id="MqXi8Mr0O" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/nodes/usage</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NrDYtO6v6">                    <div class="container-blocks">                        <div class="text-block" id="NPIv2LZsO" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取节点使用情况</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NyCXS9P_i">                    <div class="container-blocks">                        <div class="text-block" id="N82SJO4ry" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="vJhTEKrTv">                    <div class="container-blocks">                        <div class="text-block" id="vLPqdOFI3" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">14</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="vbCekjILz">                    <div class="container-blocks">                        <div class="text-block" id="v32Z98klN" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/remote/info</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="vvH5_05l3">                    <div class="container-blocks">                        <div class="text-block" id="vmWquUzTK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取远程节点信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="wBEZ8PMr2">                    <div class="container-blocks">                        <div class="text-block" id="wkS41I0_D" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="PhG3J_tDi">                    <div class="container-blocks">                        <div class="text-block" id="PrXKDQKR7" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">15</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Pi0nhw_lu">                    <div class="container-blocks">                        <div class="text-block hover" id="P8iI4rrPQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/repository/_cleanup</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="P5zEDhl3b">                    <div class="container-blocks">                        <div class="text-block" id="P5TcIoYCh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">清空reposity(快照相关)</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="QwMaigC3T">                    <div class="container-blocks">                        <div class="text-block" id="QuewibfU2" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="hADNrR3Nw">                    <div class="container-blocks">                        <div class="text-block" id="haRYgjthg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">16</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ilpb1KdxB">                    <div class="container-blocks">                        <div class="text-block" id="irPNIaOmC" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/repository/delete</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="iuy3O9qJr">                    <div class="container-blocks">                        <div class="text-block" id="isQVd6wGl" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除reposity</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="miZB5uvM8">                    <div class="container-blocks">                        <div class="text-block" id="m_CCNovXW" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="TkrqaRIPV">                    <div class="container-blocks">                        <div class="text-block" id="TW2q7fUMw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">17</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="TQIYZhJUS">                    <div class="container-blocks">                        <div class="text-block" id="TwxSgtFL_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/repository/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="TsVIye1NQ">                    <div class="container-blocks">                        <div class="text-block" id="TV4ObjESF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取reposity</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ZZuFLGMOm">                    <div class="container-blocks">                        <div class="text-block" id="ZHfTtuvme" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="vf1DdWCPH">                    <div class="container-blocks">                        <div class="text-block" id="vo22h9j_u" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">18</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ASFXVgNwM">                    <div class="container-blocks">                        <div class="text-block" id="AiLIVvR3q" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/repository/put</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="AWgBBSEas">                    <div class="container-blocks">                        <div class="text-block" id="AteWgxl5Z" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">添加reposity</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BtQpTJihg">                    <div class="container-blocks">                        <div class="text-block" id="Bus6RxU86" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="OYUUaJRMS">                    <div class="container-blocks">                        <div class="text-block" id="OxdqoWtPb" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">19</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="TQQFJpoQP">                    <div class="container-blocks">                        <div class="text-block" id="TXknKA3Iv" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/repository/verify</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="TMLVeXxVj">                    <div class="container-blocks">                        <div class="text-block" id="TIrA_ZQ3D" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">验证reposity</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="UrZysYTx5">                    <div class="container-blocks">                        <div class="text-block" id="UOSKw2UlB" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="ZUAlfjoPZ">                    <div class="container-blocks">                        <div class="text-block" id="ZRyHSwUSq" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">20</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="atlucpQqM">                    <div class="container-blocks">                        <div class="text-block" id="ahELuKBaf" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/reroute</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="aaxVEgiOl">                    <div class="container-blocks">                        <div class="text-block" id="a2DO_tkYa" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">分配分片</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="b47KejpdC">                    <div class="container-blocks">                        <div class="text-block" id="bywoHmKqx" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="iZAvp7tnw">                    <div class="container-blocks">                        <div class="text-block" id="idOOyXh6G" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">21</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="oTG0f3wcj">                    <div class="container-blocks">                        <div class="text-block" id="oUAdsQHA0" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/settings/update</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ooHdvjgaR">                    <div class="container-blocks">                        <div class="text-block" id="oCad5BYF9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">更新设置</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="p9FRj6SnX">                    <div class="container-blocks">                        <div class="text-block" id="pdid78bKi" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="nXKK1XDu8">                    <div class="container-blocks">                        <div class="text-block" id="naJmYVGYQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">22</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="UDFi3ICq2">                    <div class="container-blocks">                        <div class="text-block" id="UpbKfcBj5" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/shards/search_shards</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Y3DPIwiEB">                    <div class="container-blocks">                        <div class="text-block" id="YlAD31Y5X" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">查询分片</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ZFph99moR">                    <div class="container-blocks">                        <div class="text-block" id="ZjhZmjvsU" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="UL5Eg5GD1">                    <div class="container-blocks">                        <div class="text-block" id="TbH6xfCJK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">23</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="UkpOPz3Mw">                    <div class="container-blocks">                        <div class="text-block" id="UF7NwiXNa" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/snapshot/clone</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="VM74z11VK">                    <div class="container-blocks">                        <div class="text-block" id="V2t4u6QL8" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">克隆快照</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="WgM9nLiSO">                    <div class="container-blocks">                        <div class="text-block" id="WUDIy5LaS" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="JYHyc4nGQ">                    <div class="container-blocks">                        <div class="text-block" id="Jqx32l0lO" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">24</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Kf3KrF0eS">                    <div class="container-blocks">                        <div class="text-block" id="KbUh6nMVg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/snapshot/create</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="K7IOyoTZA">                    <div class="container-blocks">                        <div class="text-block" id="KYeN76LKA" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">创建快照</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="L8L_ZM6Jq">                    <div class="container-blocks">                        <div class="text-block" id="L8Wda5xUF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="uA_ltH0f_">                    <div class="container-blocks">                        <div class="text-block" id="uStev8cD7" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">25</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="utLf_8sb8">                    <div class="container-blocks">                        <div class="text-block" id="uUUKVUHoY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/snapshot/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="wN1SxDE5T">                    <div class="container-blocks">                        <div class="text-block" id="wzMNq4umj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除快照</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="x1JVN3Sni">                    <div class="container-blocks">                        <div class="text-block" id="x0_7v5EZx" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="AOAdTRrtn">                    <div class="container-blocks">                        <div class="text-block" id="A0ESDTu6W" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">26</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Aaw5CmSP3">                    <div class="container-blocks">                        <div class="text-block" id="Aektlwc2Z" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/features/reset</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BaU4cnNTu">                    <div class="container-blocks">                        <div class="text-block" id="BbAQygPgH" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">清除存储在系统索引中的所有状态信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="CCPs5rDaP">                    <div class="container-blocks">                        <div class="text-block" id="CQWxDtgVT" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="V2njB01vM">                    <div class="container-blocks">                        <div class="text-block" id="V8neL37Ti" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">27</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ar8mwjrGx">                    <div class="container-blocks">                        <div class="text-block" id="a6i0uEb9J" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">internal:admin/snapshot/get_shard</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="e30gO9Uow">                    <div class="container-blocks">                        <div class="text-block" id="eN4qvXTT9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取分片快照</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="eqfdxuA9T">                    <div class="container-blocks">                        <div class="text-block" id="ejrWfSSba" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="wt2cxw3rG">                    <div class="container-blocks">                        <div class="text-block" id="wlPrnRhNT" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">28</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="xv5qMcZ4R">                    <div class="container-blocks">                        <div class="text-block" id="xHaEWsPP_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/snapshot/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="y7IMFmqvS">                    <div class="container-blocks">                        <div class="text-block" id="ysnQBktAj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取快照</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="z7DcjMdzO">                    <div class="container-blocks">                        <div class="text-block" id="z3gKJcaYZ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="TPTT4SU3F">                    <div class="container-blocks">                        <div class="text-block" id="TU4Dh_iEz" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">29</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ZBtJdTix5">                    <div class="container-blocks">                        <div class="text-block" id="ZzNver1cE" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/snapshot/restore</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="au2fghORQ">                    <div class="container-blocks">                        <div class="text-block" id="al11qSFn1" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">还原快照数据</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="abeuomUZZ">                    <div class="container-blocks">                        <div class="text-block" id="aJzezGOHF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="deX449tZH">                    <div class="container-blocks">                        <div class="text-block" id="dGnKzL5Xg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">30</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="dp4PHiDIo">                    <div class="container-blocks">                        <div class="text-block" id="dNPDVet96" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/snapshot/status</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ei4yVRZA0">                    <div class="container-blocks">                        <div class="text-block" id="ePeS0olXb" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取快照状态</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="eoH11h3sS">                    <div class="container-blocks">                        <div class="text-block" id="efVJTdBK5" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="yJWnJlmqw">                    <div class="container-blocks">                        <div class="text-block" id="yrnRrBMZa" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">31</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="yd0VRJALx">                    <div class="container-blocks">                        <div class="text-block" id="yw6JoITYb" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/state</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zpT9qQSBL">                    <div class="container-blocks">                        <div class="text-block" id="z39keGuJG" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群state信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zmp0o17xr">                    <div class="container-blocks">                        <div class="text-block" id="zdwhtmJ5n" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="U_8DrVtyR">                    <div class="container-blocks">                        <div class="text-block" id="UEw2gnIJx" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">32</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="V4xJJJEBL">                    <div class="container-blocks">                        <div class="text-block" id="VvV9LHHu9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/stats</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="WAh_sfj0T">                    <div class="container-blocks">                        <div class="text-block" id="W6ijGFaj4" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群状态信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="XdJX9woxz">                    <div class="container-blocks">                        <div class="text-block" id="XuD43UpsN" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="ikmWJp4kY">                    <div class="container-blocks">                        <div class="text-block" id="iMlLRo00E" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">33</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="jPcs35g_T">                    <div class="container-blocks">                        <div class="text-block" id="jT1X2YKVH" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/script/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="jO2uxU0lr">                    <div class="container-blocks">                        <div class="text-block" id="jl7sa_XuV" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除脚本</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="jDlBa3Uz0">                    <div class="container-blocks">                        <div class="text-block" id="j0hFt4th2" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="bFjdagQ8H">                    <div class="container-blocks">                        <div class="text-block" id="bN4Nj0Ulq" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">34</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cNw_27jog">                    <div class="container-blocks">                        <div class="text-block" id="cibSeOgLE" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/script_context/get</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="clhGvCG4x">                    <div class="container-blocks">                        <div class="text-block" id="c5lAfp6OB" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取脚本内容</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cXqil9mOn">                    <div class="container-blocks">                        <div class="text-block" id="c4OHiRG6s" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="E4LSKT6mB">                    <div class="container-blocks">                        <div class="text-block" id="EzfwD9AFg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">35</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Jfd4XuRHl">                    <div class="container-blocks">                        <div class="text-block" id="JTTIh_p5y" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/script_language/get</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KCGhC3Iwz">                    <div class="container-blocks">                        <div class="text-block" id="Ko1zUsyRw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取脚本语言</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LaDi6RYA4">                    <div class="container-blocks">                        <div class="text-block" id="LLEhW1vpk" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="RYxRICHZm">                    <div class="container-blocks">                        <div class="text-block" id="RAeJuIOXy" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">36</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="SXqXJk9xZ">                    <div class="container-blocks">                        <div class="text-block" id="SPUtnq5YH" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/script/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="S_2V7P9h5">                    <div class="container-blocks">                        <div class="text-block" id="SK9EcJ6AX" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取脚本</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="S2yGK41A0">                    <div class="container-blocks">                        <div class="text-block" id="Ssqghj1wY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="q8QFoBKpK">                    <div class="container-blocks">                        <div class="text-block" id="q1JLGYEst" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">37</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="rs8IC4BBm">                    <div class="container-blocks">                        <div class="text-block" id="rraZkn7Aq" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/script/put</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sEeosK48N">                    <div class="container-blocks">                        <div class="text-block" id="sDPFuDHzs" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">提交脚本</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sARYWFeJY">                    <div class="container-blocks">                        <div class="text-block" id="sdAMmPy4L" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="eQgdMEqPZ">                    <div class="container-blocks">                        <div class="text-block" id="eV6pewdyQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">38</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ftNj2HLo0">                    <div class="container-blocks">                        <div class="text-block" id="fYHgh9fLI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/task</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="fhqIdtJ68">                    <div class="container-blocks">                        <div class="text-block" id="fPbReGiMx" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取task信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="f_SRz4zWy">                    <div class="container-blocks">                        <div class="text-block" id="ft2INwFTd" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="MPvElfZ0S">                    <div class="container-blocks">                        <div class="text-block" id="MI0LIMSZz" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">39</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="MzKCp5hoa">                    <div class="container-blocks">                        <div class="text-block" id="MjJl0WmO5" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/aliases/exists</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Nq5hRb3Zr">                    <div class="container-blocks">                        <div class="text-block" id="NRtlnWdP9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">别名是否存在</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NcAZHzgmr">                    <div class="container-blocks">                        <div class="text-block" id="N5PlRtoRw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="DxX9bsaXM">                    <div class="container-blocks">                        <div class="text-block" id="DM_B_ju2K" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">40</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="E_WX5B7zW">                    <div class="container-blocks">                        <div class="text-block" id="E2mjrDRYw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/aliases/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="F8oUCxxV_">                    <div class="container-blocks">                        <div class="text-block" id="FFq64g4EM" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">过去别名</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="FoXtFbiMT">                    <div class="container-blocks">                        <div class="text-block" id="FCxw_awZD" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="PzHxUWiU2">                    <div class="container-blocks">                        <div class="text-block" id="P7_bPPBpY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">41</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="PSADgks_p">                    <div class="container-blocks">                        <div class="text-block" id="PZXA8VSRF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/aliases</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="POzBRuZ5m">                    <div class="container-blocks">                        <div class="text-block" id="PwHDnMLRj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取全部别名</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="RfEV1EOOS">                    <div class="container-blocks">                        <div class="text-block" id="RDAEHLu5y" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Uu0AEA76S">                    <div class="container-blocks">                        <div class="text-block" id="UjmeCB1N3" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">42</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="U7eG3Bspb">                    <div class="container-blocks">                        <div class="text-block" id="UPx3HAlLO" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/analyze</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Ui7Rv1kCX">                    <div class="container-blocks">                        <div class="text-block" id="UoCwgco15" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">预处理数据</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Vx7Z6zoHE">                    <div class="container-blocks">                        <div class="text-block" id="VbvBpBNFD" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="WjMqQj7zu">                    <div class="container-blocks">                        <div class="text-block" id="WUNQxl03Q" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">43</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Xg1QpQcBC">                    <div class="container-blocks">                        <div class="text-block" id="X8qpL0oxv" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/cache/clear</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="YcMX3oaj6">                    <div class="container-blocks">                        <div class="text-block" id="YNrtzZL2r" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">清楚缓存</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="YGQwGAGCM">                    <div class="container-blocks">                        <div class="text-block" id="YRUnZHNMY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="GZS24ZaMV">                    <div class="container-blocks">                        <div class="text-block" id="GJfBlNJSL" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">44</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="I6lc_V1up">                    <div class="container-blocks">                        <div class="text-block" id="IPq_a63oX" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/close</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="If1W3f1PT">                    <div class="container-blocks">                        <div class="text-block" id="IFpSjgFdA" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">关闭index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="IxVvN7OC7">                    <div class="container-blocks">                        <div class="text-block" id="IC6EEy4Rj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="LCegJTQqF">                    <div class="container-blocks">                        <div class="text-block" id="LGJmtHPGl" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">45</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="RGoVrnfyY">                    <div class="container-blocks">                        <div class="text-block" id="RI6wpjtU1" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/auto_create</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="RMr7B1v6B">                    <div class="container-blocks">                        <div class="text-block" id="RrWyIaGv9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">创建index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="SgmUd0TCk">                    <div class="container-blocks">                        <div class="text-block" id="SW2kDahNS" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="wEk74LRdA">                    <div class="container-blocks">                        <div class="text-block" id="w2hn95jWy" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">46</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="wKBk4i4ii">                    <div class="container-blocks">                        <div class="text-block" id="wg88ogzm2" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/create</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="w4JV3mM2R">                    <div class="container-blocks">                        <div class="text-block" id="wMH1CXN7I" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">创建index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="xY5gfvmJl">                    <div class="container-blocks">                        <div class="text-block" id="xD_8CEvGJ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="w9FNUDRmG">                    <div class="container-blocks">                        <div class="text-block" id="w3rKlwZmf" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">47</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="yzo92Td8m">                    <div class="container-blocks">                        <div class="text-block" id="xlXoklYJO" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/indices/dangling/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zOdv2WdD5">                    <div class="container-blocks">                        <div class="text-block" id="zr3UkEQGh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除daangline索引</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zt2aMuSK9">                    <div class="container-blocks">                        <div class="text-block" id="z7cN77sjc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">在本地存在，但是在集群中尚未存在的index， 称为dangline</span>                            </div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="wJAyey1PY">                    <div class="container-blocks">                        <div class="text-block" id="wtRenjK1b" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">48</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="B_xxWoMvE">                    <div class="container-blocks">                        <div class="text-block" id="AQV3ScKdo" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/indices/dangling/find</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BL5sDt_Xf">                    <div class="container-blocks">                        <div class="text-block" id="BmSvoL9Dy" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">查找dangline索引</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BRTP1AQPz">                    <div class="container-blocks">                        <div class="text-block" id="B3CrZiC3_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="hrSTsqFqw">                    <div class="container-blocks">                        <div class="text-block" id="h29S4RXb4" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">49</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="lXE9aSueC">                    <div class="container-blocks">                        <div class="text-block" id="lTByoUE5F" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/indices/dangling/import</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="l680K4QDz">                    <div class="container-blocks">                        <div class="text-block" id="lhSMwyT3E" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">导入dangline索引</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="l9NVIAPAt">                    <div class="container-blocks">                        <div class="text-block" id="lVAhJMQmI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="BxuReX_yP">                    <div class="container-blocks">                        <div class="text-block" id="BzfZbEEY4" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">50</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Bo6F_2k78">                    <div class="container-blocks">                        <div class="text-block" id="BoB4qiKKA" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/indices/dangling/list</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="CNMXHdy8_">                    <div class="container-blocks">                        <div class="text-block" id="CCGt8TRIs" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">列出dangline索引</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Cv1eKaUG0">                    <div class="container-blocks">                        <div class="text-block" id="CV2B31NIF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="tVVBDk1Wq">                    <div class="container-blocks">                        <div class="text-block" id="t8HoHkQzj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">51</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="xdB1sOy5k">                    <div class="container-blocks">                        <div class="text-block" id="xlLfXqZ_b" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="yHzTnAzve">                    <div class="container-blocks">                        <div class="text-block" id="y9ILIN7Tx" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zNWnJUos_">                    <div class="container-blocks">                        <div class="text-block" id="zmT9yGV3J" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="eKcY_4sC6">                    <div class="container-blocks">                        <div class="text-block" id="dYgyMq3wc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">52</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="igLN1P_cr">                    <div class="container-blocks">                        <div class="text-block" id="id8H2UQPj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/analyze_disk_usage</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="k5Y7_lG0G">                    <div class="container-blocks">                        <div class="text-block" id="kaq6Kv8Gh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">分析磁盘使用率</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="lwEw3kBRl">                    <div class="container-blocks">                        <div class="text-block" id="lmWOsyPKI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="eYOLrCSnl">                    <div class="container-blocks">                        <div class="text-block" id="em04EgBo6" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">53</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="eXhGiBfD4">                    <div class="container-blocks">                        <div class="text-block" id="eVsuSVMJz" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/exists</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="fWmHgxkfw">                    <div class="container-blocks">                        <div class="text-block" id="frXVyBzk6" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">index是否存在</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="f4DgR8AtW">                    <div class="container-blocks">                        <div class="text-block" id="fWg5MemAy" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="lXsxmlOgw">                    <div class="container-blocks">                        <div class="text-block" id="lkwtIXxWr" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">54</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ln9C4rn6f">                    <div class="container-blocks">                        <div class="text-block" id="luaSMg1vn" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/types/exists</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="nGCjM9bEN">                    <div class="container-blocks">                        <div class="text-block" id="nghbS4eyB" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">type是否存在</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="oRBxDAYnf">                    <div class="container-blocks">                        <div class="text-block" id="oPlzq2jBl" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="P5Oz6eQ2N">                    <div class="container-blocks">                        <div class="text-block" id="Px5q20dCJ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">55</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Q4T8LKpPM">                    <div class="container-blocks">                        <div class="text-block" id="KhV96XciT" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/flush</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="QdwfOGsZw">                    <div class="container-blocks">                        <div class="text-block" id="QxjQFZVLl" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">将page cache中的数据刷新到磁盘上</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Q2U1YfP8i">                    <div class="container-blocks">                        <div class="text-block" id="Qh53MTjRP" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="ua6DqKtAu">                    <div class="container-blocks">                        <div class="text-block" id="u9UeR3ApC" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">56</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="vI5N9oXsO">                    <div class="container-blocks">                        <div class="text-block" id="vINrHA1g9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/synced_flush</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="vLeSht5v2">                    <div class="container-blocks">                        <div class="text-block" id="v7pi3VThd" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">异步刷盘</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="vOQ3W2Sf0">                    <div class="container-blocks">                        <div class="text-block" id="vF61w2lm8" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="MtBizCzPG">                    <div class="container-blocks">                        <div class="text-block" id="MuQvD0DXa" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">57</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="McS4RQZip">                    <div class="container-blocks">                        <div class="text-block" id="MMlrCbJAm" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/forcemerge</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ODyztHuFC">                    <div class="container-blocks">                        <div class="text-block" id="O_h_kghqM" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">全部segment合并</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="OEeh2E3pG">                    <div class="container-blocks">                        <div class="text-block" id="Okd7RgAwh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="mirJIT9s2">                    <div class="container-blocks">                        <div class="text-block" id="mLlomxCGI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">58</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qqhDnITaQ">                    <div class="container-blocks">                        <div class="text-block" id="qH9w_r7vr" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="rL1deVoEn">                    <div class="container-blocks">                        <div class="text-block" id="rvRTBH01Y" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">过去index信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="rs3nd5J4V">                    <div class="container-blocks">                        <div class="text-block" id="rQoIQQGpy" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="wcnVzQnmC">                    <div class="container-blocks">                        <div class="text-block" id="wlHiEzx67" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">59</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="w9TYXUIqN">                    <div class="container-blocks">                        <div class="text-block" id="waW5Lpzbl" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/mappings/fields/get</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="xyJsutnCY">                    <div class="container-blocks">                        <div class="text-block" id="xV2Yq2RBD" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取字段信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="xKs0jOAGO">                    <div class="container-blocks">                        <div class="text-block" id="xvf238OdA" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="gAeLuhyVZ">                    <div class="container-blocks">                        <div class="text-block" id="gQhF8fkmd" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">60</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="hMjIzgORt">                    <div class="container-blocks">                        <div class="text-block" id="hsyov40wF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/mappings/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="hgJXPvLa2">                    <div class="container-blocks">                        <div class="text-block" id="hRL2GI_uB" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取mapping信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ijZRJTAWW">                    <div class="container-blocks">                        <div class="text-block" id="igerggC9c" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="CEciPw3HU">                    <div class="container-blocks">                        <div class="text-block" id="CxLa51EtP" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">61</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="C3PYJ_jFg">                    <div class="container-blocks">                        <div class="text-block" id="Cah_xYg4D" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/mapping/auto_put</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Dw3nTjl5M">                    <div class="container-blocks">                        <div class="text-block" id="D6JUF7ay3" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">自动生成mapping</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="DgPQJ2A9O">                    <div class="container-blocks">                        <div class="text-block" id="DenGDzT1C" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="m7JLqZnKn">                    <div class="container-blocks">                        <div class="text-block" id="mms30Fdad" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">62</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="pyWdWiCib">                    <div class="container-blocks">                        <div class="text-block" id="pCOXdnfUj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/open</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qQDXkJttX">                    <div class="container-blocks">                        <div class="text-block" id="qUFmfW01S" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">打开index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qjpTRTIh0">                    <div class="container-blocks">                        <div class="text-block" id="qYGFIFKaF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="ecFVeoeWs">                    <div class="container-blocks">                        <div class="text-block" id="ebluQe51w" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">63</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="hJVpwDihr">                    <div class="container-blocks">                        <div class="text-block" id="heSHQvO7x" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/block/add</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="iDbTo8DN9">                    <div class="container-blocks">                        <div class="text-block" id="iaH4LBrMe" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">state中添加块</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="jVFig9mb5">                    <div class="container-blocks">                        <div class="text-block" id="jnQruYuqd" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="MfC7tHMuO">                    <div class="container-blocks">                        <div class="text-block" id="MDwuv1qS7" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">64</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Pbs1TQWCy">                    <div class="container-blocks">                        <div class="text-block" id="PQcgSChNQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:monitor/recovery</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="QZKMMnOkb">                    <div class="container-blocks">                        <div class="text-block" id="QTHN42nie" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">恢复数据</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Q9V3hLJUO">                    <div class="container-blocks">                        <div class="text-block" id="QZUmIW22Q" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="prjMylyPU">                    <div class="container-blocks">                        <div class="text-block" id="pOJUMj8KZ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">65</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="pI7VLtaF7">                    <div class="container-blocks">                        <div class="text-block" id="pfxJglibm" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/refresh</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qV5lP2U6I">                    <div class="container-blocks">                        <div class="text-block" id="qaUBoJ6OA" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">将内存中的数据刷新到page cache</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qh9yWIuqo">                    <div class="container-blocks">                        <div class="text-block" id="q64ov9Aiw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="J3k20hNg8">                    <div class="container-blocks">                        <div class="text-block" id="JCiYrii1_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">66</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KxCVid5kb">                    <div class="container-blocks">                        <div class="text-block" id="Kmd0dfZ1K" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/resolve/index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KDU9smsLp">                    <div class="container-blocks">                        <div class="text-block" id="KY_LABRT7" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">解析索引、别名和数据流的指定名称</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KwlyQzJFX">                    <div class="container-blocks">                        <div class="text-block" id="Kgx9xLpkU" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="fYhCVE2Lm">                    <div class="container-blocks">                        <div class="text-block" id="fhL_CNFVQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">67</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gw6FFiMQT">                    <div class="container-blocks">                        <div class="text-block" id="gj6tWUd1r" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/rollover</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="g8yJmzj82">                    <div class="container-blocks">                        <div class="text-block" id="gYPm9991x" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">滚动index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gdLxUlOWA">                    <div class="container-blocks">                        <div class="text-block" id="g01jx4MI5" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="zg7Wls1cF">                    <div class="container-blocks">                        <div class="text-block" id="zYcMC1Ilj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">68</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zdPZftfT0">                    <div class="container-blocks">                        <div class="text-block" id="zbjpUTZ6K" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:monitor/segments</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zvcCQuekm">                    <div class="container-blocks">                        <div class="text-block" id="zzmVORMGM" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取segments</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="A2nUwHCxn">                    <div class="container-blocks">                        <div class="text-block" id="AEzdHabry" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="lt5GDr7r8">                    <div class="container-blocks">                        <div class="text-block" id="lhed6oI7w" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">69</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="pXdtZ2f__">                    <div class="container-blocks">                        <div class="text-block" id="p8iO66xTF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:monitor/settings/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qjYn5UXAt">                    <div class="container-blocks">                        <div class="text-block" id="q80LdRz7O" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取指定的segment</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qRYIanxFs">                    <div class="container-blocks">                        <div class="text-block" id="ql6xfohIq" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="sLa4iST9r">                    <div class="container-blocks">                        <div class="text-block" id="spycttaEU" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">70</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sT0Nnu2t5">                    <div class="container-blocks">                        <div class="text-block" id="sjM1ORowK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/settings/update</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="t9l0ht5I3">                    <div class="container-blocks">                        <div class="text-block" id="tUq3qahk_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">更新index设置</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="tu5xOSFNq">                    <div class="container-blocks">                        <div class="text-block" id="tpNQgvO_Q" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="zkPT13xWO">                    <div class="container-blocks">                        <div class="text-block" id="zka_UNaxb" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">71</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="AOUqGHfhq">                    <div class="container-blocks">                        <div class="text-block" id="AMBQhqpmG" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:monitor/shard_stores</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Ai5z4yiTG">                    <div class="container-blocks">                        <div class="text-block" id="AxFdTKpsc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取shard存储信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BoeSEU9aF">                    <div class="container-blocks">                        <div class="text-block" id="Bv6pQAHfV" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="BD0LY9iPW">                    <div class="container-blocks">                        <div class="text-block" id="Bg5bf_Ag3" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">72</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="B8eWo_P3o">                    <div class="container-blocks">                        <div class="text-block" id="BQ1UkSrwY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/resize</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="CTPuJTnop">                    <div class="container-blocks">                        <div class="text-block" id="CjnYRuOpN" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">resize index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="CXURH4ODG">                    <div class="container-blocks">                        <div class="text-block" id="C5lp72pC5" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="FqnQM_anq">                    <div class="container-blocks">                        <div class="text-block" id="F2vQGl858" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">73</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="GgQzAEPhj">                    <div class="container-blocks">                        <div class="text-block" id="GVatuyEPu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/shrink</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="GfLow8w5A">                    <div class="container-blocks">                        <div class="text-block" id="GOWoLkw0B" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">将现有索引缩减为具有较少主碎片的新索引</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="GLf81U9lY">                    <div class="container-blocks">                        <div class="text-block" id="GsQgkN2PQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="MdZ5GbBTD">                    <div class="container-blocks">                        <div class="text-block" id="MOzuMLqnU" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">74</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Pe80uHWX1">                    <div class="container-blocks">                        <div class="text-block" id="PNUDGvckj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:monitor/field_usage_stats</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Qya0pmPWk">                    <div class="container-blocks">                        <div class="text-block" id="Q2aaKvQbm" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取字段xin'x信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Q6bn1UEh9">                    <div class="container-blocks">                        <div class="text-block" id="Q2Q2QzCaY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="agcNB2_dw">                    <div class="container-blocks">                        <div class="text-block" id="aTzxaImyO" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">75</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="b4se0U9b_">                    <div class="container-blocks">                        <div class="text-block" id="bf2gQ_hYw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:monitor/stats</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="bhkemVt6G">                    <div class="container-blocks">                        <div class="text-block" id="b1CAFYRPL" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取index的监控信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="dOy77mLzv">                    <div class="container-blocks">                        <div class="text-block" id="dlvTk4l2O" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Yeov0nVvC">                    <div class="container-blocks">                        <div class="text-block" id="YX5YU7DLW" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">76</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Yqiucsp9d">                    <div class="container-blocks">                        <div class="text-block" id="Y0CoSmWdM" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/component_template/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="a2lre4MOk">                    <div class="container-blocks">                        <div class="text-block" id="a67zLbLbJ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除模板组件</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="a37NWg3IO">                    <div class="container-blocks">                        <div class="text-block" id="aavWpl95_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="juPstfTwU">                    <div class="container-blocks">                        <div class="text-block" id="jIKAyEJOp" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">77</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="lvtzsAG7O">                    <div class="container-blocks">                        <div class="text-block" id="lsv2mnhAu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/template/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="lzGyZLC1G">                    <div class="container-blocks">                        <div class="text-block" id="lXb6ZQbSh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除模板</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="mdpkBwP_k">                    <div class="container-blocks">                        <div class="text-block" id="mr8k92Rpt" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="wravNgEWr">                    <div class="container-blocks">                        <div class="text-block" id="wMiKRXsLu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">78</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="xljQqXoSm">                    <div class="container-blocks">                        <div class="text-block" id="xU0VxZoNS" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/component_template/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="y7tRQ7glW">                    <div class="container-blocks">                        <div class="text-block" id="yRg4uhJS1" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取模板组件</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="z82jl2fG6">                    <div class="container-blocks">                        <div class="text-block" id="zLaQEpMgG" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="t1pTybHpp">                    <div class="container-blocks">                        <div class="text-block" id="tOL3AL8x1" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">79</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="tykHv9Mof">                    <div class="container-blocks">                        <div class="text-block" id="tZi2xOryj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/index_template/get</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="uYsevio8B">                    <div class="container-blocks">                        <div class="text-block" id="uhIRDXEod" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取指定模板</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="utMGRFsIr">                    <div class="container-blocks">                        <div class="text-block" id="uT4erwyJQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="tXXRonTg9">                    <div class="container-blocks">                        <div class="text-block" id="td0CBwKEY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">80</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="zI6SoHWDE">                    <div class="container-blocks">                        <div class="text-block" id="z94G0rL0i" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/template/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="AlD6NP7HK">                    <div class="container-blocks">                        <div class="text-block" id="ANQW6BSPE" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取指定模板</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Bi7EV8lFZ">                    <div class="container-blocks">                        <div class="text-block" id="BsBnt3Ou6" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="SvJ13yaiQ">                    <div class="container-blocks">                        <div class="text-block" id="SrvDFHDke" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">81</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="VlBm4wQy6">                    <div class="container-blocks">                        <div class="text-block" id="VWKJXexqQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">indices:admin/index_template/simulate_index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="WYxoKVorX">                    <div class="container-blocks">                        <div class="text-block" id="WnN7vOfiq" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">返回将由特定索引模板应用的索引配置</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="WygfvbCbR">                    <div class="container-blocks">                        <div class="text-block" id="Wk5o648GQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="EjMRKZMYq">                    <div class="container-blocks">                        <div class="text-block" id="EIOlplVgT" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">82</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="JQC4mwJgn">                    <div class="container-blocks">                        <div class="text-block" id="Jl6VJJkdl" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">indices:admin/index_template/simulate</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="JuVAhkhpJ">                    <div class="container-blocks">                        <div class="text-block" id="JBOIYs_gp" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">返回将由特定索引模板应用的索引配置</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="JzoBKKdYF">                    <div class="container-blocks">                        <div class="text-block" id="JqIrTjpnC" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="chg0u1hjR">                    <div class="container-blocks">                        <div class="text-block" id="cLUFK3kys" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">83</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="c5CPT58dQ">                    <div class="container-blocks">                        <div class="text-block" id="cIGo8KCbG" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/component_template/put</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="c9DPZMkBh">                    <div class="container-blocks">                        <div class="text-block" id="cShoY5sh_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">添加模板组件</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="d3EiiQurM">                    <div class="container-blocks">                        <div class="text-block" id="dcJ3JHNnb" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="F8QlfgwSs">                    <div class="container-blocks">                        <div class="text-block" id="FiPrKbMe3" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">84</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="F0rJql4mP">                    <div class="container-blocks">                        <div class="text-block" id="FUMDx_Wt1" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/template/put</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Gx1B5QMwx">                    <div class="container-blocks">                        <div class="text-block" id="Gxj12ruB6" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">添加模板</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="GtMZI0CpF">                    <div class="container-blocks">                        <div class="text-block" id="G3_IkGZ3N" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="buQPRNJoK">                    <div class="container-blocks">                        <div class="text-block" id="bIq6hnaI4" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">85</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="ctbVqkvhH">                    <div class="container-blocks">                        <div class="text-block" id="c7uNN0pOf" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:monitor/upgrade</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="dxvZrxDBL">                    <div class="container-blocks">                        <div class="text-block" id="dNZi4kbY2" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取迁移信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="dSuHcicfa">                    <div class="container-blocks">                        <div class="text-block" id="dA8UryrPc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="HuUIywy_r">                    <div class="container-blocks">                        <div class="text-block" id="HscaENH1W" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">86</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NqTZiNZeb">                    <div class="container-blocks">                        <div class="text-block" id="LQcFKvQml" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/upgrade</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Na__jtAYc">                    <div class="container-blocks">                        <div class="text-block" id="NS6M_sm83" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">迁移index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NsiUQHJ4V">                    <div class="container-blocks">                        <div class="text-block" id="Nrzl5YnlA" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="p4Vdeq2_F">                    <div class="container-blocks">                        <div class="text-block" id="pPi_0dJtt" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">87</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="puBbTO8ih">                    <div class="container-blocks">                        <div class="text-block" id="pq89gtz1J" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">internal:indices/admin/upgrade</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="p8_9cMdak">                    <div class="container-blocks">                        <div class="text-block" id="ptPnoearo" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">内部迁移index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qdIGubtQM">                    <div class="container-blocks">                        <div class="text-block" id="qGJ5JFEJw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="c81n2_kgo">                    <div class="container-blocks">                        <div class="text-block" id="cdKkWtlPh" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">88</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cobIvcUQW">                    <div class="container-blocks">                        <div class="text-block" id="clA5Z6hLB" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/validate/query</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cXUUpAue8">                    <div class="container-blocks">                        <div class="text-block" id="ceE2NHZ_Y" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">验证查询</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cNUsDzlaM">                    <div class="container-blocks">                        <div class="text-block" id="c1yoI_Mr2" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Zx2SbDmBd">                    <div class="container-blocks">                        <div class="text-block" id="Z_zag_9be" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">89</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Zu8HVKQG8">                    <div class="container-blocks">                        <div class="text-block" id="Z72BlJF12" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/write/bulk</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="brvFDwkeI">                    <div class="container-blocks">                        <div class="text-block" id="bHwjHJKgW" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">批量写</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="bjdSjtwBU">                    <div class="container-blocks">                        <div class="text-block" id="bn3qXvioR" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="q05ny4k7Z">                    <div class="container-blocks">                        <div class="text-block" id="qcK5L3qHr" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">90</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="qrsYmS93U">                    <div class="container-blocks">                        <div class="text-block" id="qE7cA0uSJ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:admin/data_stream/modify</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sajuX2hTd">                    <div class="container-blocks">                        <div class="text-block" id="safhqp2mI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">修改数据流</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="sh0M8PgJz">                    <div class="container-blocks">                        <div class="text-block" id="sYUZL56p7" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="IdJbw3ymA">                    <div class="container-blocks">                        <div class="text-block" id="Icd1JguQG" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">91</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LqeKD7a6A">                    <div class="container-blocks">                        <div class="text-block" id="LAjpcTN0U" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/write/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="M7M83p6SW">                    <div class="container-blocks">                        <div class="text-block" id="M2gl_qwEe" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除文档</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="MiPLekRBC">                    <div class="container-blocks">                        <div class="text-block" id="MoXBrPIGf" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="M4b8YW0mz">                    <div class="container-blocks">                        <div class="text-block" id="MHU3vekbK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">92</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Nh4qIwo8W">                    <div class="container-blocks">                        <div class="text-block" id="NUthtMJXN" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/explain</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NxxTxnUbC">                    <div class="container-blocks">                        <div class="text-block" id="N0wEtMhiu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取读取的异常信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NhTkvxPiz">                    <div class="container-blocks">                        <div class="text-block" id="N98ykzJhQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="BVgYb4ivW">                    <div class="container-blocks">                        <div class="text-block" id="BWwz28svl" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">93</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="CmDvRyCFB">                    <div class="container-blocks">                        <div class="text-block" id="CINSXZAZs" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/field_caps</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="C8ygl2D1M">                    <div class="container-blocks">                        <div class="text-block" id="CxAefr48C" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取字段caps</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="CKmob8qV5">                    <div class="container-blocks">                        <div class="text-block" id="ChACtBy8T" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="cfflzQItG">                    <div class="container-blocks">                        <div class="text-block" id="ckfZIMWmu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">94</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="eneQGU8Hz">                    <div class="container-blocks">                        <div class="text-block" id="eZMriU5N_" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/get</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="fJl_AKDqG">                    <div class="container-blocks">                        <div class="text-block" id="fmKTvoQF9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">通过id获取数据</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="f4kbIjHwZ">                    <div class="container-blocks">                        <div class="text-block" id="fWRkzgCDG" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="PprAGG_Jz">                    <div class="container-blocks">                        <div class="text-block" id="P0FOy_dbk" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">95</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="QOypbQOBU">                    <div class="container-blocks">                        <div class="text-block" id="Q7BpEhzAe" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/mget</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="RriOtPiNk">                    <div class="container-blocks">                        <div class="text-block" id="RV6KhzjoX" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">批量获取数据</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="R7gJZif2S">                    <div class="container-blocks">                        <div class="text-block" id="RnRasmaHk" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="EaKACgwPw">                    <div class="container-blocks">                        <div class="text-block" id="DtUqhKVCg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">96</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="GMWFCxNqs">                    <div class="container-blocks">                        <div class="text-block" id="G5cA2OEph" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/write/index</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="HTeHpk1fM">                    <div class="container-blocks">                        <div class="text-block" id="HoOqW2ar4" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">写数据</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="HjSGEcueO">                    <div class="container-blocks">                        <div class="text-block" id="HCmj7FUMR" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="AgjZfdnHG">                    <div class="container-blocks">                        <div class="text-block" id="ARWOfAreA" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">97</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BkKJWRLdq">                    <div class="container-blocks">                        <div class="text-block" id="BLYA4BP4e" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/ingest/pipeline/delete</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="BQjd0facK">                    <div class="container-blocks">                        <div class="text-block" id="BwukWmQNT" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">删除预处理脚本</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Cpib2W7Zs">                    <div class="container-blocks">                        <div class="text-block" id="CLQfMAKM1" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="g9ttXsj5Z">                    <div class="container-blocks">                        <div class="text-block" id="gL6X1INbN" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">98</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gG93t3tzm">                    <div class="container-blocks">                        <div class="text-block" id="gytjCWuUu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/ingest/pipeline/get</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gIMta3nnd">                    <div class="container-blocks">                        <div class="text-block" id="gp1fGTEbI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取预处理脚本</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="gLjI04Alh">                    <div class="container-blocks">                        <div class="text-block" id="gJnVss7OI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Sb02VGwnA">                    <div class="container-blocks">                        <div class="text-block" id="Sb1DlWEZd" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">99</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="TTY4VYcgg">                    <div class="container-blocks">                        <div class="text-block" id="SCkOMcKQs" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:admin/ingest/pipeline/put</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="T8CzX9nNs">                    <div class="container-blocks">                        <div class="text-block" id="TKmJq9Kpj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">添加预处理脚本</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="TEg_407Sx">                    <div class="container-blocks">                        <div class="text-block" id="T7HcvEGwQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="ORfCMJz41">                    <div class="container-blocks">                        <div class="text-block" id="OcwhBzjl0" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">100</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="PaunbO1cb">                    <div class="container-blocks">                        <div class="text-block" id="PD5wq_qoy" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">cluster:admin/ingest/pipeline/simulate</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Puf6MKoJ9">                    <div class="container-blocks">                        <div class="text-block" id="PRUk1L6aF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取预处理脚本的配置</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="PblZpeD58">                    <div class="container-blocks">                        <div class="text-block" id="PRs8k_CRv" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="NqSe2meN0">                    <div class="container-blocks">                        <div class="text-block" id="NogqxYm0r" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">101</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="NGE1T3vEu">                    <div class="container-blocks">                        <div class="text-block" id="NXIghrw47" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">cluster:monitor/main</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Or54Knjtp">                    <div class="container-blocks">                        <div class="text-block" id="OdjwmgSe6" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">获取集群信息</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Ot8DMV8lh">                    <div class="container-blocks">                        <div class="text-block" id="Od5CsG7pI" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="ab2E36raf">                    <div class="container-blocks">                        <div class="text-block" id="a3Yw0BQDu" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">102</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="aY1GyJx1V">                    <div class="container-blocks">                        <div class="text-block" id="afuuty3JF" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/scroll/clear</span>                            </div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="akx5uuYRO">                    <div class="container-blocks">                        <div class="text-block" id="adKyFw6br" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">清理游标</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="bR7Krlhlx">                    <div class="container-blocks">                        <div class="text-block" id="bbKRZg566" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="BlJn1QefQ">                    <div class="container-blocks">                        <div class="text-block" id="BVMtYiuVc" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">103</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="DaswaNThF">                    <div class="container-blocks">                        <div class="text-block" id="DDoT5waRn" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">indices:data/read/close_point_in_time</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="EyBguCxT5">                    <div class="container-blocks">                        <div class="text-block" id="Es7_daL72" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="EIIu5bf6Q">                    <div class="container-blocks">                        <div class="text-block" id="EwVej8v5v" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="IXOnZh2_r">                    <div class="container-blocks">                        <div class="text-block" id="IAUjg7Wi8" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">104</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="IQ4dqNOW0">                    <div class="container-blocks">                        <div class="text-block" id="IQadVROBQ" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/msearch</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="IsDlYx1Rr">                    <div class="container-blocks">                        <div class="text-block" id="IxQezypRV" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">批量搜索</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="JT_6Ldasq">                    <div class="container-blocks">                        <div class="text-block" id="JURFjUD1C" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="YqFjVmicP">                    <div class="container-blocks">                        <div class="text-block" id="YkwBMWE6t" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">105</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="bTp56qviS">                    <div class="container-blocks">                        <div class="text-block" id="b9ROzmg9P" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span                                    class="text">indices:data/read/open_point_in_time</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="cNM8cU35J">                    <div class="container-blocks">                        <div class="text-block" id="crWtD_UvY" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="dv5lFgQwY">                    <div class="container-blocks">                        <div class="text-block" id="duPHj46Mw" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="KgcnDfffk">                    <div class="container-blocks">                        <div class="text-block" id="KzOtCqLq9" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">106</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KXztDfOXk">                    <div class="container-blocks">                        <div class="text-block" id="KHryb9V3G" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/search</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KANTC_8ZU">                    <div class="container-blocks">                        <div class="text-block" id="KnKl9YrFj" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">搜索</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LtLfCNW56">                    <div class="container-blocks">                        <div class="text-block" id="LLk8E39C0" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="XAf9H45m9">                    <div class="container-blocks">                        <div class="text-block" id="Xruym6_XD" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">107</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Yytcui1kf">                    <div class="container-blocks">                        <div class="text-block" id="Y_Y779z7u" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/scroll</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Yvp5gi3fp">                    <div class="container-blocks">                        <div class="text-block" id="YO5vwY2vH" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">游标查询</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Z3Rj3Xs4q">                    <div class="container-blocks">                        <div class="text-block" id="ZnjxZqCmv" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="HfjKkYrJX">                    <div class="container-blocks">                        <div class="text-block" id="HBG9UdS6T" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">108</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="KBghUSUPg">                    <div class="container-blocks">                        <div class="text-block" id="KE9PxKHid" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/mtv</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LIAaUBYTM">                    <div class="container-blocks">                        <div class="text-block" id="LoNEoH31t" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="LYy1PoiYM">                    <div class="container-blocks">                        <div class="text-block" id="LOhFuhSsk" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="B33a_ffS4">                    <div class="container-blocks">                        <div class="text-block" id="BHpKF1qXK" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">109</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="EMwXZslQO">                    <div class="container-blocks">                        <div class="text-block" id="EncwjRNit" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/read/tv</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="FMnioNcWR">                    <div class="container-blocks">                        <div class="text-block" id="FlJpaJCF0" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="FuUER21ea">                    <div class="container-blocks">                        <div class="text-block" id="F3ZJj8aGg" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>        <tr>            <td>                <div class="child" data-type="editor-container" data-container-id="Cfwl_bWLK">                    <div class="container-blocks">                        <div class="text-block" id="C3CSM2zV6" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">110</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Dxc4QeohQ">                    <div class="container-blocks">                        <div class="text-block" id="D8fC18zkO" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">indices:data/write/update</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="DfWh8IacZ">                    <div class="container-blocks">                        <div class="text-block" id="DWFsyv8Gz" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span class="text">更新数据</span></div>                        </div>                    </div>                </div>            </td>            <td>                <div class="child" data-type="editor-container" data-container-id="Dhl4Ldh9h">                    <div class="container-blocks">                        <div class="text-block" id="D0m0axOFP" data-type="editor-block" data-block-type="text">                            <div data-type="block-content"><span><br></span></div>                        </div>                    </div>                </div>            </td>        </tr>    </tbody></table><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>task创建的时机：<br>1、client通过reset api发起请求后，请求会装换成一个transport action，transport action在执行之前会创建一个task<br>2、node与node之间通信，这个通信也是通过 transport action 请求完成的，在目标 Node 收到请求后，也会生成一个 task<br>整体流程:<br>1、client发送请求 -&gt; rest controller接收到请求 -&gt; 注册task -&gt; 执行transport action -&gt; 持久化task结果 -&gt; 注销task -&gt; 响应客户端<br>2、node1发送请求 -&gt; node2 接收到请求 -&gt; 注册task -&gt; 执行transport action -&gt; 持久化task结果 -&gt; 注销task -&gt; 响应node1</p><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><p>Task的注册在TaskManager类中实现，方法共有3个参数，type: 任务类型，action: 任务名称, request: 请求. 其中TaskAwareRequest是一个接口，不同的请求会实现不同的接口，<br>第一步: 获取到请求header, 这里会对请求头做一个大小判断， 通过http.max_header_size参数设置， 默认8K 过大会报错<br>第二步: 创建task，这个会调用请求类的createTask方法来创建对应的task，这里的话，task的类型会比较多，一般分类就是可取消和不可取消<br>第三步: 将task分为可取消和其它，其它类型的task就直接放在tasks这个列表里面，而可取消的task通过其它方法来注册<br>可以取消的任务主要是一些需要长时间运行的的任务，比如 reindex、update by query、delete by query、search 等<br>task注册完之后就将注册的task放回给注册端使用</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> Task <span class="hljs-title function_">register</span>(<span class="hljs-built_in">String</span> type, <span class="hljs-built_in">String</span> action, TaskAwareRequest request) &#123;<br>    Map&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; headers = <span class="hljs-keyword">new </span><span class="hljs-class title_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-type">long</span> headerSize = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">long</span> maxSize = maxHeaderSize.<span class="hljs-property">getBytes</span>();<br>    ThreadContext threadContext = threadPool.<span class="hljs-property">getThreadContext</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> <span class="hljs-built_in">key</span> : taskHeaders) &#123;<br>        <span class="hljs-built_in">String</span> httpHeader = threadContext.<span class="hljs-property">getHeader</span>(<span class="hljs-built_in">key</span>);<br>        <span class="hljs-keyword">if</span> (httpHeader != <span class="hljs-literal">null</span>) &#123;<br>            headerSize += <span class="hljs-built_in">key</span>.<span class="hljs-property">length</span>() * <span class="hljs-number">2</span> + httpHeader.<span class="hljs-property">length</span>() * <span class="hljs-number">2</span>;<br>            <span class="hljs-keyword">if</span> (headerSize &gt; maxSize) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new </span><span class="hljs-class title_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Request exceeded the maximum size of task headers &quot;</span> + maxHeaderSize);<br>            &#125;<br>            headers.<span class="hljs-property">put</span>(<span class="hljs-built_in">key</span>, httpHeader);<br>        &#125;<br>    &#125;<br>    Task task = request.<span class="hljs-property">createTask</span>(taskIdGenerator.<span class="hljs-property">incrementAndGet</span>(), type, action, request.<span class="hljs-property">getParentTask</span>(), headers);<br>    Objects.<span class="hljs-property">requireNonNull</span>(task);<br>    <span class="hljs-keyword">assert</span> task.<span class="hljs-property">getParentTaskId</span>().<span class="hljs-property">equals</span>(request.<span class="hljs-property">getParentTask</span>()) : <span class="hljs-string">&quot;Request [ &quot;</span> + request + <span class="hljs-string">&quot;] didn&#x27;t preserve it parentTaskId&quot;</span>;<br>    <span class="hljs-keyword">if</span> (logger.<span class="hljs-property">isTraceEnabled</span>()) &#123;<br>        logger.<span class="hljs-property">trace</span>(<span class="hljs-string">&quot;register &#123;&#125; [&#123;&#125;] [&#123;&#125;] [&#123;&#125;]&quot;</span>, task.<span class="hljs-property">getId</span>(), type, action, task.<span class="hljs-property">getDescription</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (task <span class="hljs-keyword">instanceof</span> CancellableTask) &#123;<br>        <span class="hljs-title function_">registerCancellableTask</span>(task);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        Task previousTask = tasks.<span class="hljs-property">put</span>(task.<span class="hljs-property">getId</span>(), task);<br>        <span class="hljs-keyword">assert</span> previousTask == <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> task;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建task这里类型会比较多，下面是其中两个，其中id是AtomicLong生成的一个自增id, 这个id在node内唯一</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">Task</span> <span class="hljs-title function_">createTask</span>(<span class="hljs-params">long id, <span class="hljs-built_in">String</span> <span class="hljs-keyword">type</span>, <span class="hljs-built_in">String</span> action, TaskId parentTaskId, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; headers</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CancellableTask</span>(id, <span class="hljs-keyword">type</span>, action, <span class="hljs-title function_">getDescription</span>(), parentTaskId, headers) &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">shouldCancelChildrenOnCancellation</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">Task</span> <span class="hljs-title function_">createTask</span>(<span class="hljs-params">long id, <span class="hljs-built_in">String</span> <span class="hljs-keyword">type</span>, <span class="hljs-built_in">String</span> action, TaskId parentTaskId, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; headers</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchShardTask</span>(id, <span class="hljs-keyword">type</span>, action, <span class="hljs-title function_">getDescription</span>(), parentTaskId, headers);<br>&#125;<br></code></pre></td></tr></table></figure><p>注册可取消的task, 这里的话就是将task包装成为一下，然后将包装后的task存大cancellableTasks这个列表中，也就是说，不可取消的在tasks列表，可取消的在cancellableTasks列表</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> registerCancellableTask(<span class="hljs-keyword">Task</span> <span class="hljs-keyword">task</span>) &#123;<br>    CancellableTask cancellableTask = (CancellableTask) <span class="hljs-keyword">task</span>;<br>    CancellableTaskHolder holder = <span class="hljs-keyword">new</span> CancellableTaskHolder(cancellableTask);<br>    cancellableTasks.put(<span class="hljs-keyword">task</span>, holder);<br>    <span class="hljs-comment">// Check if this task was banned before we start it.</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">task</span>.getParentTaskId().isSet()) &#123;<br>        <span class="hljs-keyword">final</span> Ban ban = bannedParents.get(<span class="hljs-keyword">task</span>.getParentTaskId());<br>        <span class="hljs-keyword">if</span> (ban != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                holder.cancel(ban.reason);<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TaskCancelledException(<span class="hljs-string">&quot;task cancelled before starting [&quot;</span> + ban.reason + <span class="hljs-string">&#x27;]&#x27;</span>);<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">// let&#x27;s clean up the registration</span><br>                unregister(<span class="hljs-keyword">task</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>注册流程总结: 获取请求header -&gt; 判断header大小 -&gt; 创建task -&gt; 如果是可取消的task就做一下包装 -&gt; 将其添加到对应的列表在中</p><h4 id="注销"><a href="#注销" class="headerlink" title="注销"></a>注销</h4><p>注销这里比较比较简单<br>1、对于可取消的任务，这里就会先将任务设置为完成，然后从cancellableTasks列表中移除<br>2、对于不可取消的任务，这里就直接从不可取消的tasks列表中移除</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">public</span> <span class="hljs-keyword">Task</span> unregister(<span class="hljs-keyword">Task</span> <span class="hljs-keyword">task</span>) &#123;<br>    logger.trace(<span class="hljs-string">&quot;unregister task for id: &#123;&#125;&quot;</span>, <span class="hljs-keyword">task</span>.getId());<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">task</span> <span class="hljs-keyword">instanceof</span> CancellableTask) &#123;<br>        CancellableTaskHolder holder = cancellableTasks.remove(<span class="hljs-keyword">task</span>);<br>        <span class="hljs-keyword">if</span> (holder != <span class="hljs-keyword">null</span>) &#123;<br>            holder.finish();<br>            assert holder.<span class="hljs-keyword">task</span> == <span class="hljs-keyword">task</span>;<br>            <span class="hljs-keyword">return</span> holder.getTask();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-keyword">Task</span> removedTask = tasks.remove(<span class="hljs-keyword">task</span>.getId());<br>        assert removedTask == <span class="hljs-keyword">null</span> || removedTask == <span class="hljs-keyword">task</span>;<br>        <span class="hljs-keyword">return</span> removedTask;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>完成方法就是简单的将任务标记为完成， 标记之后广播任务完成事件</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">finish</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> List&lt;Runnable&gt; listeners;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br>        <span class="hljs-keyword">this</span>.finished = <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">if</span> (cancellationListeners != <span class="hljs-keyword">null</span>) &#123;<br>            listeners = cancellationListeners;<br>            cancellationListeners = <span class="hljs-keyword">null</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            listeners = Collections.emptyList();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// We need to call the listener outside of the synchronised section to avoid potential bottle necks</span><br>    <span class="hljs-comment">// in the listener synchronization</span><br>    notifyListeners(listeners);<br>&#125;<br></code></pre></td></tr></table></figure><p>注销流程总结: 判断任务类型 -&gt; 可取消的任务调用完成方法 -&gt; 标记任务完成 -&gt; 广播完成事件 -&gt; 从可取消列表中移除</p><h4 id="取消"><a href="#取消" class="headerlink" title="取消"></a>取消</h4><p>取消操作，来自客户端调用取消api, 内部会调用取消方法来取消task或内部执行异常了调用取消，这里的逻辑是，先从可取消列表中获取对应的task，如果能获取到就执行对应任务的取消操作，如果获取不到就执行task取消的广播事件</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> cancel(CancellableTask <span class="hljs-keyword">task</span>, String reason, Runnable listener) &#123;<br>    CancellableTaskHolder holder = cancellableTasks.get(<span class="hljs-keyword">task</span>.getId());<br>    <span class="hljs-keyword">if</span> (holder != <span class="hljs-keyword">null</span>) &#123;<br>        logger.trace(<span class="hljs-string">&quot;cancelling task with id &#123;&#125;&quot;</span>, <span class="hljs-keyword">task</span>.getId());<br>        holder.cancel(reason, listener);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        listener.run();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里就是先关闭一下事件，然后调用对应task的取消方法，这里每个task的取消方法实现不一</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> reason, Runnable listener</span>) &#123;<br>    final <span class="hljs-title class_">Runnable</span> toRun;<br>    synchronized (<span class="hljs-variable language_">this</span>) &#123;<br>        <span class="hljs-keyword">if</span> (finished) &#123;<br>            assert cancellationListeners == <span class="hljs-literal">null</span>;<br>            toRun = listener;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            toRun = () -&gt; &#123;&#125;;<br>            <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (cancellationListeners == <span class="hljs-literal">null</span>) &#123;<br>                    cancellationListeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>                &#125;<br>                cancellationListeners.<span class="hljs-title function_">add</span>(listener);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">try</span> &#123;<br>        task.<span class="hljs-title function_">cancel</span>(reason);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (toRun != <span class="hljs-literal">null</span>) &#123;<br>            toRun.<span class="hljs-title function_">run</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> reason</span>) &#123;<br>    task.<span class="hljs-title function_">cancel</span>(reason);<br>&#125;<br></code></pre></td></tr></table></figure><p>这里看看其中一种取消的实现, 这个是reindex操作的其中一个功能的取消实现，内部实现可以概括为，重置了一些内部的数据，可以重新开始下一次操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(String reason)</span> &#123;<br>    <span class="hljs-keyword">assert</span> reason != <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isCancelled) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-built_in">this</span>.isCancelled = <span class="hljs-literal">true</span>;<br>        <span class="hljs-built_in">this</span>.reason = reason;<br>    &#125;<br>    listeners.forEach(CancellationListener::onCancelled);<br>    onCancelled();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCancelled</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (isWorker()) &#123;<br>        workerState.handleCancel();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isWorker</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> workerState != <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleCancel</span><span class="hljs-params">()</span> &#123;<br>    rethrottle(Float.POSITIVE_INFINITY);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rethrottle</span><span class="hljs-params">(<span class="hljs-type">float</span> newRequestsPerSecond)</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> (delayedPrepareBulkRequestReference) &#123;<br>        logger.debug(<span class="hljs-string">&quot;[&#123;&#125;]: rethrottling to [&#123;&#125;] requests per second&quot;</span>, task.getId(), newRequestsPerSecond);<br>        setRequestsPerSecond(newRequestsPerSecond);<br><br>        <span class="hljs-type">DelayedPrepareBulkRequest</span> <span class="hljs-variable">delayedPrepareBulkRequest</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.delayedPrepareBulkRequestReference.get();<br>        <span class="hljs-keyword">if</span> (delayedPrepareBulkRequest == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// No request has been queued so nothing to reschedule.</span><br>            logger.debug(<span class="hljs-string">&quot;[&#123;&#125;]: skipping rescheduling because there is no scheduled task&quot;</span>, task.getId());<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-built_in">this</span>.delayedPrepareBulkRequestReference.set(delayedPrepareBulkRequest.rethrottle(newRequestsPerSecond));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>取消流程总结: client 发送取消请求(内部调用取消) -&gt; 获取对应的task -&gt; 广播取消事件 -&gt; 调用具体的任务的取消操作</p><h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><p>1、什么样的任务会被持久化？<br>在ES中有一些长时间运行的task，比如allocation, cluster_routing, reindex, replicas, restore, snapshot等，这些请求中会有一个参数wait_for_completion，当这个参数设置为false，任务的结果会被持久化存储<br>2、持久化都那里去？<br>当有需要持久化的任务产生时，ES会创建索引名称为.task的索引，这个索引内部就存储任务的信息和结果<br>3、持久化什么内容?<br>会持久化任务的执行的结果，会失败的结果，还有任务的信息</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.tasks&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;_type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;task&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0IBSz1ouRIegZRWbXYpJng:65687962&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;_score&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1.0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;_source&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;completed&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;task&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;node&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0IBSz1ouRIegZRWbXYpJng&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">65687962</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transport&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;action&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;indices:data/write/reindex&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;status&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-attr">&quot;total&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2226451</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;updated&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2212038</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;created&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">14413</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;deleted&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;batches&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2227</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;version_conflicts&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;noops&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;retries&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;bulk&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;search&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>              <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;throttled_millis&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;requests_per_second&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">-1.0</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;throttled_until_millis&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;description&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;reindex from [xxx-proclog-2023.01.19] to [sdwn-test-2023.01.19][_doc]&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;start_time_in_millis&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1692167705775</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;running_time_in_nanos&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">650132524134</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;cancellable&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;headers&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;response&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;took&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">650100</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;timed_out&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;total&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2226451</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;updated&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2212038</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;created&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">14413</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;deleted&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;batches&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2227</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;version_conflicts&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;noops&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;retries&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-attr">&quot;bulk&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;search&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;throttled&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0s&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;throttled_millis&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;requests_per_second&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">-1.0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;throttled_until&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0s&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;throttled_until_millis&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;failures&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-punctuation">]</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>下面来看看具体实现，持久化操作分为两种类型，第一种是持久化失败结果，第二种的持久化成功结果<br>1、持久化失败结果<br>第一步: 拿到任务的结果<br>第二步: 调用taskservice来持久化数据</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public &lt;Response extends ActionResponse&gt; void store<span class="hljs-constructor">Result(Task <span class="hljs-params">task</span>, Exception <span class="hljs-params">error</span>, ActionListener&lt;Response&gt; <span class="hljs-params">listener</span>)</span> &#123;<br>    DiscoveryNode localNode = lastDiscoveryNodes.get<span class="hljs-constructor">LocalNode()</span>;<br>    <span class="hljs-keyword">if</span> (localNode<span class="hljs-operator"> == </span>null) &#123;<br>        <span class="hljs-comment">// too early to store anything, shouldn&#x27;t really be here - just pass the error along</span><br>        listener.on<span class="hljs-constructor">Failure(<span class="hljs-params">error</span>)</span>;<br>        return;<br>    &#125;<br>    final TaskResult taskResult;<br>    <span class="hljs-keyword">try</span> &#123;<br>        taskResult = task.result(localNode, error);<br>    &#125; catch (IOException ex) &#123;<br>        logger.warn(<span class="hljs-literal">()</span> -&gt; <span class="hljs-keyword">new</span> <span class="hljs-constructor">ParameterizedMessage(<span class="hljs-string">&quot;couldn&#x27;t store error &#123;&#125;&quot;</span>, ExceptionsHelper.<span class="hljs-params">detailedMessage</span>(<span class="hljs-params">error</span>)</span>), ex);<br>        listener.on<span class="hljs-constructor">Failure(<span class="hljs-params">ex</span>)</span>;<br>        return;<br>    &#125;<br>    taskResultsService.store<span class="hljs-constructor">Result(<span class="hljs-params">taskResult</span>, <span class="hljs-params">new</span> ActionListener&lt;Void&gt;()</span> &#123;<br>        @Override<br>        public void on<span class="hljs-constructor">Response(Void <span class="hljs-params">aVoid</span>)</span> &#123;<br>            listener.on<span class="hljs-constructor">Failure(<span class="hljs-params">error</span>)</span>;<br>        &#125;<br><br>        @Override<br>        public void on<span class="hljs-constructor">Failure(Exception <span class="hljs-params">e</span>)</span> &#123;<br>            logger.warn(<span class="hljs-literal">()</span> -&gt; <span class="hljs-keyword">new</span> <span class="hljs-constructor">ParameterizedMessage(<span class="hljs-string">&quot;couldn&#x27;t store error &#123;&#125;&quot;</span>, ExceptionsHelper.<span class="hljs-params">detailedMessage</span>(<span class="hljs-params">error</span>)</span>), e);<br>            listener.on<span class="hljs-constructor">Failure(<span class="hljs-params">e</span>)</span>;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>2、持久化失败结果<br>第一步: 拿到任务的结果<br>第二步: 调用taskservice来持久化数据<br>持久化成功和失败，核心方式都是一样的，不一样的是，广播事件的方法不一样，成功的会广播成功事件，失败的会广告失败的事件</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public &lt;Response extends ActionResponse&gt; void store<span class="hljs-constructor">Result(Task <span class="hljs-params">task</span>, Response <span class="hljs-params">response</span>, ActionListener&lt;Response&gt; <span class="hljs-params">listener</span>)</span> &#123;<br>    DiscoveryNode localNode = lastDiscoveryNodes.get<span class="hljs-constructor">LocalNode()</span>;<br>    <span class="hljs-keyword">if</span> (localNode<span class="hljs-operator"> == </span>null) &#123;<br>        <span class="hljs-comment">// too early to store anything, shouldn&#x27;t really be here - just pass the response along</span><br>        logger.warn(<span class="hljs-string">&quot;couldn&#x27;t store response &#123;&#125;, the node didn&#x27;t join the cluster yet&quot;</span>, response);<br>        listener.on<span class="hljs-constructor">Response(<span class="hljs-params">response</span>)</span>;<br>        return;<br>    &#125;<br>    final TaskResult taskResult;<br>    <span class="hljs-keyword">try</span> &#123;<br>        taskResult = task.result(localNode, response);<br>    &#125; catch (IOException ex) &#123;<br>        logger.warn(<span class="hljs-literal">()</span> -&gt; <span class="hljs-keyword">new</span> <span class="hljs-constructor">ParameterizedMessage(<span class="hljs-string">&quot;couldn&#x27;t store response &#123;&#125;&quot;</span>, <span class="hljs-params">response</span>)</span>, ex);<br>        listener.on<span class="hljs-constructor">Failure(<span class="hljs-params">ex</span>)</span>;<br>        return;<br>    &#125;<br><br>    taskResultsService.store<span class="hljs-constructor">Result(<span class="hljs-params">taskResult</span>, <span class="hljs-params">new</span> ActionListener&lt;Void&gt;()</span> &#123;<br>        @Override<br>        public void on<span class="hljs-constructor">Response(Void <span class="hljs-params">aVoid</span>)</span> &#123;<br>            listener.on<span class="hljs-constructor">Response(<span class="hljs-params">response</span>)</span>;<br>        &#125;<br><br>        @Override<br>        public void on<span class="hljs-constructor">Failure(Exception <span class="hljs-params">e</span>)</span> &#123;<br>            logger.warn(<span class="hljs-literal">()</span> -&gt; <span class="hljs-keyword">new</span> <span class="hljs-constructor">ParameterizedMessage(<span class="hljs-string">&quot;couldn&#x27;t store response &#123;&#125;&quot;</span>, <span class="hljs-params">response</span>)</span>, e);<br>            listener.on<span class="hljs-constructor">Failure(<span class="hljs-params">e</span>)</span>;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>核心的持久化操作在taskResultService里面<br>第一步: 构建持久化的index信息，index名称是.tasks，设置写入的文档id等，文档id就是task的id,  上面说过一个id, 这个id是taskId， 组成为 nodeid + 上面创建的那个id<br>第二步: 构建文档数据，主要的字段就是response、error、start_time_in_millis、start_time_in_millis、node和action等<br>第三步: 调用方法将数据写入index中， 这里如果数据写入失败，会执行重试重试14次</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"> public static final String TASK_INDEX = <span class="hljs-string">&quot;.tasks&quot;</span>;<br> public static final String TASK_TYPE = <span class="hljs-string">&quot;task&quot;</span>;<br> public static final String TASK_RESULT_MAPPING_VERSION_META_FIELD = <span class="hljs-string">&quot;version&quot;</span>;<br><br>public void store<span class="hljs-constructor">Result(TaskResult <span class="hljs-params">taskResult</span>, ActionListener&lt;Void&gt; <span class="hljs-params">listener</span>)</span> &#123;<br>    IndexRequestBuilder index = client.prepare<span class="hljs-constructor">Index(TASK_INDEX, TASK_TYPE)</span>.set<span class="hljs-constructor">Id(<span class="hljs-params">taskResult</span>.<span class="hljs-params">getTask</span>()</span>.get<span class="hljs-constructor">TaskId()</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>);<br>    <span class="hljs-keyword">try</span> (XContentBuilder builder = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">XContentFactory</span>.</span></span>content<span class="hljs-constructor">Builder(Requests.INDEX_CONTENT_TYPE)</span>) &#123;<br>        taskResult.<span class="hljs-keyword">to</span><span class="hljs-constructor">XContent(<span class="hljs-params">builder</span>, <span class="hljs-params">new</span> ToXContent.MapParams(Collections.<span class="hljs-params">singletonMap</span>(INCLUDE_CANCELLED_PARAM, <span class="hljs-string">&quot;false&quot;</span>)</span>));<br>        index.set<span class="hljs-constructor">Source(<span class="hljs-params">builder</span>)</span>;<br>    &#125; catch (IOException e) &#123;<br>        throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">ElasticsearchException(<span class="hljs-string">&quot;Couldn&#x27;t convert task result to XContent for [&#123;&#125;]&quot;</span>, <span class="hljs-params">e</span>, <span class="hljs-params">taskResult</span>.<span class="hljs-params">getTask</span>()</span>);<br>    &#125;<br>    <span class="hljs-keyword">do</span><span class="hljs-constructor">StoreResult(STORE_BACKOFF_POLICY.<span class="hljs-params">iterator</span>()</span>, index, listener);<br>&#125;<br><br><span class="hljs-keyword">private</span> void <span class="hljs-keyword">do</span><span class="hljs-constructor">StoreResult(Iterator&lt;TimeValue&gt; <span class="hljs-params">backoff</span>, IndexRequestBuilder <span class="hljs-params">index</span>, ActionListener&lt;Void&gt; <span class="hljs-params">listener</span>)</span> &#123;<br>    index.execute(<span class="hljs-keyword">new</span> ActionListener&lt;IndexResponse&gt;<span class="hljs-literal">()</span> &#123;<br>        @Override<br>        public void on<span class="hljs-constructor">Response(IndexResponse <span class="hljs-params">indexResponse</span>)</span> &#123;<br>            listener.on<span class="hljs-constructor">Response(<span class="hljs-params">null</span>)</span>;<br>        &#125;<br><br>        @Override<br>        public void on<span class="hljs-constructor">Failure(Exception <span class="hljs-params">e</span>)</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span><span class="hljs-operator"> == </span>(e instanceof EsRejectedExecutionException)<span class="hljs-operator"> || </span><span class="hljs-literal">false</span><span class="hljs-operator"> == </span>backoff.has<span class="hljs-constructor">Next()</span>) &#123;<br>                listener.on<span class="hljs-constructor">Failure(<span class="hljs-params">e</span>)</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                TimeValue wait = backoff.next<span class="hljs-literal">()</span>;<br>                logger.warn(<span class="hljs-literal">()</span> -&gt; <span class="hljs-keyword">new</span> <span class="hljs-constructor">ParameterizedMessage(<span class="hljs-string">&quot;failed to store task result, retrying in [&#123;&#125;]&quot;</span>, <span class="hljs-params">wait</span>)</span>, e);<br>                threadPool.schedule(<span class="hljs-literal">()</span> -&gt; <span class="hljs-keyword">do</span><span class="hljs-constructor">StoreResult(<span class="hljs-params">backoff</span>, <span class="hljs-params">index</span>, <span class="hljs-params">listener</span>)</span>, wait, ThreadPool.Names.SAME);<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>调用持久化的方式，是在广播事件中调用，当任务完成是会去调用很多广播事件，其中有一个是持久化结果相关的事件，这里失败调失败的持久化操作，成功调用成功的持久化操作</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskResultStoringActionListener</span>&lt;Response <span class="hljs-keyword">extends</span> ActionResponse&gt; <span class="hljs-keyword">implements</span> ActionListener&lt;Response&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ActionListener&lt;Response&gt; <span class="hljs-keyword">delegate</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Task task;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TaskManager taskManager;<br><br>    <span class="hljs-keyword">private</span> TaskResultStoringActionListener(TaskManager taskManager, Task task, ActionListener&lt;Response&gt; <span class="hljs-keyword">delegate</span>) &#123;<br>        <span class="hljs-keyword">this</span>.taskManager = taskManager;<br>        <span class="hljs-keyword">this</span>.task = task;<br>        <span class="hljs-keyword">this</span>.<span class="hljs-keyword">delegate</span> = <span class="hljs-keyword">delegate</span>;<br>    &#125;<br><br>    @Override<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> onResponse(Response response) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            taskManager.storeResult(task, response, <span class="hljs-keyword">delegate</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">delegate</span>.onFailure(e);<br>        &#125;<br>    &#125;<br><br>    @Override<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> onFailure(Exception e) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            taskManager.storeResult(task, e, <span class="hljs-keyword">delegate</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception inner) &#123;<br>            inner.addSuppressed(e);<br>            <span class="hljs-keyword">delegate</span>.onFailure(inner);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>持久化的时间是在action中注册的，当执行请求之前，会根据条件来判断是否需要持久化，如果需要1持久化就会创建一个持久化事件，当任务处理完毕会执行这个事件，判断的条件是用request.getShouldStoreResult</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> execute(<span class="hljs-keyword">Task</span> <span class="hljs-keyword">task</span>, Request request, ActionListener&lt;Response&gt; listener) &#123;<br>    <span class="hljs-keyword">final</span> ActionRequestValidationException validationException;<br>    <span class="hljs-keyword">try</span> &#123;<br>        validationException = request.validate();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        assert <span class="hljs-keyword">false</span> : <span class="hljs-keyword">new</span> AssertionError(<span class="hljs-string">&quot;validating of request [&quot;</span> + request + <span class="hljs-string">&quot;] threw exception&quot;</span>, e);<br>        logger.warn(<span class="hljs-string">&quot;validating of request [&quot;</span> + request + <span class="hljs-string">&quot;] threw exception&quot;</span>, e);<br>        listener.onFailure(e);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (validationException != <span class="hljs-keyword">null</span>) &#123;<br>        listener.onFailure(validationException);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">task</span> != <span class="hljs-keyword">null</span> &amp;&amp; request.getShouldStoreResult()) &#123;<br>        listener = <span class="hljs-keyword">new</span> TaskResultStoringActionListener&lt;&gt;(taskManager, <span class="hljs-keyword">task</span>, listener);<br>    &#125;<br><br>    RequestFilterChain&lt;Request, Response&gt; requestFilterChain = <span class="hljs-keyword">new</span> RequestFilterChain&lt;&gt;(<span class="hljs-keyword">this</span>, logger);<br>    requestFilterChain.proceed(<span class="hljs-keyword">task</span>, actionName, request, listener);<br>&#125;<br></code></pre></td></tr></table></figure><p>getShouldStoreResult的赋值优一个set方法，也就是说，setShouldStoreResult(true) 这个task的结果就会被持久化</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-function">Self <span class="hljs-title">setShouldStoreResult</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> shouldStoreResult)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.shouldStoreResult = shouldStoreResult;<br>    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-title">self</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>下面是其中一个action设置true的地方，条件是wait_for_completion&#x3D;false， 也就是只有部分任务结果会被持久化，并且wait_for_completion必须为true</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public RestChannelConsumer prepare<span class="hljs-constructor">Request(<span class="hljs-params">final</span> RestRequest <span class="hljs-params">request</span>, <span class="hljs-params">final</span> NodeClient <span class="hljs-params">client</span>)</span> throws IOException &#123;<br>        final ForceMergeRequest mergeRequest = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ForceMergeRequest(Strings.<span class="hljs-params">splitStringByCommaToArray</span>(<span class="hljs-params">request</span>.<span class="hljs-params">param</span>(<span class="hljs-string">&quot;index&quot;</span>)</span>));<br>        mergeRequest.indices<span class="hljs-constructor">Options(IndicesOptions.<span class="hljs-params">fromRequest</span>(<span class="hljs-params">request</span>, <span class="hljs-params">mergeRequest</span>.<span class="hljs-params">indicesOptions</span>()</span>));<br>        mergeRequest.max<span class="hljs-constructor">NumSegments(<span class="hljs-params">request</span>.<span class="hljs-params">paramAsInt</span>(<span class="hljs-string">&quot;max_num_segments&quot;</span>, <span class="hljs-params">mergeRequest</span>.<span class="hljs-params">maxNumSegments</span>()</span>));<br>        mergeRequest.only<span class="hljs-constructor">ExpungeDeletes(<span class="hljs-params">request</span>.<span class="hljs-params">paramAsBoolean</span>(<span class="hljs-string">&quot;only_expunge_deletes&quot;</span>, <span class="hljs-params">mergeRequest</span>.<span class="hljs-params">onlyExpungeDeletes</span>()</span>));<br>        mergeRequest.flush(request.param<span class="hljs-constructor">AsBoolean(<span class="hljs-string">&quot;flush&quot;</span>, <span class="hljs-params">mergeRequest</span>.<span class="hljs-params">flush</span>()</span>));<br>        <span class="hljs-keyword">if</span> (request.param<span class="hljs-constructor">AsBoolean(<span class="hljs-string">&quot;wait_for_completion&quot;</span>, <span class="hljs-params">true</span>)</span>) &#123;<br>            return channel -&gt; client.admin<span class="hljs-literal">()</span>.indices<span class="hljs-literal">()</span>.force<span class="hljs-constructor">Merge(<span class="hljs-params">mergeRequest</span>, <span class="hljs-params">new</span> RestToXContentListener&lt;&gt;(<span class="hljs-params">channel</span>)</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            mergeRequest.set<span class="hljs-constructor">ShouldStoreResult(<span class="hljs-params">true</span>)</span>;<br>            <span class="hljs-comment">/*</span><br><span class="hljs-comment">             * Let&#x27;s try and validate before forking so the user gets some error. The</span><br><span class="hljs-comment">             * task can&#x27;t totally validate until it starts but this is better than</span><br><span class="hljs-comment">             * nothing.</span><br><span class="hljs-comment">             */</span><br>            ActionRequestValidationException validationException = mergeRequest.validate<span class="hljs-literal">()</span>;<br>            <span class="hljs-keyword">if</span> (validationException != null) &#123;<br>                throw validationException;<br>            &#125;<br>            final var responseFuture = <span class="hljs-keyword">new</span> ListenableActionFuture&lt;ForceMergeResponse&gt;<span class="hljs-literal">()</span>;<br>            final var task = client.execute<span class="hljs-constructor">Locally(ForceMergeAction.INSTANCE, <span class="hljs-params">mergeRequest</span>, <span class="hljs-params">responseFuture</span>)</span>;<br>            responseFuture.add<span class="hljs-constructor">Listener(<span class="hljs-params">new</span> LoggingTaskListener&lt;&gt;(<span class="hljs-params">task</span>)</span>);<br>            return send<span class="hljs-constructor">Task(<span class="hljs-params">client</span>.<span class="hljs-params">getLocalNodeId</span>()</span>, task);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>持久化流程总结: 任务开始执行 -&gt; 判断是否需要持久化(部分请求 and wait_for_completion&#x3D;false) -&gt; 如果需要持久化就创建监听事件 -&gt; 任务直接完成广播事件 -&gt; 触发持久化 -&gt; 构建文档 -&gt; 写入index(名称tasks)</p><h4 id="等待"><a href="#等待" class="headerlink" title="等待"></a>等待</h4><p>wait_for_completion这个参数的意思是是否等待任务完成，等待的方法在也在taskManager中实现<br>这里逻辑是在timeout时间内不段的取tasks列表和cancellableTasks列表中去获取对应的task, 如果能获取到task就说明，任务还没有完成(因为任务完成会注销task，会从对应的列表中移除task), 任务没有完成就让线程休眠100毫秒, 然后不能获取到，就说明任务已经完成</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> waitForTaskCompletion(<span class="hljs-keyword">Task</span> <span class="hljs-keyword">task</span>, <span class="hljs-keyword">long</span> untilInNanos) &#123;<br>    <span class="hljs-keyword">while</span> (System.nanoTime() - untilInNanos &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">if</span> (getTask(<span class="hljs-keyword">task</span>.getId()) == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(WAIT_FOR_COMPLETION_POLL.millis());<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ElasticsearchException(<span class="hljs-string">&quot;Interrupted waiting for completion of [&#123;&#125;]&quot;</span>, e, <span class="hljs-keyword">task</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ElasticsearchTimeoutException(<span class="hljs-string">&quot;Timed out waiting for completion of [&#123;&#125;]&quot;</span>, <span class="hljs-keyword">task</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">Task</span> getTask(<span class="hljs-keyword">long</span> id) &#123;<br>    <span class="hljs-keyword">Task</span> <span class="hljs-keyword">task</span> = tasks.get(id);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">task</span> != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">task</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> getCancellableTask(id);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> CancellableTask getCancellableTask(<span class="hljs-keyword">long</span> id) &#123;<br>    CancellableTaskHolder holder = cancellableTasks.get(id);<br>    <span class="hljs-keyword">if</span> (holder != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> holder.getTask();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><p>查询task， 我们调用Get &#x2F;_tasks方法能获取到全部tasks, 这里其实所有tasks都在存在中，所以直接将内存的中对象返回就行。这里因为任务完成会注销task， 所有这里获取到的就正在执行中的task</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public Map&lt;Long, Task&gt; get<span class="hljs-constructor">Tasks()</span> &#123;<br>    HashMap&lt;Long, Task&gt; taskHashMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(this.tasks);<br>    <span class="hljs-keyword">for</span> (CancellableTaskHolder holder : cancellableTasks.values<span class="hljs-literal">()</span>) &#123;<br>        taskHashMap.put(holder.get<span class="hljs-constructor">Task()</span>.get<span class="hljs-constructor">Id()</span>, holder.get<span class="hljs-constructor">Task()</span>);<br>    &#125;<br>    return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collections</span>.</span></span>unmodifiable<span class="hljs-constructor">Map(<span class="hljs-params">taskHashMap</span>)</span>;<br>&#125;<br><br>public Map&lt;Long, CancellableTask&gt; get<span class="hljs-constructor">CancellableTasks()</span> &#123;<br>    HashMap&lt;Long, CancellableTask&gt; taskHashMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;<span class="hljs-literal">()</span>;<br>    <span class="hljs-keyword">for</span> (CancellableTaskHolder holder : cancellableTasks.values<span class="hljs-literal">()</span>) &#123;<br>        taskHashMap.put(holder.get<span class="hljs-constructor">Task()</span>.get<span class="hljs-constructor">Id()</span>, holder.get<span class="hljs-constructor">Task()</span>);<br>    &#125;<br>    return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collections</span>.</span></span>unmodifiable<span class="hljs-constructor">Map(<span class="hljs-params">taskHashMap</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Persistent-Task"><a href="#Persistent-Task" class="headerlink" title="Persistent Task"></a>Persistent Task</h4><p>ES中还有一种被称为持久性任务(persistent task)的任务，这些任务通常是长期存在的任务，并存储在集群state中，允许在集群完全重新启动后恢复任务。每次创建持久性任务时，主节点负责将任务分配给集群的其他节点，然后分配的节点将获取任务并在本地执行。将持久性任务分配给节点的过程由以下属性控制，这些属性可以动态更新：</p><ul><li>cluster.persistent_tasks.allocation.enable，启用或禁用持久任务的分配：<ul><li>all -（默认）允许将持久性任务分配给节点</li><li>none - 不允许为任何类型的持久性任务分配</li></ul></li></ul><p>此设置不会影响已执行的持久性任务。只有新创建的持久性任务或必须重新分配的任务（例如，在节点离开集群之后）才受此设置的影响</p><ul><li>cluster.persistent_tasks.allocation.recheck_interval，当集群状态发生显著变化时，主节点将自动检查是否需要分配持久性任务。但是，可能还有其他因素（例如内存使用）影响持久性任务是否可以分配给节点，但不会导致集群状态更改。此设置控制执行分配检查以响应这些因素的频率，默认值为30秒，最小允许值为10秒</li></ul><p>持久性任务不用自己创建，只能有插件创建，有自己的执行逻辑和执行位置，这里用的不多，不做详细介绍</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>Elasticsearch中几乎所有的事情都是一项任务（搜索、索引操作、节点统计请求）</li><li>一些任务在后台运行，并将它们的状态同步到.tasks这样的专用索引中</li><li>有些任务不是从外部触发的，这些都是持久的任务</li><li>可以通过api获取到task的信息</li><li>可以通过api取消task的执行</li><li>请求被处理之前会注册task，请求结束后会注销task</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>大数据</tag>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「Nomad」nomad学习笔记: 1 nomad环境部署</title>
    <link href="/2023/08/05/%E3%80%8CNomad%E3%80%8Dnomad%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1-nomad%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/08/05/%E3%80%8CNomad%E3%80%8Dnomad%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1-nomad%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<p>nomad 是一个灵活的对应用进行部署、调度、管理，用于跨本地和云大规模部署和管理容器和非容器化应用程序。（个人理解类似K8S，不过比较轻量，管理部署微服务，镜像等）</p><h3 id="nomad-必要组成"><a href="#nomad-必要组成" class="headerlink" title="nomad 必要组成"></a>nomad 必要组成</h3><p>server: nomad的服务端管理进程，用于管理所有的nomad的机器，负责将job、ctask等下发给client端</p><p>client: 一个nomad集群由多个client，client用于负载执行server端下发的job，已即部署应用的节点</p><h3 id="nomad-安装"><a href="#nomad-安装" class="headerlink" title="nomad 安装"></a>nomad 安装</h3><p>nomad 安装比较简单</p><h6 id="第一步，下载nomad的二进制文件-下载地址如下"><a href="#第一步，下载nomad的二进制文件-下载地址如下" class="headerlink" title="第一步，下载nomad的二进制文件, 下载地址如下"></a>第一步，下载nomad的二进制文件, 下载地址如下</h6><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>developer.hashicorp.com<span class="hljs-regexp">/nomad/</span>downloads<br></code></pre></td></tr></table></figure><h6 id="第二步，下载后解压，配置环境变量"><a href="#第二步，下载后解压，配置环境变量" class="headerlink" title="第二步，下载后解压，配置环境变量"></a>第二步，下载后解压，配置环境变量</h6><h6 id="第三步，-验证安装"><a href="#第三步，-验证安装" class="headerlink" title="第三步， 验证安装"></a>第三步， 验证安装</h6><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">nomad</span> -v<br><br><span class="hljs-comment">//显示</span><br><span class="hljs-symbol">Nomad</span> <span class="hljs-built_in">v1</span>.<span class="hljs-number">6</span>.<span class="hljs-number">1</span><br><span class="hljs-symbol">BuildDate</span> <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">21</span>T13:<span class="hljs-number">49</span>:<span class="hljs-number">42</span>Z<br><span class="hljs-symbol">Revision</span> <span class="hljs-number">515895</span>c7690cdc72278018dc5dc58aca41204ccc<br></code></pre></td></tr></table></figure><h3 id="启动server端"><a href="#启动server端" class="headerlink" title="启动server端"></a>启动server端</h3><p>nomad 主要有两个进程server和client， 这里先启动server端<br>新建文件夹 nomad, 并新建文件 server.nomad, 内容如下:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;server1&quot;</span><br><br>log_level <span class="hljs-operator">=</span> <span class="hljs-string">&quot;DEBUG&quot;</span><br><br>data_dir <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/Users/liguifa/nomad&quot;</span><br><br>server &#123;<br>    enabled <span class="hljs-operator">=</span> true<br>    bootstrap_expect <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>&#125;<br><br>ports &#123;<br>  http <span class="hljs-operator">=</span> <span class="hljs-number">4646</span><br>  rpc  <span class="hljs-operator">=</span> <span class="hljs-number">4647</span><br>  serf <span class="hljs-operator">=</span> <span class="hljs-number">4648</span><br>&#125;<br></code></pre></td></tr></table></figure><p>其中:<br>name 指定server的名称为server1<br>log_level 指定日志的输出类型为debug<br>data_dir 指定nomad对应的数据存储文件夹，这里需要调整成对应的目录<br>ports 指定server的端口</p><p>文件修改好之后，使用命令启动server</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">nomad agent -config <span class="hljs-regexp">/Users/</span>liguifa<span class="hljs-regexp">/nomad/</span>conf/server.name<br></code></pre></td></tr></table></figure><p>启动完成后可使用下面地址访问nomad的管理页面</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">4646</span><br></code></pre></td></tr></table></figure><h3 id="启动client"><a href="#启动client" class="headerlink" title="启动client"></a>启动client</h3><p>在文件夹 nomad 中新建文件 cient.nomad, 内容如下:</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs makefile">name = <span class="hljs-string">&quot;client1&quot;</span><br><br><span class="hljs-comment"># Increase log verbosity</span><br>log_level = <span class="hljs-string">&quot;DEBUG&quot;</span><br><br><span class="hljs-comment"># Setup data dir</span><br>data_dir = <span class="hljs-string">&quot;/Users/liguifa/nomad&quot;</span><br><br><span class="hljs-comment"># Enable the client</span><br>client &#123;<br>enabled = true<br><br><span class="hljs-comment"># For demo assume we are talking to server1. For production,</span><br><span class="hljs-comment"># this should be like &quot;nomad.service.consul:4647&quot; and a system</span><br><span class="hljs-comment"># like Consul used for service discovery.</span><br>servers = [<span class="hljs-string">&quot;192.168.2.101:4647&quot;</span>]<br><br>options &#123;<br>    <span class="hljs-string">&quot;driver.raw_exec.enable&quot;</span> = <span class="hljs-string">&quot;1&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># Modify our port to avoid a collision with server1</span><br>ports &#123;<br>http = 5656<br>&#125;<br><br>datacenter = <span class="hljs-string">&quot;release&quot;</span><br></code></pre></td></tr></table></figure><p>其中<br>name 指定client的名称是client1<br>servers 指定需要连接的server地址，已即是上一步中启动的server</p><p>文件修改好之后，使用下面命令启动client</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">nomad agent -config <span class="hljs-regexp">/Users/</span>liguifa<span class="hljs-regexp">/nomad/</span>conf/client.nomad<br></code></pre></td></tr></table></figure><h3 id="启动job"><a href="#启动job" class="headerlink" title="启动job"></a>启动job</h3><p>server和client都启动完成后，我们就可以启动job了<br>新建文件job.name，内容如下</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs abnf">job <span class="hljs-string">&quot;cron&quot;</span> &#123;<br>    datacenters <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;release&quot;</span>]<br>    type <span class="hljs-operator">=</span> <span class="hljs-string">&quot;batch&quot;</span><br>    group <span class="hljs-string">&quot;test&quot;</span> &#123;<br>        count <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>        task <span class="hljs-string">&quot;one&quot;</span> &#123;<br>            driver <span class="hljs-operator">=</span> <span class="hljs-string">&quot;raw_exec&quot;</span><br>            config &#123;<br>                command <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/bin/sleep&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>文件修改好之后，使用下面命令启动</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">nomad job run <span class="hljs-regexp">/Users/</span>liguifa<span class="hljs-regexp">/nomad/</span>conf/job.nomad<br></code></pre></td></tr></table></figure><p>任务启动后我们就能在管理页面上看到我们的任务</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>nomad的环境部署比较简单，总结来说就是先启动server, 然后启动client，之后我们便可提交job，三步执行之后便实现了如下效果<br><img src="/2023/08/05/%E3%80%8CNomad%E3%80%8Dnomad%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1-nomad%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/20230805.png"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Nomad</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「ElasticSearch」Kibana Timelion语法函数总结</title>
    <link href="/2023/07/29/%E3%80%8CElasticSearch%E3%80%8DKibana-Timelion%E8%AF%AD%E6%B3%95%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/"/>
    <url>/2023/07/29/%E3%80%8CElasticSearch%E3%80%8DKibana-Timelion%E8%AF%AD%E6%B3%95%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>工作中需要在Kibana上做图，但是对kibana上使用的Timelion语法一知半解的，遇到问题总数很难解决，故总结一下Timelion里面的函数，还可以给其它网友做个参考, 信息来自<a href='https://github.com/elastic/timelion/blob/master/FUNCTIONS.md' target='_blank'>官方文档</a></p><h3 id="es-或elasticsearch"><a href="#es-或elasticsearch" class="headerlink" title="es(或elasticsearch)"></a>es(或elasticsearch)</h3><p>从ElastSearch中提取数据, Timelion函数始终以点开始，后跟函数名称，后跟括号，其中包含函数的所有参数<br>参数:</p><ul><li>q: es的查询语句</li><li>metric: 值必须是一个聚合函数，后跟一个冒号，后跟一个字段名, 需要展示的指标字段</li><li>split: 值必须是一个字段名，后跟一个冒号，后跟一个数字值,提取指定字段的前n个值</li><li>index: 要查询的索引名称, 如果为空则查询高级设置中的es.default_index</li><li>timefield: 时间戳字段, 如果空则使用高级设置中的es.timefield</li><li>offset: 时间偏移，offset&#x3D;-1h 往前偏移一小时</li><li>kibana: 尊重Kibana仪表板上的过滤器。只有在Kibana仪表板上使用时才有效果, 布尔值, true&#x2F;false</li><li>fit: 用于将序列拟合到目标时间跨度和间隔的算法, 填充空值<ul><li>average: 用空值边上的两个值取平均数1</li><li>carry: 在空值边上的两个点处上升或下降</li><li>none: 在空值边上的两个点的中间位置上升或下降</li><li>nearest: 使用距离最近的点的值</li><li>scale: 直接将附件的两个点直接连接</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">fit</span>=<span class="hljs-string">&#x27;none&#x27;</span><br>)<br></code></pre></td></tr></table></figure><h3 id="static-或value"><a href="#static-或value" class="headerlink" title="static(或value)"></a>static(或value)</h3><p>以静态值作为数据源输入<br>参数:</p><ul><li>value: 要显示的单个值，您也可以传递多个值，它将在您的时间范围内均匀地对它们进行显示</li><li>label: 显示的标签</li></ul><p>示例:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">.<span class="hljs-keyword">static</span>(<span class="hljs-number">10</span>, <span class="hljs-string">&quot;测试&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="graphite"><a href="#graphite" class="headerlink" title="graphite"></a>graphite</h3><p>从graphite中提取数据。在timelion.json中配置石墨服务器<br>参数: </p><ul><li>metric: 一个字段名, 需要展示的指标字段</li><li>offset: 时间偏移，offset&#x3D;-1h 往前偏移一小时</li><li>fit: 用于将序列拟合到目标时间跨度和间隔的算法, 填充空值<ul><li>average: 用空值边上的两个值取平均数1</li><li>carry: 在空值边上的两个点处上升或下降</li><li>none: 在空值边上的两个点的中间位置上升或下降</li><li>nearest: 使用距离最近的点的值</li><li>scale: 直接将附件的两个点直接连接</li></ul></li></ul><p>示例:</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell">.graphite(metric=&#x27;_test-<span class="hljs-class"><span class="hljs-keyword">data</span>.users.*.<span class="hljs-keyword">data</span>&#x27;)</span><br></code></pre></td></tr></table></figure><h3 id="quandl"><a href="#quandl" class="headerlink" title="quandl"></a>quandl</h3><p>使用quandl代码从quandl.com中提取数据。将您的免费API密钥放在timelion.json中。API在没有密钥的情况下是受费率限制的<br>参数:</p><ul><li>code: 要绘制的quandl代码。你可以在quandl.com上找到这些</li><li>position: 需要展示的列序号</li><li>offset: 时间偏移，offset&#x3D;-1h 往前偏移一小时</li><li>fit: 用于将序列拟合到目标时间跨度和间隔的算法, 填充空值<ul><li>average: 用空值边上的两个值取平均数1</li><li>carry: 在空值边上的两个点处上升或下降</li><li>none: 在空值边上的两个点的中间位置上升或下降</li><li>nearest: 使用距离最近的点的值</li><li>scale: 直接将附件的两个点直接连接</li></ul></li></ul><p>示例:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-title">.quandl()</span><br></code></pre></td></tr></table></figure><h3 id="worldbank-indicators"><a href="#worldbank-indicators" class="headerlink" title="worldbank_indicators"></a>worldbank_indicators</h3><p>从中提取数据 <a href="http://data.worldbank.org/">http://data.worldbank.org</a> 使用国家名称和指示符。世界银行主要提供年度数据，通常没有当年的数据。如果您没有得到最近时间范围的数据，请尝试偏移量&#x3D;-1y。<br>参数: </p><ul><li>country: 世界银行国家标识符，通常是国家的2个字母代码</li><li>indicator: 要展示的指标, 可以再data.worldbank.org上查询, 例如SP.POP.TOTL是人口</li><li>offset: 时间偏移，offset&#x3D;-1h 往前偏移一小时</li><li>fit: 用于将序列拟合到目标时间跨度和间隔的算法, 填充空值<ul><li>average: 用空值边上的两个值取平均数1</li><li>carry: 在空值边上的两个点处上升或下降</li><li>none: 在空值边上的两个点的中间位置上升或下降</li><li>nearest: 使用距离最近的点的值</li><li>scale: 直接将附件的两个点直接连接</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.worldbank_indicators(<br>    <span class="hljs-attribute">country</span>=GH,<br>    <span class="hljs-attribute">indicator</span>=<span class="hljs-string">&quot;VC.IHR.PSRC.P5&quot;</span><br>)<br></code></pre></td></tr></table></figure><h3 id="worldbank"><a href="#worldbank" class="headerlink" title="worldbank"></a>worldbank</h3><p>从中提取数据 <a href="http://data.worldbank.org/">http://data.worldbank.org</a> 世界银行主要提供年度数据，通常没有当年的数据。如果您没有得到最近时间范围的数据，请尝试偏移量&#x3D;-1y。<br>参数: </p><ul><li>code: 世界银行API路径。这通常是域之后、querystring之前的所有内容。例如：&#x2F;en&#x2F;国家&#x2F;ind；chn&#x2F;indicators&#x2F;DPANUSSPF。</li><li>offset: 时间偏移，offset&#x3D;-1h 往前偏移一小时</li><li>fit: 用于将序列拟合到目标时间跨度和间隔的算法, 填充空值<ul><li>average: 用空值边上的两个值取平均数1</li><li>carry: 在空值边上的两个点处上升或下降</li><li>none: 在空值边上的两个点的中间位置上升或下降</li><li>nearest: 使用距离最近的点的值</li><li>scale: 直接将附件的两个点直接连接</li></ul></li></ul><p>示例:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.worldbank</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-attr">code</span>=&#x27;/indicator/VC.IHR.PSRC.P5?<span class="hljs-attr">locations</span>=BT-GH&#x27;</span><br><span class="hljs-params">)</span><br></code></pre></td></tr></table></figure><h3 id="abs"><a href="#abs" class="headerlink" title="abs"></a>abs</h3><p>返回序列列表中每个值的绝对值<br>参数: 无<br>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.abs()<br></code></pre></td></tr></table></figure><h3 id="add-或plus-或sum"><a href="#add-或plus-或sum" class="headerlink" title="add(或plus 或sum)"></a>add(或plus 或sum)</h3><p>将seriesList中的一个或多个系列的值添加到每个系列的每个位置<br>参数:</p><ul><li>term: 将被叠加的值<ul><li>number: 一个固定的数字</li><li>seriesList: 将另一个seriesList同叠加当前seriesList</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.<span class="hljs-built_in">add</span>(1993)<br><br>.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.<span class="hljs-built_in">add</span>(<br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>    )<br>)<br></code></pre></td></tr></table></figure><h3 id="aggregate"><a href="#aggregate" class="headerlink" title="aggregate"></a>aggregate</h3><p>根据处理序列中所有点的结果创建静态线<br>参数:</p><ul><li>function: 使用一个函数<ul><li>avg: 平均值</li><li>cardinality: 基数</li><li>min: 最小值</li><li>max: 最大值</li><li>last: 最后值</li><li>first: 第一个值</li><li>sum: 累计值</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.<span class="hljs-built_in">add</span>(<br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>    )<br>)<br>.aggregate(cardinality)<br></code></pre></td></tr></table></figure><h3 id="bars"><a href="#bars" class="headerlink" title="bars"></a>bars</h3><p>将图表显示为条形图<br>参数:</p><ul><li>width: 条形图的宽度<ul><li>number: 一个数据，指示条形图多宽</li><li>null: 空值, 自适应</li></ul></li><li>stack:  是否堆叠<ul><li>bool: 布尔值, 表示是否</li><li>null: 空值, 自适应</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.<span class="hljs-built_in">add</span>(<br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>    )<br>)<br>.bars(100)<br></code></pre></td></tr></table></figure><h3 id="color"><a href="#color" class="headerlink" title="color"></a>color</h3><p>更改图表的颜色<br>参数:</p><ul><li>color: 需要更改到的颜色<ul><li>rgb: 用rgb表示颜色, 例: #44ff33</li><li>string: 用颜色英文名, 例: red</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.<span class="hljs-built_in">add</span>(<br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>    )<br>)<br>.bars(100)<br>.color(#ff0000)<br></code></pre></td></tr></table></figure><h3 id="cusum"><a href="#cusum" class="headerlink" title="cusum"></a>cusum</h3><p>返回从基数开始的序列的累计和, 在特定时间点的值是所有先前点的值累计得到, 累计和仅从图形的开始时间计算<br>参数:</p><ul><li>base: 指定基数<ul><li>number: 一个数字作为基数</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.cusum(100)<br></code></pre></td></tr></table></figure><h3 id="derivative"><a href="#derivative" class="headerlink" title="derivative"></a>derivative</h3><p>计算时间序列的导数，即曲线的斜率<br>参数: 无<br>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.derivative()<br></code></pre></td></tr></table></figure><h3 id="divide"><a href="#divide" class="headerlink" title="divide"></a>divide</h3><p>将seriesList中一个或多个系列的值除以输入系列List中每个系列的每个位置<br>参数:</p><ul><li>divisor: 除数<ul><li>seriesList: 一个list作为除数</li><li>number: 一个固定的数字作为除数</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.divide(  <br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>    )<br>)<br></code></pre></td></tr></table></figure><h3 id="fit"><a href="#fit" class="headerlink" title="fit"></a>fit</h3><p>用一个拟合数字来填充空值<br>参数:</p><ul><li>fit: 用于将序列拟合到目标时间跨度和间隔的算法, 填充空值<ul><li>average: 用空值边上的两个值取平均数1</li><li>carry: 在空值边上的两个点处上升或下降</li><li>none: 在空值边上的两个点的中间位置上升或下降</li><li>nearest: 使用距离最近的点的值</li><li>scale: 直接将附件的两个点直接连接</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>)<br>.divide(  <br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span>,<br>    )<br>)<br>.fit(scale)<br></code></pre></td></tr></table></figure><h3 id="hide"><a href="#hide" class="headerlink" title="hide"></a>hide</h3><p>设置图标数据是否隐藏<br>参数:</p><ul><li>hide: 是否隐藏<ul><li>bool: true&#x2F;false<br>_   null: 默认 true<br>示例:<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>)<br>.hide(<span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="holt"><a href="#holt" class="headerlink" title="holt"></a>holt</h3><p>使用开头的几个数据，预测未来的数据趋势。即预测还未发送的时间的数据<br>参数:</p><ul><li>alpha: 将权重从0平滑到1。增加alpha将使新系列更接近原始系列。降低它将使序列更平滑</li><li>beta: 趋势权重从0到1。增加贝塔系数将使上升&#x2F;下降线持续上升&#x2F;下降的时间更长。降低它将使函数更快地了解新趋势</li><li>gamma: 季节性重量从0到1。你的数据看起来像波浪吗？增加这个值将使最近的季节更加重要，从而更快地改变波形。降低它将降低新赛季的重要性，使历史变得更加重要</li><li>season: 季节有多长，例如，如果你的模式每周重复一次，则为1w</li><li>sample: 季节序列中开始“预测”之前要采样的季节数</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>),<br>.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.holt(0.9, 0.1, 0.9, 0.5h)<br></code></pre></td></tr></table></figure><h3 id="if-或condition"><a href="#if-或condition" class="headerlink" title="if(或condition)"></a>if(或condition)</h3><p>对数据进行if表达式测试，如果通过使用某一个值，否则使用另一个值<br>参数:</p><ul><li>operator: 判断表达式<ul><li>lt: 小于</li><li>lte: 小于等于</li><li>eq: 等于</li><li>gt: 大于</li><li>gte: 大于等于</li></ul></li><li>if: 判断值， &gt; xxx 里面的xxx</li><li>then: 如果满足条件，则使用这个值</li><li>else: 如果不满足调整，则使用这个值</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>)<br>.<span class="hljs-keyword">if</span>(lt, 10000000, 20, 30)<br></code></pre></td></tr></table></figure><h3 id="label"><a href="#label" class="headerlink" title="label"></a>label</h3><p>更改序列的标签。使用$引用现有标签<br>参数:</p><ul><li>label: 显示标签的文字<ul><li>string: 一个固定的字符串</li><li>$1: 取正则表达式里面的分组</li></ul></li><li>regex: 正则表达式</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>)<br>.label(<span class="hljs-string">&quot;测试&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="legend"><a href="#legend" class="headerlink" title="legend"></a>legend</h3><p>设置图例在绘图上的位置和样式<br>参数:</p><ul><li>position: 图例的位置<ul><li>nw: 左上角</li><li>ne: 右上角</li><li>se: 右下角</li><li>sw: 左下角</li><li>false: 隐藏图例</li></ul></li><li>columns: 每一行多少列</li><li>showTime: 是否显示时间(在图标中滑动可以查询当前点时间), 是否可选择隐藏显示分组数据</li><li>timeFormat: 时间格式, <a href='https://momentjs.com/docs/#/displaying/format' target="_blank">格式查看这里</a></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.legend(nw, 4, <span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure><h3 id="lines"><a href="#lines" class="headerlink" title="lines("></a>lines(</h3><p>将seriesList显示为折线图<br>参数:</p><ul><li>width: 线条粗细</li><li>fill: 数字介于0和10之间，用于制作面积图, 数值表示颜色深度</li><li>stack: 是否将线条显示未堆叠图</li><li>show: 是否显示线条</li><li>steps: 步长, 例如，点之间不要有数据</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.lines(1.2, 2, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, 200)<br></code></pre></td></tr></table></figure><h3 id="log"><a href="#log" class="headerlink" title="log"></a>log</h3><p>叫数据列表中的数据计算对数<br>参数:</p><ul><li>base: 对数的基数, 即log2 里面的2</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.log(2)<br></code></pre></td></tr></table></figure><h3 id="max"><a href="#max" class="headerlink" title="max"></a>max</h3><p>将点的现有值与传递值比较，取其中较大的值<br>参数:</p><ul><li>value: 传递的将要比较的值<ul><li>number: 与一个固定的数字进行比较</li><li>seriesList: 与一个时间序列比较，对应点的数据进行比较</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.max(20)<br></code></pre></td></tr></table></figure><h3 id="min"><a href="#min" class="headerlink" title="min"></a>min</h3><p>将点的现有值与传递值比较，取其中较小的值<br>参数:</p><ul><li>value: 传递的将要比较的值<ul><li>number: 与一个固定的数字进行比较</li><li>seriesList: 与一个时间序列比较，对应点的数据进行比较</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.min(20)<br></code></pre></td></tr></table></figure><h3 id="multiply"><a href="#multiply" class="headerlink" title="multiply"></a>multiply</h3><p>将seriesList中一个或多个系列的值乘以输入系列List中每个系列的每个位置<br>参数:</p><ul><li>multiplier: 除数<ul><li>seriesList: 一个list作为乘数</li><li>number: 一个固定的数字作为乘数</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.multiply(  <br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>    )<br>)<br></code></pre></td></tr></table></figure><h3 id="mvavg"><a href="#mvavg" class="headerlink" title="mvavg"></a>mvavg</h3><p>计算给定窗口上的移动平均值<br>参数:</p><ul><li>window: 时间窗口长度<ul><li>string: 1d, 1m 等日期数学表达式</li><li>number: 平均值的点数</li></ul></li><li>position: 时间窗口的位置<ul><li>left: 时间窗口在点的左边</li><li>right: 时间窗口在点的右边</li><li>center: 时间窗口居中</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.mvavg(2m, right)<br></code></pre></td></tr></table></figure><h3 id="mvstd"><a href="#mvstd" class="headerlink" title="mvstd"></a>mvstd</h3><p>计算给定窗口上的移动标准偏差。使用朴素的两步算法<br>参数:</p><ul><li>window: 时间窗口长度<ul><li>number: 平均值的点数</li></ul></li><li>position: 时间窗口的位置<ul><li>left: 时间窗口在点的左边</li><li>right: 时间窗口在点的右边</li><li>center: 时间窗口居中</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.mvstd(5, right)<br></code></pre></td></tr></table></figure><h3 id="points"><a href="#points" class="headerlink" title="points"></a>points</h3><p>将图标显示成点状图<br>参数:</p><ul><li>radius: 点的半径大小</li><li>weight: 点线的宽度</li><li>fill: 点填充的不透明度，0到10</li><li>fillColor: 填充的颜色, rgb值</li><li>symbol: 点的形状<ul><li>triangle: 三角形</li><li>cross: 十字形</li><li>square: 正方形</li><li>diamond: 菱形</li><li>circle: 圆形</li></ul></li><li>show: 是否显示点状图</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.points(10, 1, 5, #f4f4f4, cross, <span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure><h3 id="precision"><a href="#precision" class="headerlink" title="precision"></a>precision</h3><p>保留小数的位数，四舍五入<br>参数:</p><ul><li>precision: 要保留的位数</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.precision(2)<br></code></pre></td></tr></table></figure><h3 id="range"><a href="#range" class="headerlink" title="range"></a>range</h3><p>更改序列中的最大值和最小值<br>参数:</p><ul><li>min: 最小值</li><li>max: 最大值</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.range(2, 5)<br></code></pre></td></tr></table></figure><h3 id="scale-interval"><a href="#scale-interval" class="headerlink" title="scale_interval"></a>scale_interval</h3><p>将值计算为频率，byte&#x2F;s 这种数据<br>参数:</p><ul><li>interval: 时间间隔, 例如: e.g., 1s, 1m, 5m, 1w, 1M, 1y</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.scale_interval(20m)<br></code></pre></td></tr></table></figure><h3 id="subtract"><a href="#subtract" class="headerlink" title="subtract"></a>subtract</h3><p>将seriesList中一个或多个系列的值减去输入系列List中每个系列的每个位置<br>参数:</p><ul><li>term: 除数<ul><li>seriesList: 一个list作为减数</li><li>number: 一个固定的数字作为减数</li></ul></li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.subtract(  <br>    .es(<br>        <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>        <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>        <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>    )<br>)<br></code></pre></td></tr></table></figure><h3 id="title"><a href="#title" class="headerlink" title="title:"></a>title:</h3><p>在图标的顶部显示一个标题<br>参数:</p><ul><li>title: 标题内容</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>    <span class="hljs-attribute">split</span>=<span class="hljs-string">&#x27;http_code:4&#x27;</span><br>)<br>.title(<span class="hljs-string">&quot;测试&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="trend"><a href="#trend" class="headerlink" title="trend"></a>trend</h3><p>使用指定的回归算法绘制趋势线<br>参数:</p><ul><li>mode: 指定算法<ul><li>linear: 线型</li><li>log: 对数</li></ul></li><li>start: 开始位置不计算的点数, 正数, 例如 +15</li><li>end: 结束位置不计算的点数, 负数, 例如 -15</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>),<br>.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.trend(log, 2, -3)<br></code></pre></td></tr></table></figure><h3 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h3><p>将系列开始或结束处的N个桶设置为空<br>参数:</p><ul><li>start: 开始位置置空的点的个数</li><li>end: 结束位置置空的点的个数</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.trim(10, 2)<br></code></pre></td></tr></table></figure><h3 id="yaxis"><a href="#yaxis" class="headerlink" title="yaxis"></a>yaxis</h3><p>配置各种y轴选项，最重要的可能是能够添加第N个（例如第2个）y轴<br>参数:</p><ul><li>position: y轴的位置, left和right</li><li>color: y轴的标签的颜色</li><li>label: y轴的标签</li><li>min: y轴的最小值</li><li>max: y轴的最大值</li><li>tickDecimals: y轴刻度的小数位数</li><li>units: y轴刻度的单位, bits&#x2F;s, bytes, bytes&#x2F;s, currency(:ISO 4217 currency code), percent, custom(:prefix:suffix)</li><li>yaxis: y轴的1编号，可以绘制多个y轴, 如果不绘制多个.es，则无意义</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span><br>)<br>.yaxis(<br>    <span class="hljs-attribute">position</span>=right,<br>    <span class="hljs-attribute">color</span>=red,<br>    <span class="hljs-attribute">min</span>=10,<br>    <span class="hljs-attribute">max</span>=200000,<br>    <span class="hljs-attribute">label</span>=<span class="hljs-string">&#x27;测试&#x27;</span>,<br>    <span class="hljs-attribute">tickDecimals</span>=2,<br>    <span class="hljs-attribute">units</span>=percent,<br>    <span class="hljs-attribute">yaxis</span>=1<br>),<br>.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:req_num&#x27;</span><br>)<br>.yaxis(<br>    <span class="hljs-attribute">position</span>=left,<br>    <span class="hljs-attribute">color</span>=blue,<br>    <span class="hljs-attribute">min</span>=-10,<br>    <span class="hljs-attribute">max</span>=2000,<br>    <span class="hljs-attribute">label</span>=<span class="hljs-string">&#x27;测试2&#x27;</span>,<br>    <span class="hljs-attribute">tickDecimals</span>=2,<br>    <span class="hljs-attribute">yaxis</span>=2<br>)<br></code></pre></td></tr></table></figure><h3 id="props"><a href="#props" class="headerlink" title="props"></a>props</h3><p>设置系列的任意属性<br>参数:</p><ul><li>global: 设置任意属性</li></ul><p>示例:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">.es(<br>    <span class="hljs-attribute">index</span>=<span class="hljs-string">&#x27;bigdata-hostlog-squid-*&#x27;</span>, <br>    <span class="hljs-attribute">timefield</span>=<span class="hljs-string">&#x27;timestamp&#x27;</span>,<br>    <span class="hljs-attribute">metric</span>=<span class="hljs-string">&#x27;sum:time_response&#x27;</span>,<br>)<br>.props(<span class="hljs-attribute">label</span>=<span class="hljs-string">&#x27;123&#x27;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>大数据</tag>
      
      <tag>ElasticSearch</tag>
      
      <tag>Kibana</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「ElasticSearch」Trying to create too many scroll contexts. Must be less than or equal to: 500</title>
    <link href="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DTrying-to-create-too-many-scroll-contexts-Must-be-less-than-or-equal-to-500/"/>
    <url>/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DTrying-to-create-too-many-scroll-contexts-Must-be-less-than-or-equal-to-500/</url>
    
    <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>报错Trying to create too many scroll contexts. Must be less than or equal to: [500]. This limit can be set by changing the [search.max_open_scroll_context] setting.&quot;,\n”,”stream”:”stdout”,”time”:”2023-07-27T02:42:13.121156512Z”}</p><h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><h3 id="ES端现象"><a href="#ES端现象" class="headerlink" title="ES端现象"></a>ES端现象</h3><p>bigdata-es后端报错，集群节点反复脱离集群</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs swift">&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;&#123;<span class="hljs-subst">\&quot;</span>type<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>server<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>timestamp<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>2023-07-27T02:42:13,117Z<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>level<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>WARN<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>component<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>r.suppressed<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>cluster.name<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>bigdata-es<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>node.name<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>node-5<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>message<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>path: /bigdata-fusioncdn-%2A/_search, params: &#123;size=10000, scroll=10m, index=bigdata-fusioncdn-*&#125;<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>cluster.uuid<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>fa4e1bPrRBCki8U4WPj6IQ<span class="hljs-subst">\&quot;</span>, <span class="hljs-subst">\&quot;</span>node.id<span class="hljs-subst">\&quot;</span>: <span class="hljs-subst">\&quot;</span>MmQZlAlIRMm8NIR04mCflA<span class="hljs-subst">\&quot;</span> , <span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120708259Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>stacktrace<span class="hljs-subst">\&quot;</span>: [<span class="hljs-subst">\&quot;</span>org.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.12076008Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:713) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120770392Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:400) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120777406Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:745) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120784871Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.search.AbstractSearchAsyncAction.onShardFailure(AbstractSearchAsyncAction.java:497) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120792229Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.search.AbstractSearchAsyncAction.access$000(AbstractSearchAsyncAction.java:64) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120798743Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:331) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120805019Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:66) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120811316Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:48) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120819001Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:651) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120825432Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.TransportService$4.handleException(TransportService.java:853) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120832109Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1481) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120841065Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundHandler.lambda$handleException$3(InboundHandler.java:368) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120847448Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:288) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120853633Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundHandler.handleException(InboundHandler.java:366) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120861163Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundHandler.handlerResponseError(InboundHandler.java:358) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120888266Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundHandler.messageReceived(InboundHandler.java:132) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120894865Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundHandler.inboundMessage(InboundHandler.java:88) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120900812Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:743) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120906642Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundPipeline.forwardFragments(InboundPipeline.java:147) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120912335Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundPipeline.doHandleBytes(InboundPipeline.java:119) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120918135Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.InboundPipeline.handleBytes(InboundPipeline.java:84) [elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120924029Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:71) [transport-netty4-client-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.12093038Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120936377Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120942397Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120948258Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:280) [netty-handler-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120954846Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120960625Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120967072Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120973076Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103) [netty-codec-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120978889Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120984793Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120991038Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.120997054Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1374) [netty-handler-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121008248Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1237) [netty-handler-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121014484Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1286) [netty-handler-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121020506Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:507) [netty-codec-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121037738Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:446) [netty-codec-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121046005Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276) [netty-codec-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121051891Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121058709Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121066525Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121072568Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121078504Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121084638Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121090575Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121096623Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121102472Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121108681Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:620) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.12111462Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:583) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121120917Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) [netty-transport-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121126699Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986) [netty-common-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121132507Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) [netty-common-4.1.66.Final.jar:4.1.66.Final]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121138617Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at java.lang.Thread.run(Thread.java:833) [?:?]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121150102Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>Caused by: org.elasticsearch.ElasticsearchException: Trying to create too many scroll contexts. Must be less than or equal to: [500]. This limit can be set by changing the [search.max_open_scroll_context] setting.<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121156512Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.search.SearchService.createAndPutReaderContext(SearchService.java:881) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121162705Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.search.SearchService.createOrGetReaderContext(SearchService.java:859) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121169163Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:615) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121174973Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:483) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121180971Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:47) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121186902Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:62) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121192724Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121198465Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.1212048Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:777) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121210622Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) ~[elasticsearch-7.17.5.jar:7.17.5]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121219247Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121225215Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121231115Z&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>... 1 more<span class="hljs-subst">\&quot;</span>] &#125;<span class="hljs-subst">\n</span>&quot;</span>,<span class="hljs-string">&quot;stream&quot;</span>:<span class="hljs-string">&quot;stdout&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2023-07-27T02:42:13.121236842Z&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>看报告是存活的游标数据积压了，超过了配置的最大值，而且游标时间设置是10分钟，这个是否合理？询问业务端，业务端反馈查询语句为<br><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DTrying-to-create-too-many-scroll-contexts-Must-be-less-than-or-equal-to-500/ziQWvHza6y4MhyS2bcmTpEncL5xsSJlguBCOq-Qs6Vs.png"><br>通过这条语句，发现业务端的游标设置不合理，这表示执行这条语句时要将此游标保持开启10分钟，到是数据处理仅仅只格式化做下判断，ES中游标保持时间这个值的时间不是整个数据处理的时间，是上一次使用游标到下一次使用游标的时间。因此这个值的时间不能设置太长</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>解决方案：业务端调整过期时间，调整为1秒钟</p>]]></content>
    
    
    
    <tags>
      
      <tag>大数据</tag>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「ElasticSearch」ES内存分布及index加载方式</title>
    <link href="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/"/>
    <url>/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h4 id="1-index内部存储"><a href="#1-index内部存储" class="headerlink" title="1. index内部存储"></a>1. index内部存储</h4><p>ES中一个index由多个shard组成，而一个shard又由多个segment组成，一个segment是一部分document数据，segment中会包含文档、域和词，即一个index按层次结构来看为：索引(index) -&gt; 分片(shard) -&gt; 段(segment) -&gt; 文档(document) -&gt; 域(Field) -&gt; 词(Term)<br><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/YEYjeBD632Kfku1uxoP6EqxOmtFnP1t0DaY6hgyAsRI.jpg"><br>段(segment):<br>数据加载的单元，里面包含倒排索引等数据。当ES 收到数据时，会先将数据放入内存中(index buffer), 当到达指定的时间(index.refresh_interval配置的时间)后写入到segment, 该时间段一次生成一个segment，此时segment存在filesystem cache中，当到达指定的时间(index.translog.sync_interval配置)或指定大小(index.translog.flush_threshold_size配置)后刷新到磁盘。segment在后台自动merge成更大的segment<br><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/pFgm9c6JWO_6U9HAO7rdfSI1lkycJjt2H_77zCxtuHg.png"></p><h4 id="2-ES内存分布"><a href="#2-ES内存分布" class="headerlink" title="2. ES内存分布"></a>2. ES内存分布</h4><p>ES的内存分为堆内内存和堆外内存，其中堆内内存主要是写入缓冲、cache等相关内存，受JVM的GC管理，该部分内存会出现OOM。堆外内存主要是lucene在使用，使用了操作系统的page cache，其大小影响查询性能，堆外内存受操作系统管理，如果操作系统内存不足会释放page cache内存，不会出现OOM问题。<br>细分来看，堆内内存主要有五部分组成：公共内存、fielddata缓存、query缓存、request缓存和segment相关的一些内存。堆外内存主要有两部分：加载segment相关的内存和查询相关的内存。<br><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/79GlWWj0abyzBfUfD7HrvBKvWels5841DTRRYMjXjMw.jpg"></p><h5 id=""><a href="#" class="headerlink" title=""></a></h5><p>common 内存<br>(1) index buffer<br>索引写入缓冲区，用于存储新写入的文档，当其被填满时，缓冲区中的文档被写入磁盘中的 segments 中。节点上所有 shard 共享。这部分空间是可以通过GC被反复利用的。默认大小为堆内存的10%。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">indices<span class="hljs-selector-class">.memory</span><span class="hljs-selector-class">.index_buffer_size</span>: <span class="hljs-number">10%</span><br><span class="hljs-comment">//写入segment的缓冲区大小，到达这个大小会刷盘</span><br>indexing_pressure<span class="hljs-selector-class">.memory</span><span class="hljs-selector-class">.limit</span>: <span class="hljs-number">10%</span><br><span class="hljs-comment">//在处理中的document的大小，大于这个大小会限流，客户端返回429错误</span><br></code></pre></td></tr></table></figure><p>(2) 线程池缓存及队列内存<br>ES使用各种内部有很多线程池，这部分线程池会占用部分内存，分析大约有几百兆<br><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/J2N-ig41aHAJj9_M59O1KJZNxvQqQUeqjR3-Bb7WTv0.png"><br>(3) PageCacheRecycler内存<br>page cache内存回收管理器，通过PageCacheRecycler这个类来管理page cache，内部将内存以页为单位管理和回收，缓存一页大小是16KB，这部分内存记录一些页缓存的信息<br><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/xrKYVZ8Wj4X_FfrgsDVMZv-vrBCbrMzKpVnDh_W1SuQ.png"><br>(4) metadata内存<br>ES的metadata主要包括indexc的mapping、shard信息，这部分内存不大，但是当shard非常多的时候也会变得比较大，metadata在每个节点上都存在一份数据，当有index创建、关闭或删除的时候，metadata都会由master节点更新然后推送到各个节点，所以当shard过多的时候，这个更新推送的过程就会变慢，从而影响es的性能。另外metadata会间隔一段时间持久化一次数据，数据写到磁盘上去，当节点重启后会从磁盘恢复metadata.</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">总结：<span class="hljs-keyword">common</span>内存=<span class="hljs-keyword">index</span> buffer + indexing_pressure.memory + 线程池缓存及队列内存 + PageCacheRecycler内存 + metadata内存 + 其它的一些运行内存<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">indices<span class="hljs-selector-class">.breaker</span><span class="hljs-selector-class">.total</span><span class="hljs-selector-class">.limit</span>: <span class="hljs-number">70%</span><br><span class="hljs-comment">// 父熔断，inflight、request(agg)和fielddata不会使用超过堆内存的 70%  超过这个值报400 Data too large</span><br>network<span class="hljs-selector-class">.breaker</span><span class="hljs-selector-class">.inflight_requests</span><span class="hljs-selector-class">.limit</span>: <span class="hljs-number">100%</span><br><span class="hljs-comment">// 限制请求内容的长度</span><br></code></pre></td></tr></table></figure><h5 id="fielddata-cache"><a href="#fielddata-cache" class="headerlink" title="fielddata cache"></a>fielddata cache</h5><p>这部分内存分为两部分，一部分为fielddata字段的内存，另一部分为全局序数的内存。<br>fielddata字段：在ES写人数据时，当遇到keyword类型的字段时，ES会把字段值插入倒排索引和doc_values中，当做聚合的时候会使用doc_values对值做聚合，但是当遇到text字段的到时候，由于text字段一遍较大，所以ES不会将数据写入doc_values, 这个时候text类型的字段就不知道排序聚合了，为了解决这个问题，ES提供fielddata功能，单独维护一份text类型的数据，这部分数据时加载到内存中的使用fielddata cache，当第一次查询时生成。<br>全局序数：全局序数是跨多个segment的全局字段映射表。ES会在写入数据时对字段生成一个自增的数字，将这个数字个字段存入全局序数中，聚合时用全局序数聚合即可。全局序数存储在fielddata cache中，默认当一次查询时生成，也可在构建数据时候生产。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">indices<span class="hljs-selector-class">.fielddata</span><span class="hljs-selector-class">.cache</span><span class="hljs-selector-class">.size</span>: 默认无上限<br><span class="hljs-comment">//默认内存没有上限，故内存不会被会回收</span><br>indices<span class="hljs-selector-class">.breaker</span><span class="hljs-selector-class">.fielddata</span><span class="hljs-selector-class">.limit</span>: <span class="hljs-number">60%</span> <br><span class="hljs-comment">//当fielddata cache到达堆内存的60%，熔断请求</span><br></code></pre></td></tr></table></figure><p>查询和清理该部分使用量</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/_cat/</span>nodes?v&amp;h=name,fm<br>POST <span class="hljs-regexp">/&lt;index&gt;/</span>_cache/clear?fielddata<br></code></pre></td></tr></table></figure><p><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/jBjgh-RECfIDsFj4AdYuXm0lUoo1UP6_J0dJGxAtWyQ.png"></p><h5 id="query-cache"><a href="#query-cache" class="headerlink" title="query cache"></a>query cache</h5><p>node级别的filter过滤器结果缓存，每个节点有一个，被所有 shard 共享，filter query查询结果要么是 yes 要么是no，不涉及 scores 的计算。使用LRU淘汰策略，内存无法被GC。默认情况下查询会开启缓存</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">对于<span class="hljs-variable">TermQuery</span>、<span class="hljs-variable">MatchAllDocsQuery</span>等这种查询都不被缓存。当<span class="hljs-variable">BooleanQuey</span>的字节点为空时不会被缓存，当<span class="hljs-variable">Dis</span> <span class="hljs-built_in">Max</span> <span class="hljs-built_in">Query</span>的<span class="hljs-variable">Disjuncts</span>为空时不会被缓存。<br>对于历史查询次数有要求，对于消耗高昂的<span class="hljs-built_in">Query</span>只需要<span class="hljs-number">2</span>次就加入缓存，其他的默认是<span class="hljs-number">5</span>次，对于<span class="hljs-variable">BooleanQuery</span>和<span class="hljs-variable">DisjunctionMaxQuery</span>次数为<span class="hljs-number">4</span>次。<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">indices<span class="hljs-selector-class">.queries</span><span class="hljs-selector-class">.cache</span><span class="hljs-selector-class">.size</span>: <span class="hljs-number">10%</span> <br><span class="hljs-comment">// 默认为堆内存的10%，当cache满了，又新查询进入后，会冲刷掉老的查询缓存</span><br>index<span class="hljs-selector-class">.queries</span><span class="hljs-selector-class">.cache</span><span class="hljs-selector-class">.enable</span>: true<br><span class="hljs-comment">// 默认开启，可关闭</span><br></code></pre></td></tr></table></figure><p>查询和清理该部分使用量</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/_cat/</span>nodes?v&amp;h=name,qcm<br>POST <span class="hljs-regexp">/&lt;index&gt;/</span>_cache/clear?query<br></code></pre></td></tr></table></figure><p><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/B5PpJcVxaxm_yoS0aqxhEZks7WS9f2EXbBmGr_ME3c0.png"></p><h5 id="request-cache"><a href="#request-cache" class="headerlink" title="request cache"></a>request cache</h5><p>shard级别的query result缓存, 每个shard一个，默认情况下该缓存只缓存request的结果size为0的查询。所以该缓存不会缓存hits，但却会缓存 hits.total, aggregations 和 suggestions。该缓存默认是关闭的，需要手动开启.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">indices<span class="hljs-selector-class">.requests</span><span class="hljs-selector-class">.cache</span><span class="hljs-selector-class">.size</span>: <span class="hljs-number">1%</span><br>index<span class="hljs-selector-class">.requests</span><span class="hljs-selector-class">.cache</span><span class="hljs-selector-class">.enable</span>: false<br><span class="hljs-comment">//通过url传参方式request_cache=true</span><br>indices<span class="hljs-selector-class">.breaker</span><span class="hljs-selector-class">.request</span><span class="hljs-selector-class">.limit</span>: <span class="hljs-number">40%</span><br></code></pre></td></tr></table></figure><p>查询和清理该部分使用量</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/_cat/</span>nodes?v&amp;h=name,rcm<br>POST <span class="hljs-regexp">/&lt;index&gt;/</span>_cache/clear?request<br></code></pre></td></tr></table></figure><p><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/iqs0yGsCfYw-_cmJuy09pamWUwuXhFUZkxB_n3QBTx4.png"></p><h5 id="Segment-Memory"><a href="#Segment-Memory" class="headerlink" title="Segment Memory"></a>Segment Memory</h5><p>缓存段信息，包括FST,Dimensional points for numeric range filters，Deleted documents bitset ，Doc values and stored fields codec formats等数据。这部分缓存是必须的，不能进行大小设置，通常跟index息息相关，close index、force merge均会释放segmentsMemory空间。其中FST是倒排索引的前缀树，这部分内存占用非常大，故在ES 7.3中默认将其移动到堆外内存，<a href="https://www.elastic.co/cn/blog/significantly-decrease-your-elasticsearch-heap-memory-usage">显著降低 Elasticsearch 堆内存使用量 | Elastic Blog</a>. 该部分内存没有参数限制，不可手动释放<br>查询该部分使用量</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> /_cat/nodes?v&amp;<span class="hljs-attribute">h</span>=name,segmentsMemory<br></code></pre></td></tr></table></figure><p><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/R3kysiIydrkEmjAdafmdwkFBwBYbf-NPyGsVS0cpiuc.png"></p><h5 id="堆外内存"><a href="#堆外内存" class="headerlink" title="堆外内存"></a>堆外内存</h5><p>ES的堆外内存均为lucene使用，机器内存除了ES的堆内存外的内存空间都可被lucene，这部分内存不会OOM, 当其它程序需要使用内存时，操作系统会直接释放这部分内存，ES中使用PageCacheRecycler类来管理，这部分内存主要为lucene的FST、doc_values, 和查询时候加载的segment等数据，查询时ES会把segment加载到page cache中类进行查询，当page cache能完全加载查询的segment时，查询会快很多</p><h4 id="3-index加载方式"><a href="#3-index加载方式" class="headerlink" title="3. index加载方式"></a>3. index加载方式</h4><p>index的加载方式通过index.store.type参数控制，可选的方式有下面几种</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">fs:</span> 默认文件系统实现<br><span class="hljs-symbol">simplefs:</span> 使用随机访问文件的文件系统存储, 面向WINDOWS平台的文件系统<br><span class="hljs-symbol">niofs:</span> 使用NIO在文件系统上存储索引, 面向LINUX平台的NIO库的文件系统<br><span class="hljs-symbol">mmapfs:</span> 文件映射到内存（MMap）来将索引存储在文件系统上, 面向LINUX平台的支持MMap方式的文件系统<br><span class="hljs-symbol">hybridfs:</span> 根据文件类型选择niofs 或者 mmapfs,  默认的加载模式<br></code></pre></td></tr></table></figure><p>当indexService创建shard的会同时创建一个shard对应的FSDirectory, 其中有两个参数，一个是store相关的setting，另一个就是index的存储路径</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">public synchronized IndexShard createShard(<br>    final ShardRouting routing,<br>    final Consumer&lt;ShardId&gt; globalCheckpointSyncer,<br>    final RetentionLeaseSyncer retentionLeaseSyncer<br>) throws IOException &#123;<br>    Objects.requireNonNull(retentionLeaseSyncer)<span class="hljs-comment">;</span><br>        //省略代码<br>        Directory directory = directoryFactory.newDirectory(this.indexSettings, path)<span class="hljs-comment">;</span><br>        store = <span class="hljs-keyword">new</span> Store(<br><span class="hljs-built_in">            shardId,</span><br>            this.indexSettings,<br><span class="hljs-built_in">            directory,</span><br><span class="hljs-built_in">            lock,</span><br>            <span class="hljs-keyword">new</span> StoreCloseListener(shardId, () -&gt; eventListener.onStoreClosed(shardId))<br>        )<span class="hljs-comment">;</span><br>        eventListener.onStoreCreated(shardId)<span class="hljs-comment">;</span><br>        indexShard = <span class="hljs-keyword">new</span> IndexShard(<br><span class="hljs-built_in">            routing,</span><br>            this.indexSettings,<br><span class="hljs-built_in">            path,</span><br><span class="hljs-built_in">            store,</span><br><span class="hljs-built_in">            indexSortSupplier,</span><br><span class="hljs-built_in">            indexCache,</span><br><span class="hljs-built_in">            mapperService,</span><br><span class="hljs-built_in">            similarityService,</span><br><span class="hljs-built_in">            engineFactory,</span><br><span class="hljs-built_in">            eventListener,</span><br><span class="hljs-built_in">            readerWrapper,</span><br><span class="hljs-built_in">            threadPool,</span><br><span class="hljs-built_in">            bigArrays,</span><br><span class="hljs-built_in">            engineWarmer,</span><br><span class="hljs-built_in">            searchOperationListeners,</span><br><span class="hljs-built_in">            indexingOperationListeners,</span><br>            () -&gt; globalCheckpointSyncer.accept(shardId),<br><span class="hljs-built_in">            retentionLeaseSyncer,</span><br><span class="hljs-built_in">            circuitBreakerService,</span><br>            snapshotCommitSupplier<br>        )<span class="hljs-comment">;</span><br>        //省略代码<br>&#125;<br></code></pre></td></tr></table></figure><p>其中setting相关的参数有</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">index<span class="hljs-selector-class">.store</span><span class="hljs-selector-class">.fs</span><span class="hljs-selector-class">.fs_lock</span>: \<span class="hljs-selector-attr">[native, simple\]</span> 默认 native<br><span class="hljs-comment">//native: 文件存在时忽略异常</span><br><span class="hljs-comment">//simple: 文件存在时抛异常</span><br>index<span class="hljs-selector-class">.store</span><span class="hljs-selector-class">.type</span>: 存储类型 默认 hybridfs<br>node<span class="hljs-selector-class">.store</span><span class="hljs-selector-class">.allow_mmap</span>: bool值 默认true<br><span class="hljs-comment">//如果存储类型是hybridfs 或 mmapfs时，是否允许使用内存映射</span><br>index<span class="hljs-selector-class">.store</span><span class="hljs-selector-class">.preload</span>: <span class="hljs-selector-attr">[]</span><br><span class="hljs-comment">//预加载segment文件，值为文件类型后缀名</span><br></code></pre></td></tr></table></figure><p><img src="/2023/07/27/%E3%80%8CElasticSearch%E3%80%8DES%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E5%8F%8Aindex%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/9QLexvqiUMDHJcwRT_0HiGrKJpLGE6tftQDIWSHFb_g.png"><br>当创建FSDirectory时会根据index.store.type和node.store.allow_mmap来选择不同的加载类型，当index.store.type为fs时，会使用IndexModule.defaultStoreType返回获取加载类型，否则就使用index.store.type配置的类型，主要就三种类型HYBRIDFS、MMAPFS和NIOFS</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">protected Directory <span class="hljs-keyword">new</span><span class="hljs-constructor">FSDirectory(Path <span class="hljs-params">location</span>, LockFactory <span class="hljs-params">lockFactory</span>, IndexSettings <span class="hljs-params">indexSettings</span>)</span> throws IOException &#123;<br>    final String storeType = indexSettings.get<span class="hljs-constructor">Settings()</span><br>        .get(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IndexModule</span>.</span><span class="hljs-module"><span class="hljs-identifier">INDEX_STORE_TYPE_SETTING</span>.</span></span>get<span class="hljs-constructor">Key()</span>, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IndexModule</span>.</span><span class="hljs-module"><span class="hljs-identifier">Type</span>.</span><span class="hljs-module"><span class="hljs-identifier">FS</span>.</span></span>get<span class="hljs-constructor">SettingsKey()</span>);<br>    IndexModule.Type <span class="hljs-keyword">type</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IndexModule</span>.</span><span class="hljs-module"><span class="hljs-identifier">Type</span>.</span><span class="hljs-module"><span class="hljs-identifier">FS</span>.</span></span><span class="hljs-keyword">match</span>(storeType)) &#123;<br>        <span class="hljs-keyword">type</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IndexModule</span>.</span></span>default<span class="hljs-constructor">StoreType(IndexModule.NODE_STORE_ALLOW_MMAP.<span class="hljs-params">get</span>(<span class="hljs-params">indexSettings</span>.<span class="hljs-params">getNodeSettings</span>()</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">type</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IndexModule</span>.</span><span class="hljs-module"><span class="hljs-identifier">Type</span>.</span></span>from<span class="hljs-constructor">SettingsKey(<span class="hljs-params">storeType</span>)</span>;<br>    &#125;<br>    Set&lt;String&gt; preLoadExtensions = <span class="hljs-keyword">new</span> HashSet&lt;&gt;(indexSettings.get<span class="hljs-constructor">Value(IndexModule.INDEX_STORE_PRE_LOAD_SETTING)</span>);<br>    switch (<span class="hljs-keyword">type</span>) &#123;<br>        case HYBRIDFS:<br>            <span class="hljs-comment">// Use Lucene defaults</span><br>            final FSDirectory primaryDirectory = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FSDirectory</span>.</span></span><span class="hljs-keyword">open</span>(location, lockFactory);<br>            <span class="hljs-keyword">if</span> (primaryDirectory instanceof MMapDirectory) &#123;<br>                MMapDirectory mMapDirectory = (MMapDirectory) primaryDirectory;<br>                return <span class="hljs-keyword">new</span> <span class="hljs-constructor">HybridDirectory(<span class="hljs-params">lockFactory</span>, <span class="hljs-params">setPreload</span>(<span class="hljs-params">mMapDirectory</span>, <span class="hljs-params">lockFactory</span>, <span class="hljs-params">preLoadExtensions</span>)</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                return primaryDirectory;<br>            &#125;<br>        case MMAPFS:<br>            return set<span class="hljs-constructor">Preload(<span class="hljs-params">new</span> MMapDirectory(<span class="hljs-params">location</span>, <span class="hljs-params">lockFactory</span>)</span>, lockFactory, preLoadExtensions);<br>        case SIMPLEFS:<br>        case NIOFS:<br>            return <span class="hljs-keyword">new</span> <span class="hljs-constructor">NIOFSDirectory(<span class="hljs-params">location</span>, <span class="hljs-params">lockFactory</span>)</span>;<br>        default:<br>            throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">AssertionError(<span class="hljs-string">&quot;unexpected built-in store type \[&quot;</span> + <span class="hljs-params">type</span> + <span class="hljs-string">&quot;\]&quot;</span>)</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>来看看当配置为fs时，会选择那种加载方式，逻辑比较简单就是根据node.store.allow_mmap和java是否是64位的来决定是HYBRIDFS还是nio</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> Type <span class="hljs-title">defaultStoreType</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> allowMmap)</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (allowMmap &amp;&amp; Constants.JRE_IS_64BIT &amp;&amp; MMapDirectory.UNMAP_SUPPORTED) &#123;<br>        <span class="hljs-keyword">return</span> Type.HYBRIDFS;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> Type.NIOFS;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>对于常用的hybridfs类型，会调用lucene的FSDirectory.open来创建一个FSDirectory，代码如下，逻辑基本为，当java为64位并且操作系统为linux系统，并且操作系统是64位的则选择MMapDirectory，如果是window系统则选择SimpleFSDirectory，否则选择NIOFSDirectory，当open方法返回后，会去判断是否为MMapDirectory，如果是HybridDirectory，否则返回open方法返回的FSDirectory.</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> static FSDirectory <span class="hljs-keyword">open</span>(<span class="hljs-keyword">Path</span> <span class="hljs-keyword">path</span>, LockFactory lockFactory) throws IOException &#123;<br>  <span class="hljs-keyword">if</span> (Constants.JRE_IS_64BIT &amp;&amp; MMapDirectory.UNMAP_SUPPORTED) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> MMapDirectory(<span class="hljs-type">path</span>, lockFactory);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Constants.WINDOWS) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> SimpleFSDirectory(<span class="hljs-type">path</span>, lockFactory);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> NIOFSDirectory(<span class="hljs-type">path</span>, lockFactory);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>HybridDirectory的实现如下，其继承NIOFSDirectory类，NIOFSDirectory类在lucene中实现，构造函数有两个参数，lockFactory为fs_lock，delegate为setPreload返回的MMapDirectory</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">static final <span class="hljs-keyword">class</span> HybridDirectory extends NIOFSDirectory &#123;<br>        <span class="hljs-keyword">private</span> final MMapDirectory delegate;<br>  <br>        <span class="hljs-constructor">HybridDirectory(LockFactory <span class="hljs-params">lockFactory</span>, MMapDirectory <span class="hljs-params">delegate</span>)</span> throws IOException &#123;<br>            super(delegate.get<span class="hljs-constructor">Directory()</span>, lockFactory);<br>            this.delegate = delegate;<br>        &#125;<br>  <br>        @Override<br>        public IndexInput <span class="hljs-keyword">open</span><span class="hljs-constructor">Input(String <span class="hljs-params">name</span>, IOContext <span class="hljs-params">context</span>)</span> throws IOException &#123;<br>            <span class="hljs-keyword">if</span> (use<span class="hljs-constructor">Delegate(<span class="hljs-params">name</span>, <span class="hljs-params">context</span>)</span>) &#123;<br>                <span class="hljs-comment">// we need to do these checks on the outer directory since the inner doesn&#x27;t know about pending deletes</span><br>                ensure<span class="hljs-constructor">Open()</span>;<br>                ensure<span class="hljs-constructor">CanRead(<span class="hljs-params">name</span>)</span>;<br>                <span class="hljs-comment">// we only use the mmap to open inputs. Everything else is managed by the NIOFSDirectory otherwise</span><br>                <span class="hljs-comment">// we might run into trouble with files that are pendingDelete in one directory but still</span><br>                <span class="hljs-comment">// listed in listAll() from the other. We on the other hand don&#x27;t want to list files from both dirs</span><br>                <span class="hljs-comment">// and intersect for perf reasons.</span><br>                return delegate.<span class="hljs-keyword">open</span><span class="hljs-constructor">Input(<span class="hljs-params">name</span>, <span class="hljs-params">context</span>)</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                return super.<span class="hljs-keyword">open</span><span class="hljs-constructor">Input(<span class="hljs-params">name</span>, <span class="hljs-params">context</span>)</span>;<br>            &#125;<br>        &#125;<br>  <br>        @Override<br>        public void close<span class="hljs-literal">()</span> throws IOException &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IOUtils</span>.</span></span>close(super::close, delegate);<br>        &#125;<br>  <br>        boolean use<span class="hljs-constructor">Delegate(String <span class="hljs-params">name</span>, IOContext <span class="hljs-params">ioContext</span>)</span> &#123;<br>            <span class="hljs-keyword">if</span> (ioContext<span class="hljs-operator"> == </span>Store.READONCE_CHECKSUM) &#123;<br>                <span class="hljs-comment">// If we&#x27;re just reading the footer for the checksum then mmap() isn&#x27;t really necessary, and it&#x27;s desperately inefficient</span><br>                <span class="hljs-comment">// if pre-loading is enabled on this file.</span><br>                return <span class="hljs-literal">false</span>;<br>            &#125;<br>  <br>            final LuceneFilesExtensions extension = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LuceneFilesExtensions</span>.</span></span>from<span class="hljs-constructor">Extension(FileSwitchDirectory.<span class="hljs-params">getExtension</span>(<span class="hljs-params">name</span>)</span>);<br>            <span class="hljs-keyword">if</span> (extension<span class="hljs-operator"> == </span>null<span class="hljs-operator"> || </span>extension.should<span class="hljs-constructor">Mmap()</span><span class="hljs-operator"> == </span><span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-comment">// Other files are either less performance-sensitive (e.g. stored field index, norms metadata)</span><br>                <span class="hljs-comment">// or are large and have a random access pattern and mmap leads to page cache trashing</span><br>                <span class="hljs-comment">// (e.g. stored fields and term vectors).</span><br>                return <span class="hljs-literal">false</span>;<br>            &#125;<br>            return <span class="hljs-literal">true</span>;<br>        &#125;<br>  <br>        MMapDirectory get<span class="hljs-constructor">Delegate()</span> &#123;<br>            return delegate;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>setPreload实现如下，如果设置了预加载则返回包装后的MMapDirectory，否则直接返回mMapDirectory</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public static MMapDirectory set<span class="hljs-constructor">Preload(MMapDirectory <span class="hljs-params">mMapDirectory</span>, LockFactory <span class="hljs-params">lockFactory</span>, Set&lt;String&gt; <span class="hljs-params">preLoadExtensions</span>)</span><br>    throws IOException &#123;<br>    <span class="hljs-keyword">assert</span> mMapDirectory.get<span class="hljs-constructor">Preload()</span><span class="hljs-operator"> == </span><span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span> (preLoadExtensions.is<span class="hljs-constructor">Empty()</span><span class="hljs-operator"> == </span><span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-keyword">if</span> (preLoadExtensions.contains(<span class="hljs-string">&quot;\*&quot;</span>)) &#123;<br>            mMapDirectory.set<span class="hljs-constructor">Preload(<span class="hljs-params">true</span>)</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            return <span class="hljs-keyword">new</span> <span class="hljs-constructor">PreLoadMMapDirectory(<span class="hljs-params">mMapDirectory</span>, <span class="hljs-params">lockFactory</span>, <span class="hljs-params">preLoadExtensions</span>)</span>;<br>        &#125;<br>    &#125;<br>    return mMapDirectory;<br>&#125;<br></code></pre></td></tr></table></figure><p>先看看没有设置预加载的情况，在HybridDirectory中，有一个核心的方法openInput， 该方法用于加载index的文件，通过useDelegate方法判断文件是用MMapDirectory打开，还是通过父类NIOFSDirectory打开，ensureOpen判断是否能打开，ensureCanRead判断是否能读，具体open方式由lucene实现，其中是使用offheap还是onheap由lucene， es这端不做干预</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public IndexInput <span class="hljs-keyword">open</span><span class="hljs-constructor">Input(String <span class="hljs-params">name</span>, IOContext <span class="hljs-params">context</span>)</span> throws IOException &#123;<br>            <span class="hljs-keyword">if</span> (use<span class="hljs-constructor">Delegate(<span class="hljs-params">name</span>, <span class="hljs-params">context</span>)</span>) &#123;<br>                <span class="hljs-comment">// we need to do these checks on the outer directory since the inner doesn&#x27;t know about pending deletes</span><br>                ensure<span class="hljs-constructor">Open()</span>;<br>                ensure<span class="hljs-constructor">CanRead(<span class="hljs-params">name</span>)</span>;<br>                <span class="hljs-comment">// we only use the mmap to open inputs. Everything else is managed by the NIOFSDirectory otherwise</span><br>                <span class="hljs-comment">// we might run into trouble with files that are pendingDelete in one directory but still</span><br>                <span class="hljs-comment">// listed in listAll() from the other. We on the other hand don&#x27;t want to list files from both dirs</span><br>                <span class="hljs-comment">// and intersect for perf reasons.</span><br>                return delegate.<span class="hljs-keyword">open</span><span class="hljs-constructor">Input(<span class="hljs-params">name</span>, <span class="hljs-params">context</span>)</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                return super.<span class="hljs-keyword">open</span><span class="hljs-constructor">Input(<span class="hljs-params">name</span>, <span class="hljs-params">context</span>)</span>;<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>其中useDelegate方法实现如下，逻辑为通过文件后缀名，来判断是否使用MMapDirectory读取</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart">boolean useDelegate(<span class="hljs-built_in">String</span> name, IOContext ioContext) &#123;<br>    <span class="hljs-keyword">if</span> (ioContext == Store.READONCE_CHECKSUM) &#123;<br>        <span class="hljs-comment">// If we&#x27;re just reading the footer for the checksum then mmap() isn&#x27;t really necessary, and it&#x27;s desperately inefficient</span><br>        <span class="hljs-comment">// if pre-loading is enabled on this file.</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br>  <br>    <span class="hljs-keyword">final</span> LuceneFilesExtensions <span class="hljs-keyword">extension</span> = LuceneFilesExtensions.fromExtension(FileSwitchDirectory.getExtension(name));<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">extension</span> == <span class="hljs-keyword">null</span> || <span class="hljs-keyword">extension</span>.shouldMmap() == <span class="hljs-keyword">false</span>) &#123;<br>        <span class="hljs-comment">// Other files are either less performance-sensitive (e.g. stored field index, norms metadata)</span><br>        <span class="hljs-comment">// or are large and have a random access pattern and mmap leads to page cache trashing</span><br>        <span class="hljs-comment">// (e.g. stored fields and term vectors).</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>文件是否通过mmap读取，在代码中已经写死， 如下，以此为文件后缀名，描述， 是否是元数据，是否使用mmap加载</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">CFE(<span class="hljs-string">&quot;cfe&quot;</span>, <span class="hljs-string">&quot;Compound Files Entries&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-comment">// Compound files are tricky because they store all the information for the segment. Benchmarks</span><br><span class="hljs-comment">// suggested that not mapping them hurts performance.</span><br><span class="hljs-constructor">CFS(<span class="hljs-string">&quot;cfs&quot;</span>, <span class="hljs-string">&quot;Compound Files&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-constructor">CMP(<span class="hljs-string">&quot;cmp&quot;</span>, <span class="hljs-string">&quot;Completion Index&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">DII(<span class="hljs-string">&quot;dii&quot;</span>, <span class="hljs-string">&quot;Points Index&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-comment">// dim files only apply up to lucene 8.x indices. It can be removed once we are in lucene 10</span><br><span class="hljs-constructor">DIM(<span class="hljs-string">&quot;dim&quot;</span>, <span class="hljs-string">&quot;Points&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-comment">// MMapDirectory has special logic to read long\[\] arrays in little-endian order that helps speed</span><br><span class="hljs-comment">// up the decoding of postings. The same logic applies to positions (.pos) of offsets (.pay) but we</span><br><span class="hljs-comment">// are not mmaping them as queries that leverage positions are more costly and the decoding of postings</span><br><span class="hljs-comment">// tends to be less a bottleneck.</span><br><span class="hljs-constructor">DOC(<span class="hljs-string">&quot;doc&quot;</span>, <span class="hljs-string">&quot;Frequencies&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-comment">// Doc values are typically performance-sensitive and hot in the page</span><br><span class="hljs-comment">// cache, so we use mmap, which provides better performance.</span><br><span class="hljs-constructor">DVD(<span class="hljs-string">&quot;dvd&quot;</span>, <span class="hljs-string">&quot;DocValues&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-constructor">DVM(<span class="hljs-string">&quot;dvm&quot;</span>, <span class="hljs-string">&quot;DocValues Metadata&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">FDM(<span class="hljs-string">&quot;fdm&quot;</span>, <span class="hljs-string">&quot;Field Metadata&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">FDT(<span class="hljs-string">&quot;fdt&quot;</span>, <span class="hljs-string">&quot;Field Data&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">FDX(<span class="hljs-string">&quot;fdx&quot;</span>, <span class="hljs-string">&quot;Field Index&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">FNM(<span class="hljs-string">&quot;fnm&quot;</span>, <span class="hljs-string">&quot;Fields&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-comment">// old extension</span><br><span class="hljs-constructor">KDD(<span class="hljs-string">&quot;kdd&quot;</span>, <span class="hljs-string">&quot;Points&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-comment">// old extension</span><br><span class="hljs-constructor">KDI(<span class="hljs-string">&quot;kdi&quot;</span>, <span class="hljs-string">&quot;Points Index&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-comment">// Lucene 8.6 point format metadata file</span><br><span class="hljs-constructor">KDM(<span class="hljs-string">&quot;kdm&quot;</span>, <span class="hljs-string">&quot;Points Metadata&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">LIV(<span class="hljs-string">&quot;liv&quot;</span>, <span class="hljs-string">&quot;Live Documents&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">LKP(<span class="hljs-string">&quot;lkp&quot;</span>, <span class="hljs-string">&quot;Completion Dictionary&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-comment">// Norms are typically performance-sensitive and hot in the page</span><br><span class="hljs-comment">// cache, so we use mmap, which provides better performance.</span><br><span class="hljs-constructor">NVD(<span class="hljs-string">&quot;nvd&quot;</span>, <span class="hljs-string">&quot;Norms&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-constructor">NVM(<span class="hljs-string">&quot;nvm&quot;</span>, <span class="hljs-string">&quot;Norms Metadata&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">PAY(<span class="hljs-string">&quot;pay&quot;</span>, <span class="hljs-string">&quot;Payloads&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">POS(<span class="hljs-string">&quot;pos&quot;</span>, <span class="hljs-string">&quot;Positions&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">SI(<span class="hljs-string">&quot;si&quot;</span>, <span class="hljs-string">&quot;Segment Info&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-comment">// Term dictionaries are typically performance-sensitive and hot in the page</span><br><span class="hljs-comment">// cache, so we use mmap, which provides better performance.</span><br><span class="hljs-constructor">TIM(<span class="hljs-string">&quot;tim&quot;</span>, <span class="hljs-string">&quot;Term Dictionary&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-comment">// We want to open the terms index and KD-tree index off-heap to save memory, but this only performs</span><br><span class="hljs-comment">// well if using mmap.</span><br><span class="hljs-constructor">TIP(<span class="hljs-string">&quot;tip&quot;</span>, <span class="hljs-string">&quot;Term Index&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">true</span>)</span>,<br><span class="hljs-comment">// Lucene 8.6 terms metadata file</span><br><span class="hljs-constructor">TMD(<span class="hljs-string">&quot;tmd&quot;</span>, <span class="hljs-string">&quot;Term Dictionary Metadata&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-comment">// Temporary Lucene file</span><br><span class="hljs-constructor">TMP(<span class="hljs-string">&quot;tmp&quot;</span>, <span class="hljs-string">&quot;Temporary File&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">TVD(<span class="hljs-string">&quot;tvd&quot;</span>, <span class="hljs-string">&quot;Term Vector Documents&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">TVF(<span class="hljs-string">&quot;tvf&quot;</span>, <span class="hljs-string">&quot;Term Vector Fields&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">TVM(<span class="hljs-string">&quot;tvm&quot;</span>, <span class="hljs-string">&quot;Term Vector Metadata&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">TVX(<span class="hljs-string">&quot;tvx&quot;</span>, <span class="hljs-string">&quot;Term Vector Index&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-constructor">VEC(<span class="hljs-string">&quot;vec&quot;</span>, <span class="hljs-string">&quot;Vector Data&quot;</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>)</span>,<br><span class="hljs-comment">// Lucene 9.0 indexed vectors metadata</span><br><span class="hljs-constructor">VEM(<span class="hljs-string">&quot;vem&quot;</span>, <span class="hljs-string">&quot;Vector Metadata&quot;</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>)</span>;<br></code></pre></td></tr></table></figure><p>现在看看预加载的实现，其实现方式与HybridDirectory类型，区别点为this.delegate.setPreload(true)，其真正预加载由lucene实现，useDelegate内部判断方式改成了是否在配置文件中配置，即可以更改部分文件由mmap加载</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreLoadMMapDirectory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MMapDirectory</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MMapDirectory delegate;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;String&gt; preloadExtensions;<br>  <br>    PreLoadMMapDirectory(MMapDirectory delegate, LockFactory lockFactory, Set&lt;String&gt; preload) <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">super</span>(delegate.getDirectory(), lockFactory);<br>        <span class="hljs-keyword">super</span>.setPreload(<span class="hljs-keyword">false</span>);<br>        <span class="hljs-keyword">this</span>.delegate = delegate;<br>        <span class="hljs-keyword">this</span>.delegate.setPreload(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">this</span>.preloadExtensions = preload;<br>        <span class="hljs-keyword">assert</span> getPreload() == <span class="hljs-keyword">false</span>;<br>    &#125;<br>  <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setPreload</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> preload)</span> </span>&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;can&#x27;t set preload on a preload-wrapper&quot;</span>);<br>    &#125;<br>  <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function">IndexInput <span class="hljs-title">openInput</span><span class="hljs-params">(String name, IOContext context)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">if</span> (useDelegate(name)) &#123;<br>            <span class="hljs-comment">// we need to do these checks on the outer directory since the inner doesn&#x27;t know about pending deletes</span><br>            ensureOpen();<br>            ensureCanRead(name);<br>            <span class="hljs-function"><span class="hljs-keyword">return</span> delegate.<span class="hljs-title">openInput</span><span class="hljs-params">(name, context)</span></span>;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.<span class="hljs-title">openInput</span><span class="hljs-params">(name, context)</span></span>;<br>    &#125;<br>  <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        IOUtils.close(<span class="hljs-keyword">super</span>::close, delegate);<br>    &#125;<br>  <br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">useDelegate</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">final</span> String extension = FileSwitchDirectory.getExtension(name);<br>        <span class="hljs-function"><span class="hljs-keyword">return</span> preloadExtensions.<span class="hljs-title">contains</span><span class="hljs-params">(extension)</span></span>;<br>    &#125;<br>  <br>    <span class="hljs-function">MMapDirectory <span class="hljs-title">getDelegate</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> delegate;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>大数据</tag>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「Druid」tranquility中加载druid扩展报错</title>
    <link href="/2023/07/27/%E3%80%8CDruid%E3%80%8Dtranquility%E4%B8%AD%E5%8A%A0%E8%BD%BDdruid%E6%89%A9%E5%B1%95%E6%8A%A5%E9%94%99/"/>
    <url>/2023/07/27/%E3%80%8CDruid%E3%80%8Dtranquility%E4%B8%AD%E5%8A%A0%E8%BD%BDdruid%E6%89%A9%E5%B1%95%E6%8A%A5%E9%94%99/</url>
    
    <content type="html"><![CDATA[<p>[错误详细]<br>在tranquility的extensions中、或命令行中加在druid扩展，启动后被告，错误如下：  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">2019</span>-<span class="hljs-number">04</span>-<span class="hljs-number">04</span> <span class="hljs-number">15</span>:<span class="hljs-number">01</span>:<span class="hljs-number">55</span>,<span class="hljs-number">480</span> - <span class="hljs-selector-attr">[ERROR]</span> - from com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.KafkaConsumer</span> <span class="hljs-keyword">in</span> KafkaConsumer-<span class="hljs-number">0</span><br>Exception:<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.NoClassDefFoundError</span>: Could not initialize class com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.druid</span>.DruidGuicer$<br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.druid</span>.DruidBeams$<span class="hljs-selector-class">.makeFireDepartment</span>(DruidBeams<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">406</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-core-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.druid</span>.DruidBeams$<span class="hljs-selector-class">.fromConfigInternal</span>(DruidBeams<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">291</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-core-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.druid</span>.DruidBeams$<span class="hljs-selector-class">.fromConfig</span>(DruidBeams<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">199</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-core-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span>.KafkaBeamUtils$<span class="hljs-selector-class">.createTranquilizer</span>(KafkaBeamUtils<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">40</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.KafkaBeamUtils</span><span class="hljs-selector-class">.createTranquilizer</span>(KafkaBeamUtils.scala) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.writer</span><span class="hljs-selector-class">.TranquilityEventWriter</span>.&lt;init&gt;(TranquilityEventWriter<span class="hljs-selector-class">.java</span>:<span class="hljs-number">64</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.writer</span><span class="hljs-selector-class">.WriterController</span><span class="hljs-selector-class">.createWriter</span>(WriterController<span class="hljs-selector-class">.java</span>:<span class="hljs-number">171</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.writer</span><span class="hljs-selector-class">.WriterController</span><span class="hljs-selector-class">.getWriter</span>(WriterController<span class="hljs-selector-class">.java</span>:<span class="hljs-number">98</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span>.KafkaConsumer$<span class="hljs-number">2</span><span class="hljs-selector-class">.run</span>(KafkaConsumer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">231</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.Executors<span class="hljs-variable">$RunnableAdapter</span><span class="hljs-selector-class">.call</span>(Executors<span class="hljs-selector-class">.java</span>:<span class="hljs-number">511</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.FutureTask</span><span class="hljs-selector-class">.run</span>(FutureTask<span class="hljs-selector-class">.java</span>:<span class="hljs-number">266</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.ThreadPoolExecutor</span><span class="hljs-selector-class">.runWorker</span>(ThreadPoolExecutor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1149</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.ThreadPoolExecutor<span class="hljs-variable">$Worker</span><span class="hljs-selector-class">.run</span>(ThreadPoolExecutor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">624</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Thread</span><span class="hljs-selector-class">.run</span>(Thread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">748</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br></code></pre></td></tr></table></figure><p>[问题原因]<br>tranquility中引用的jackson,和扩展中引用的jackson版本冲突</p><p>[解决]<br>在0.9.0的druid中build插件放入tranquility中</p>]]></content>
    
    
    
    <tags>
      
      <tag>大数据</tag>
      
      <tag>Driud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「Druid」tranquility中查询粒度设置为5分钟-FIVE-MINUTE-出错</title>
    <link href="/2023/07/27/%E3%80%8CDruid%E3%80%8Dtranquility%E4%B8%AD%E6%9F%A5%E8%AF%A2%E7%B2%92%E5%BA%A6%E8%AE%BE%E7%BD%AE%E4%B8%BA5%E5%88%86%E9%92%9F-FIVE-MINUTE-%E5%87%BA%E9%94%99/"/>
    <url>/2023/07/27/%E3%80%8CDruid%E3%80%8Dtranquility%E4%B8%AD%E6%9F%A5%E8%AF%A2%E7%B2%92%E5%BA%A6%E8%AE%BE%E7%BD%AE%E4%B8%BA5%E5%88%86%E9%92%9F-FIVE-MINUTE-%E5%87%BA%E9%94%99/</url>
    
    <content type="html"><![CDATA[<p>[错误详细]<br>在druid中查询时间粒度可以设置为MINUTE、HOURE、FILVE_MINUTE等，但在tranquility设置查询粒度为5分钟，启动后报错，错误信息如下  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ava<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalArgumentException</span>: Instantiation of <span class="hljs-selector-attr">[simple type, class io.druid.granularity.QueryGranularity]</span> value failed: No enum constant io<span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.granularity</span><span class="hljs-selector-class">.QueryGranularity</span><span class="hljs-selector-class">.MillisIn</span><span class="hljs-selector-class">.FIVE_MINUTE</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.ObjectMapper</span>.<span class="hljs-built_in">_convert</span>(ObjectMapper<span class="hljs-selector-class">.java</span>:<span class="hljs-number">2774</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.ObjectMapper</span><span class="hljs-selector-class">.convertValue</span>(ObjectMapper<span class="hljs-selector-class">.java</span>:<span class="hljs-number">2700</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.druid</span>.DruidBeams$<span class="hljs-selector-class">.makeFireDepartment</span>(DruidBeams<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">406</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-core-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.druid</span>.DruidBeams$<span class="hljs-selector-class">.fromConfigInternal</span>(DruidBeams<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">291</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-core-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.druid</span>.DruidBeams$<span class="hljs-selector-class">.fromConfig</span>(DruidBeams<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">199</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-core-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span>.KafkaBeamUtils$<span class="hljs-selector-class">.createTranquilizer</span>(KafkaBeamUtils<span class="hljs-selector-class">.scala</span>:<span class="hljs-number">40</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.KafkaBeamUtils</span><span class="hljs-selector-class">.createTranquilizer</span>(KafkaBeamUtils.scala) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.writer</span><span class="hljs-selector-class">.TranquilityEventWriter</span>.&lt;init&gt;(TranquilityEventWriter<span class="hljs-selector-class">.java</span>:<span class="hljs-number">64</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.writer</span><span class="hljs-selector-class">.WriterController</span><span class="hljs-selector-class">.createWriter</span>(WriterController<span class="hljs-selector-class">.java</span>:<span class="hljs-number">171</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.writer</span><span class="hljs-selector-class">.WriterController</span><span class="hljs-selector-class">.getWriter</span>(WriterController<span class="hljs-selector-class">.java</span>:<span class="hljs-number">98</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span>.KafkaConsumer$<span class="hljs-number">2</span><span class="hljs-selector-class">.run</span>(KafkaConsumer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">231</span>) ~<span class="hljs-selector-attr">[io.druid.tranquility-kafka-0.8.0.jar:0.8.0]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.Executors<span class="hljs-variable">$RunnableAdapter</span><span class="hljs-selector-class">.call</span>(Executors<span class="hljs-selector-class">.java</span>:<span class="hljs-number">511</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.FutureTask</span><span class="hljs-selector-class">.run</span>(FutureTask<span class="hljs-selector-class">.java</span>:<span class="hljs-number">266</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.ThreadPoolExecutor</span><span class="hljs-selector-class">.runWorker</span>(ThreadPoolExecutor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1149</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.ThreadPoolExecutor<span class="hljs-variable">$Worker</span><span class="hljs-selector-class">.run</span>(ThreadPoolExecutor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">624</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Thread</span><span class="hljs-selector-class">.run</span>(Thread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">748</span>) <span class="hljs-selector-attr">[na:1.8.0_201]</span><br>Caused by: com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.JsonMappingException</span>: Instantiation of <span class="hljs-selector-attr">[simple type, class io.druid.granularity.QueryGranularity]</span> value failed: No enum constant io<span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.granularity</span><span class="hljs-selector-class">.QueryGranularity</span><span class="hljs-selector-class">.MillisIn</span><span class="hljs-selector-class">.FIVE_MINUTE</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.std</span><span class="hljs-selector-class">.StdValueInstantiator</span><span class="hljs-selector-class">.wrapException</span>(StdValueInstantiator<span class="hljs-selector-class">.java</span>:<span class="hljs-number">405</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.std</span><span class="hljs-selector-class">.StdValueInstantiator</span><span class="hljs-selector-class">.createFromString</span>(StdValueInstantiator<span class="hljs-selector-class">.java</span>:<span class="hljs-number">284</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializerBase</span><span class="hljs-selector-class">.deserializeFromString</span>(BeanDeserializerBase<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1141</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span>.<span class="hljs-built_in">_deserializeOther</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">135</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span><span class="hljs-selector-class">.deserialize</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">126</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.jsontype</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.AsPropertyTypeDeserializer</span>.<span class="hljs-built_in">_deserializeTypedUsingDefaultImpl</span>(AsPropertyTypeDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">129</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.jsontype</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.AsPropertyTypeDeserializer</span><span class="hljs-selector-class">.deserializeTypedFromObject</span>(AsPropertyTypeDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">75</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializerBase</span><span class="hljs-selector-class">.deserializeWithType</span>(BeanDeserializerBase<span class="hljs-selector-class">.java</span>:<span class="hljs-number">956</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.SettableBeanProperty</span><span class="hljs-selector-class">.deserialize</span>(SettableBeanProperty<span class="hljs-selector-class">.java</span>:<span class="hljs-number">536</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span>.<span class="hljs-built_in">_deserializeUsingPropertyBased</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">344</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializerBase</span><span class="hljs-selector-class">.deserializeFromObjectUsingNonDefault</span>(BeanDeserializerBase<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1064</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span><span class="hljs-selector-class">.deserializeFromObject</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">264</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span>.<span class="hljs-built_in">_deserializeOther</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">156</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span><span class="hljs-selector-class">.deserialize</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">126</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.jsontype</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.AsPropertyTypeDeserializer</span>.<span class="hljs-built_in">_deserializeTypedForId</span>(AsPropertyTypeDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">113</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.jsontype</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.AsPropertyTypeDeserializer</span><span class="hljs-selector-class">.deserializeTypedFromObject</span>(AsPropertyTypeDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">84</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.AbstractDeserializer</span><span class="hljs-selector-class">.deserializeWithType</span>(AbstractDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">132</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.SettableBeanProperty</span><span class="hljs-selector-class">.deserialize</span>(SettableBeanProperty<span class="hljs-selector-class">.java</span>:<span class="hljs-number">536</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span>.<span class="hljs-built_in">_deserializeUsingPropertyBased</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">344</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializerBase</span><span class="hljs-selector-class">.deserializeFromObjectUsingNonDefault</span>(BeanDeserializerBase<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1064</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span><span class="hljs-selector-class">.deserializeFromObject</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">264</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span><span class="hljs-selector-class">.deserialize</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">124</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.SettableBeanProperty</span><span class="hljs-selector-class">.deserialize</span>(SettableBeanProperty<span class="hljs-selector-class">.java</span>:<span class="hljs-number">538</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span>.<span class="hljs-built_in">_deserializeUsingPropertyBased</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">344</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializerBase</span><span class="hljs-selector-class">.deserializeFromObjectUsingNonDefault</span>(BeanDeserializerBase<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1064</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span><span class="hljs-selector-class">.deserializeFromObject</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">264</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.BeanDeserializer</span><span class="hljs-selector-class">.deserialize</span>(BeanDeserializer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">124</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.ObjectMapper</span>.<span class="hljs-built_in">_convert</span>(ObjectMapper<span class="hljs-selector-class">.java</span>:<span class="hljs-number">2769</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>... <span class="hljs-number">15</span> common frames omitted<br>Caused by: java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalArgumentException</span>: No enum constant io<span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.granularity</span><span class="hljs-selector-class">.QueryGranularity</span><span class="hljs-selector-class">.MillisIn</span><span class="hljs-selector-class">.FIVE_MINUTE</span><br>at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Enum</span><span class="hljs-selector-class">.valueOf</span>(Enum<span class="hljs-selector-class">.java</span>:<span class="hljs-number">238</span>) ~<span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at io<span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.granularity</span>.QueryGranularity<span class="hljs-variable">$MillisIn</span><span class="hljs-selector-class">.valueOf</span>(QueryGranularity<span class="hljs-selector-class">.java</span>:<span class="hljs-number">62</span>) ~<span class="hljs-selector-attr">[io.druid.druid-processing-0.9.0.jar:0.9.0]</span><br>at io<span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.granularity</span><span class="hljs-selector-class">.QueryGranularity</span><span class="hljs-selector-class">.convertValue</span>(QueryGranularity<span class="hljs-selector-class">.java</span>:<span class="hljs-number">79</span>) ~<span class="hljs-selector-attr">[io.druid.druid-processing-0.9.0.jar:0.9.0]</span><br>at io<span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.granularity</span><span class="hljs-selector-class">.QueryGranularity</span><span class="hljs-selector-class">.fromString</span>(QueryGranularity<span class="hljs-selector-class">.java</span>:<span class="hljs-number">59</span>) ~<span class="hljs-selector-attr">[io.druid.druid-processing-0.9.0.jar:0.9.0]</span><br>at sun<span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.NativeMethodAccessorImpl</span><span class="hljs-selector-class">.invoke0</span>(Native Method) ~<span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at sun<span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.NativeMethodAccessorImpl</span><span class="hljs-selector-class">.invoke</span>(NativeMethodAccessorImpl<span class="hljs-selector-class">.java</span>:<span class="hljs-number">62</span>) ~<span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at sun<span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.DelegatingMethodAccessorImpl</span><span class="hljs-selector-class">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-selector-class">.java</span>:<span class="hljs-number">43</span>) ~<span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.Method</span><span class="hljs-selector-class">.invoke</span>(Method<span class="hljs-selector-class">.java</span>:<span class="hljs-number">498</span>) ~<span class="hljs-selector-attr">[na:1.8.0_201]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.introspect</span><span class="hljs-selector-class">.AnnotatedMethod</span><span class="hljs-selector-class">.call1</span>(AnnotatedMethod<span class="hljs-selector-class">.java</span>:<span class="hljs-number">125</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>at com<span class="hljs-selector-class">.fasterxml</span><span class="hljs-selector-class">.jackson</span><span class="hljs-selector-class">.databind</span><span class="hljs-selector-class">.deser</span><span class="hljs-selector-class">.std</span><span class="hljs-selector-class">.StdValueInstantiator</span><span class="hljs-selector-class">.createFromString</span>(StdValueInstantiator<span class="hljs-selector-class">.java</span>:<span class="hljs-number">282</span>) ~<span class="hljs-selector-attr">[com.fasterxml.jackson.core.jackson-databind-2.4.6.jar:2.4.6]</span><br>... <span class="hljs-number">41</span> common frames omitted<br><br><span class="hljs-number">2019</span>-<span class="hljs-number">04</span>-<span class="hljs-number">03</span> <span class="hljs-number">11</span>:<span class="hljs-number">06</span>:<span class="hljs-number">08</span>,<span class="hljs-number">485</span> - <span class="hljs-selector-attr">[ERROR]</span> - from com<span class="hljs-selector-class">.metamx</span><span class="hljs-selector-class">.tranquility</span><span class="hljs-selector-class">.kafka</span><span class="hljs-selector-class">.KafkaConsumer</span> <span class="hljs-keyword">in</span> KafkaConsumer-<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>[问题原因]<br>在tranquility的最新版本(0.8.2)中 引用的druid为0.9.0，0.9.0的druid不支持查询粒度设置为5分钟</p><p>[解决方法]<br>下载druid 0.9.0源代码，修改代码文件(<a href="https://github.com/apache/incubator-druid/blob/0.9.0/processing/src/main/java/io/druid/granularity/QueryGranularity.java">https://github.com/apache/incubator-druid/blob/0.9.0/processing/src/main/java/io/druid/granularity/QueryGranularity.java)</a>), 在MillisIn中加入FIVE_MINUTE，之后build代码文件，替换io.druid.druid-processing-0.9.0.jar</p>]]></content>
    
    
    
    <tags>
      
      <tag>大数据</tag>
      
      <tag>Driud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「工具」mac设置ssh不掉线</title>
    <link href="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8Dmac%E8%AE%BE%E7%BD%AEssh%E4%B8%8D%E6%8E%89%E7%BA%BF/"/>
    <url>/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8Dmac%E8%AE%BE%E7%BD%AEssh%E4%B8%8D%E6%8E%89%E7%BA%BF/</url>
    
    <content type="html"><![CDATA[<p>我们在mac下面用终端连接远程服务器, 如果长时间不操作, 会发现连接会断开, 所以不得不重新连接, 很多时候我们不希望出现这种情况, 这个时候可以在服务器或者客户端设置<br>mac客户端设置  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 打开</span><br><span class="line">vi ~/.ssh/config</span><br><span class="line"># 添加, 60s向服务端请求一次</span><br><span class="line">ServerAliveInterval = 60</span><br><span class="line"># 设置文件权限</span><br><span class="line">chmod 600 ~/.ssh/config</span><br></pre></td></tr></tbody></table><blockquote><p>切记, 权限一定要设置否则没有效果</p></blockquote><p>Linux服务器设置  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 打开(服务端是文件 sshd_config)</span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"># 添加</span><br><span class="line">ClientAliveInterval 60</span><br><span class="line">ClientAliveCountMax 1</span><br></pre></td></tr></tbody></table><blockquote><p>SSH Server 每 60 秒就会自动发送一个信号给 Client，而等待 Client 回应</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「Javascript」TS入门-hello-world</title>
    <link href="/2023/07/27/%E3%80%8CJavaScript%E3%80%8DTS%E5%85%A5%E9%97%A8-hello-world/"/>
    <url>/2023/07/27/%E3%80%8CJavaScript%E3%80%8DTS%E5%85%A5%E9%97%A8-hello-world/</url>
    
    <content type="html"><![CDATA[<h3 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a><a href="#%E4%B8%80%E3%80%81%E7%AE%80%E4%BB%8B" title="一、简介"></a>一、简介</h3><p>TypeScript是微软开发的开源编程语言，它是Javascript的超集。  </p><h3 id="二、开发环境"><a href="#二、开发环境" class="headerlink" title="二、开发环境"></a><a href="#%E4%BA%8C%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" title="二、开发环境"></a>二、开发环境</h3><p>1.安装node.js，TypeScript需要编译成Javascript才能运行，Node.js提供了编译环境。</p><p>2.安装TypeScript编译工具，打开cmd，输入npm命令：</p><pre><code class="hljs">&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install -g typescript&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</code></pre><p>安装成功如图：<br><img src="/2023/07/27/%E3%80%8CJavaScript%E3%80%8DTS%E5%85%A5%E9%97%A8-hello-world/2019010101.png" alt="Typescript安装"></p><p>如果安装的过程中出现以下错误<br><img src="/2023/07/27/%E3%80%8CJavaScript%E3%80%8DTS%E5%85%A5%E9%97%A8-hello-world/2019010102.png" alt="Typescript安装"></p><p>请执行以下命令，将npm镜像地址切换到国内</p><p>npm –registry <a href="http://registry.cnpmjs.org/">http://registry.cnpmjs.org</a></p><h3 id="三、Hello-World"><a href="#三、Hello-World" class="headerlink" title="三、Hello World"></a><a href="#%E4%B8%89%E3%80%81Hello-World" title="三、Hello World"></a>三、Hello World</h3><p>新建文件Hello.ts，用记事本打开，并输入以下代码：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function hello(){</span><br><span class="line">return 'Hello World'</span><br><span class="line">}</span><br><span class="line">console.log(hello());</span><br></pre></td></tr></tbody></table><p>这段代码将在console中输出Hello World</p><p>ts文件为TypeScipt的后缀名，我们需要将TypeScript编译成Js，在命令行中输入以下命令执行编译:  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc hello.ts</span><br></pre></td></tr></tbody></table><p>命令执行后会在同目录生成Hello.js，为TypeScript编译文件</p><p>我们用Node.js运行该js文件，如图：<br><img src="/2023/07/27/%E3%80%8CJavaScript%E3%80%8DTS%E5%85%A5%E9%97%A8-hello-world/2019010103.png" alt="Typescript运行"></p><p>一个简单的Hello World程序就出来了</p>]]></content>
    
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
      <tag>前端</tag>
      
      <tag>TypeScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「工具」终端之美-目录相关的命令</title>
    <link href="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8D%E7%BB%88%E7%AB%AF%E4%B9%8B%E7%BE%8E-%E7%9B%AE%E5%BD%95%E7%9B%B8%E5%85%B3%E7%9A%84%E5%91%BD%E4%BB%A4/"/>
    <url>/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8D%E7%BB%88%E7%AB%AF%E4%B9%8B%E7%BE%8E-%E7%9B%AE%E5%BD%95%E7%9B%B8%E5%85%B3%E7%9A%84%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h3 id="cd-切换用户当前目录"><a href="#cd-切换用户当前目录" class="headerlink" title="cd 切换用户当前目录"></a><a href="#cd-%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95" title="cd 切换用户当前目录"></a>cd 切换用户当前目录</h3><p>用来切换用户当前目录当指定目录，这个指定目录可以是相对路径也可以是绝对路径<br>一些常用的特殊符号：</p><ul><li>~ 用户主目录</li><li>. 当前目录</li><li>.. 上一级目录</li></ul><p>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~ //切换到用户主目录</span><br><span class="line">cd /home //进入home目录</span><br><span class="line">cd ../ //进入上一级目录</span><br><span class="line">cd ../code //进入上一级目录下的code目录</span><br></pre></td></tr></tbody></table><h3 id="ls-显示指定目录下的文件和文件夹"><a href="#ls-显示指定目录下的文件和文件夹" class="headerlink" title="ls 显示指定目录下的文件和文件夹"></a><a href="#ls-%E6%98%BE%E7%A4%BA%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E5%92%8C%E6%96%87%E4%BB%B6%E5%A4%B9" title="ls 显示指定目录下的文件和文件夹"></a>ls 显示指定目录下的文件和文件夹</h3><p>用来查看当前目录或指定目录下的有那些文件和文件夹<br>一些常用参数：</p><ul><li>-a 显示全部文件</li><li>-l 所有信息用单列显示</li><li>-s 显示文件和目录的大小</li><li>-r 以文件名反序排列并输出目录内容列表</li></ul><p>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -a //列出当前文件夹下全部文件，包括隐藏文件</span><br><span class="line">ls -ls //以单列显示文件信息包括文件大小</span><br><span class="line">ls /home //显示home文件夹下的文件</span><br></pre></td></tr></tbody></table><h3 id="pwd-显示用户当前工作路径"><a href="#pwd-显示用户当前工作路径" class="headerlink" title="pwd 显示用户当前工作路径"></a><a href="#pwd-%E6%98%BE%E7%A4%BA%E7%94%A8%E6%88%B7%E5%BD%93%E5%89%8D%E5%B7%A5%E4%BD%9C%E8%B7%AF%E5%BE%84" title="pwd 显示用户当前工作路径"></a>pwd 显示用户当前工作路径</h3><p>用来显示用户当前的工作路径的 ，以绝对路径的形式呈现的<br>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd  ///home/liguifa/codes</span><br></pre></td></tr></tbody></table><h3 id="mkdir-创建文件夹"><a href="#mkdir-创建文件夹" class="headerlink" title="mkdir 创建文件夹"></a><a href="#mkdir-%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9" title="mkdir 创建文件夹"></a>mkdir 创建文件夹</h3><p>用来创建文件夹，如果没有指定路径则在当前目录下创建<br>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir test1 //在当前目录下目录下创建名为test1的文件夹</span><br><span class="line">mkdir ../test2 //在上一级目录下创建名为test2的文件夹</span><br><span class="line">mkdir /home/test3 //在home目录下创建名为test3的文件夹</span><br></pre></td></tr></tbody></table><h3 id="rm-删除文件或文件夹"><a href="#rm-删除文件或文件夹" class="headerlink" title="rm 删除文件或文件夹"></a><a href="#rm-%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9" title="rm 删除文件或文件夹"></a>rm 删除文件或文件夹</h3><p>用于删除文件或文件夹，如果不指定-r参数，则为删除文件<br>一些常用参数：</p><ul><li>-r 删除文件夹</li><li>-f 强制删除</li><li>-v 显示删除过程</li></ul><p>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm test.zip //删除当前目录下的test.zip文件</span><br><span class="line">rm ../test.zip //删除上一级目录下的test.zip文件夹</span><br><span class="line">rm -rfv /home/codes //强制删除home文件夹下的codes文件夹，并显示删除过程</span><br></pre></td></tr></tbody></table><h3 id="mv-移动文件或文件夹"><a href="#mv-移动文件或文件夹" class="headerlink" title="mv 移动文件或文件夹"></a><a href="#mv-%E7%A7%BB%E5%8A%A8%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9" title="mv 移动文件或文件夹"></a>mv 移动文件或文件夹</h3><p>用于移动文件或文件夹，指定-f参数，为移动文件夹，如果在目标位置和源位置相同则为重命名<br>一些常用参数：</p><ul><li>-r 移动文件夹</li><li>-f 强制移动</li><li>-v 显示删除过程</li></ul><p>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mv ../1.zip ../2.zip //重命名上一级目录下的1.zip为2.zip</span><br><span class="line">mv ../3.zip ../../4.zip //将上一级的3.zip移动到上上一级并修改名称为4.zip</span><br><span class="line">mv /home/5.zip ~/ //移动home目录下的5.zip到用户主目录下</span><br><span class="line">mv -r /home/codes ~/ //移动home目录下的codes文件到用户主目录下</span><br></pre></td></tr></tbody></table><h3 id="cp-复制文件或文件夹"><a href="#cp-复制文件或文件夹" class="headerlink" title="cp 复制文件或文件夹"></a><a href="#cp-%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9" title="cp 复制文件或文件夹"></a>cp 复制文件或文件夹</h3><p>用来将一个或多个源文件或者目录复制到指定的目的文件或目录<br>一些常用参数：</p><ul><li>-r 复制文件夹</li><li>-f 强制复制</li><li>-v 显示复制过程</li></ul><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp 1.zip ../ //复制当前目录下的1.zip到上一级目录下</span><br><span class="line">cp -r test /home //复制当前目录下的test文件夹到上一级目录</span><br></pre></td></tr></tbody></table><h3 id="scp-远程复制文件或文件夹"><a href="#scp-远程复制文件或文件夹" class="headerlink" title="scp 远程复制文件或文件夹"></a><a href="#scp-%E8%BF%9C%E7%A8%8B%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9" title="scp 远程复制文件或文件夹"></a>scp 远程复制文件或文件夹</h3><p>用于在两台主机之间复制文件或文件夹<br>一些常用参数：</p><ul><li>-r 复制文件夹</li><li>-f 强制复制</li><li>-v 显示复制过程</li></ul><p>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp ./2.zip liguifa@192.168.112.15:/home/iknow/ //将当前目录下的2.zip复制到192.168.112.15这台主机下的home/iknow文件夹下</span><br><span class="line">scp -r liguifa@192.168.112.15:/home/codes ./ //将192.168.112.15这台主机下的home/codes文件夹复制到当前目录下</span><br><span class="line">/* 远程机器路径：用户名@ip:目录 */</span><br></pre></td></tr></tbody></table><h3 id="tree-列出目录内容"><a href="#tree-列出目录内容" class="headerlink" title="tree 列出目录内容"></a><a href="#tree-%E5%88%97%E5%87%BA%E7%9B%AE%E5%BD%95%E5%86%85%E5%AE%B9" title="tree 列出目录内容"></a>tree 列出目录内容</h3><p>用于以树状图列出目录的内容<br>该命令需要执行安装  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew install tree //Mac安装</span><br><span class="line">yum install tree //center os安装</span><br><span class="line">apt-get install tree //ubuntu安装</span><br></pre></td></tr></tbody></table><p>一些常用参数：</p><ul><li>-F 文件夹后面加上&#x2F;</li><li>-C 彩色输出</li></ul><p>命令示例：  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tree ./public //列出public下的结构</span><br><span class="line">tree ./ | grep 04 //列出当前目录的结构并执行搜索</span><br></pre></td></tr></tbody></table><p><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8D%E7%BB%88%E7%AB%AF%E4%B9%8B%E7%BE%8E-%E7%9B%AE%E5%BD%95%E7%9B%B8%E5%85%B3%E7%9A%84%E5%91%BD%E4%BB%A4/2018122201.jpg" alt="tree 命令"></p>]]></content>
    
    
    
    <tags>
      
      <tag>工具</tag>
      
      <tag>终端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「工具」Homebrew安装</title>
    <link href="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DHomebrew%E5%AE%89%E8%A3%85/"/>
    <url>/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DHomebrew%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h3 id="脚步安装"><a href="#脚步安装" class="headerlink" title="脚步安装"></a><a href="#%E8%84%9A%E6%9C%AC%E5%AE%89%E8%A3%85" title="脚本安装"></a>脚步安装</h3><p>在命令行中输入并执行  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span><br></pre></td></tr></tbody></table><p>出现下面显示，按回车<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DHomebrew%E5%AE%89%E8%A3%85/2018121901.jpg" alt="brew 安装"><br>之后出现下图表示安装成功<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DHomebrew%E5%AE%89%E8%A3%85/2018121902.jpg" alt="brew 安装"></p><h3 id="测试安装"><a href="#测试安装" class="headerlink" title="测试安装"></a><a href="#%E6%B5%8B%E8%AF%95%E5%AE%89%E8%A3%85" title="测试安装"></a>测试安装</h3><p>在命令行中输入并执行  </p><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew help</span><br></pre></td></tr></tbody></table><p>出现下图表示brew无误<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DHomebrew%E5%AE%89%E8%A3%85/2018121903.jpg" alt="brew 安装"></p>]]></content>
    
    
    
    <tags>
      
      <tag>工具</tag>
      
      <tag>Linux</tag>
      
      <tag>Homebrew</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「工具」Chrome-devtool使用指南</title>
    <link href="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<p>在这篇文章中，我们会用Performance工具去分析一个现有的在线DEMO，然后教会你怎么去分析，从而找到性能瓶颈。</p><p>1.打开Chrome的匿名模式。匿名模式可以保证Chrome在一个相对干净的环境下运行。比如说，你安装了许多chrome插件，这些插件可能会影响我们分析性能表现。<br>2.在匿名模式下打开右边这个链接，DEMO，这个网页就是我们要用来分析的DEMO。这个页面里都是很多上下移动的蓝色小方块。<br>3.按下Command+Opiton+I（Mac）或者Control+shift+I (Windows, Linux) 来打开Devtools <img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121801.png" alt="Alt text"></p><h3 id="模拟移动设备的CPU"><a href="#模拟移动设备的CPU" class="headerlink" title="模拟移动设备的CPU"></a><a href="#%E6%A8%A1%E6%8B%9F%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E7%9A%84CPU" title="模拟移动设备的CPU"></a>模拟移动设备的CPU</h3><p>移动设备的CPU一般比台式机和笔记本弱很多。当你想分析页面的时候，可以用CPU控制器（CPU Throttling）来模拟移动端设备CPU。</p><p>1.在DevTools中，点击 Performance 的 tab。<br>2.确保 Screenshots checkbox 被选中<br>3.点击 Capture Settings（⚙️）按钮，DevTools会展示很多设置，来模拟各种状况<br>4.对于模拟CPU，选择2x slowdown，于是Devtools就开始模拟两倍低速CPU<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121802.png" alt="Alt text"></p><h3 id="设置DEMO"><a href="#设置DEMO" class="headerlink" title="设置DEMO"></a><a href="#%E8%AE%BE%E7%BD%AEDEMO" title="设置DEMO"></a>设置DEMO</h3><p>为了使得这个DEMO有相对统一的运行表现（不同的读者，机器的性能千差万别）。这个DEMO提供了自定义功能，用来确保这个DEMO的统一表现。</p><p>1.一直点击 Add 10 这个按钮直到你能很明显看到蓝色小方块移动变慢，在性能比较好的机器上，大概要点击20次左右。<br>2.点击 Optimize按钮，你会发现蓝色小方块会变的很快而且动画变得平滑。<br>3.点击 un-optimize 按钮，蓝色小方块又会变成之前的模样。</p><h3 id="记录运行时性能表现"><a href="#记录运行时性能表现" class="headerlink" title="记录运行时性能表现"></a><a href="#%E8%AE%B0%E5%BD%95%E8%BF%90%E8%A1%8C%E6%97%B6%E6%80%A7%E8%83%BD%E8%A1%A8%E7%8E%B0" title="记录运行时性能表现"></a>记录运行时性能表现</h3><p>在之前的DEMO中，当你运行优化模式的时候，蓝色小方块移动地非常快。为什么呢？明明两个模式都是移动了同样数量的小方块而且移动的时间也一样。那么现在我们在Performance界面下录制下发生的一切，并且学习如何分析这个记录，从而找到非优化模式下的性能瓶颈。</p><p>1.在DevTools中，点击 Record 。这时候Devtools就开始录制各种性能指标<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121803.png" alt="Alt text"><br>2.等待几分钟<br>3.点击Stop按钮，Devtools停止录制，处理数据，然后显示性能报告<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121804.png" alt="Alt text"><br>wow，看起来有非常多的数据，别害怕，我们一个一个来介绍</p><h4 id="分析报告"><a href="#分析报告" class="headerlink" title="分析报告"></a><a href="#%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A" title="分析报告"></a>分析报告</h4><p>一旦你得到了页面的性能表现报告，那么就可以用它来分析页面的性能，从而找到性能瓶颈。<br>分析每一秒的帧</p><p>FPS（frames per second）是用来分析动画的一个主要性能指标。能保持在60的FPS的话，那么用户体验就是不错的。</p><p>1.观察FPS图表，如果你发现了一个红色的长条，那么就说明这些帧存在严重问题，有可能导致非常差的用户体验。一般来说，绿色的长条越高，说明FPS越高，用户体验越好。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121805.png" alt="Alt text"><br>2.就在FPS图表下方，你会看到CPU图表。在CPU图表中的各种颜色与Summary面板里的颜色是相互对应的，Summary面板就在Performance面板的下方。CPU图表中的各种颜色代表着在这个时间段内，CPU在各种处理上所花费的时间。如果你看到了某个处理占用了大量的时间，那么这可能就是一个可以找到性能瓶颈的线索。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121806.png" alt="Alt text"><br>3.把鼠标移动到FPS，CPU或者NET图表之上，DevToos就会展示这个时间点界面的截图。左右移动鼠标，可以重发当时的屏幕录像。这被称为scrubbing, 他可以用来分析动画的各个细节。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121807.png" alt="Alt text"><br>4.在Frames图表中，把鼠标移动到绿色条状图上，Devtools会展示这个帧的FPS。每个帧可能都在60以下，都没有达到60的标准。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121808.png" alt="Alt text"><br>当然这个对于DEMO，可以相当容易观察到性能的问题。但是在现实使用场景下，就不是那么容易观察到了。所以要把常常使用这些工具来分析页面。<br>小功能：显示实时FPS面板<br>另外一个好用的小工具就是实时FPS面板，它可以实时展示页面的FPS指标<br>5.按下 Command+Shift+P（Mac）或者 Control+Shift+P(Windows, Linux) 打开命令菜单<br>6.输入Rendering，点选Show Rendering<br>7.在Rendering面板里，激活FPS Meter。FPS实时面板就出现在页面的右上方。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121809.png" alt="Alt text"><br>8.关闭FPS Meter只要按下Escape就可以了。这篇指南里暂时用不上这个功能。</p><h4 id="定位瓶颈"><a href="#定位瓶颈" class="headerlink" title="定位瓶颈"></a><a href="#%E5%AE%9A%E4%BD%8D%E7%93%B6%E9%A2%88" title="定位瓶颈"></a>定位瓶颈</h4><p>现在已经确定到这个页面的动画性能表现不太好，那么下一步就是找到为什么</p><p>1.注意Summary面板，你会发现CPU花费了大量的时间在rendering上。因为提高性能就是一门做减法的艺术，你的目标就是减少rendering的时间<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121810.png" alt="Alt text"><br>2.展开Main图表，Devtools展示了主线程运行状况。X轴代表着时间。每个长条代表着一个event。长条越长就代表这个event花费的时间越长。Y轴代表了调用栈（call stack）。在栈里，上面的event调用了下面的event。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121811.png" alt="Alt text"><br>3.在性能报告中，有很多的数据。可以通过双击，拖动等等动作来放大缩小报告范围，从各种时间段来观察分析报告。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121812.png" alt="Alt text"><br>4.在事件长条的右上角出，如果出现了红色小三角，说明这个事件是存在问题的，需要特别注意。<br>5.双击这个带有红色小三角的的事件。在Summary面板会看到详细信息。注意reveal这个链接，双击它会让高亮触发这个事件的event。如果点击了app.js:94这个链接，就会跳转到对应的代码处。<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121813.png" alt="Alt text"><br>6.在app.update这个事件的长条下方，有很多被触发的紫色长条。如果放大这些事件长条，你会看到它们每个都带有红色小三角。点击其中一个紫色事件长条，Devtools在Summary面板里展示了更多关于这个事件的信息。确实，这里有很多reflow的警告。<br>7.在summary面板里点击app.js:70链接，Devtools会跳转到需要优化的代码处<br><img src="/2023/07/27/%E3%80%8C%E5%B7%A5%E5%85%B7%E3%80%8DChrome-devtool%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/2018121814.png" alt="Alt text"><br>OK！Devtools里面还有很多很多指标需要你去探索，但是，对于怎么用Devtools去分析网页的运行时性能表现，你现在已经有了一个基本的概念。</p>]]></content>
    
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>工具</tag>
      
      <tag>Chrome</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「Redis」Redis常用命令</title>
    <link href="/2023/07/27/%E3%80%8CRedis%E3%80%8DRedis%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2023/07/27/%E3%80%8CRedis%E3%80%8DRedis%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<table><thead><tr><th>#</th><th>命令</th><th>参数</th><th>例子</th><th>功能</th><th>返回值</th><th>原理</th></tr></thead><tbody><tr><td>1</td><td>keys</td><td>pattern: 键名配置模式</td><td>keys *</td><td>输出所有键</td><td>返回键列表</td><td>遍历所有键，和输入的模式做匹配，时间复杂度为O(n)，当Redis保存大量键时，线上环境禁止使用</td></tr><tr><td>2</td><td>dbsize</td><td></td><td>dbsize</td><td>获取键总数</td><td>返回键总数</td><td>直接获取Redis内置键总数变量，时间复杂度为O(1)</td></tr><tr><td>3</td><td>exists</td><td>key: 键名</td><td>exists key</td><td>检查键是否存在</td><td>1：键存在 0：键不存在</td><td></td></tr><tr><td>4</td><td>del</td><td>key: 键名列表</td><td>del key1 key2</td><td>删除键</td><td>1：删除成功 0：键不存在</td><td></td></tr><tr><td>5</td><td>expire</td><td>key: 键名 seconds:过期时间</td><td>expire key1 10</td><td>键过期</td><td>1：设置成功 0：键不存在</td><td></td></tr><tr><td>6</td><td>ttl</td><td>key:键名</td><td>ttl key1</td><td>获取剩余过期时间</td><td>&gt;&#x3D;0：键剩余的过期时间 -1：键没有设置过期时间 -2：键不存在</td><td></td></tr><tr><td>7</td><td>type</td><td>key: 键名</td><td>type key1</td><td>获取键的数据类型</td><td>返回键类型 如果键不存在则返回none</td><td></td></tr><tr><td>8</td><td>set</td><td>key: 键名 value: 值</td><td>set name hello</td><td>设置键</td><td></td><td></td></tr><tr><td>9</td><td>get</td><td>key:键名</td><td>get name</td><td>获取键值</td><td>键值</td><td></td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>Redis</tag>
      
      <tag>数据库</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「JavaScript」JavaScript作用域</title>
    <link href="/2023/07/27/%E3%80%8CJavaScript%E3%80%8DJavaScript%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    <url>/2023/07/27/%E3%80%8CJavaScript%E3%80%8DJavaScript%E4%BD%9C%E7%94%A8%E5%9F%9F/</url>
    
    <content type="html"><![CDATA[<p>JaveScript 是Web前端开发的最重要的语言，在JavaScript中作用域是一个重要的基础知识点。  </p><p>在JavaScript中共有三种作用域，分别是全局作用域、函数左右域和块级作用域。  </p><p>本文会先对三种作用域做介绍，之后举一个常见的例子做整体介绍。  </p><h4 id="1、全局作用域"><a href="#1、全局作用域" class="headerlink" title="1、全局作用域"></a><a href="#1%E3%80%81%E5%85%A8%E5%B1%80%E4%BD%9C%E7%94%A8%E5%9F%9F" title="1、全局作用域"></a>1、全局作用域</h4><p>全局作用域，故名思议，全局作用域就是整个JavaScript代码范围。如下代码所示:</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> a = <span class="hljs-string">&quot;Hello&quot;</span>;  <br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(a);  <span class="hljs-comment">//Hello  </span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i in a)&#123;  <br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(a[i]); <span class="hljs-comment">//H、e、l、l、o  </span><br>&#125;  <br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(i);  <span class="hljs-comment">// 4  </span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"></span>)&#123;  <br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(a); <span class="hljs-comment">//Hello  </span><br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(i) <span class="hljs-comment">// 4  </span><br>&#125;  <br>func();<br></code></pre></td></tr></table></figure><p>在这段代码中，我们先声明了变量a，并对a赋值Hello，a是我们在全局上声明的变量，此时a的作用域为全局作用域，我们之后在直接输出、循环中输出、函数中输出都没有错误，说明此时a在任何位置均可以访问。同时在for循环中我们声明了变量i，for循环结束之后变量i并没有释放，而是输出了最后的值4，说明此时变量i的作用域为全局作用域。</p><h3 id="2、函数作用域"><a href="#2、函数作用域" class="headerlink" title="2、函数作用域"></a><a href="#2%E3%80%81%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F" title="2、函数作用域"></a>2、函数作用域</h3><p>函数作用域，故名思议，函数作用域就是生个函数范围。如下代码所示:</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params"></span>) &#123;  <br>   <span class="hljs-keyword">var</span> a = <span class="hljs-string">&quot;Hello&quot;</span>;  <br>   <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;  <br>   switch (i) &#123;  <br>           case <span class="hljs-number">0</span>: <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(a); <span class="hljs-comment">//hello  </span><br>    &#125;  <br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(a); <span class="hljs-comment">//hello  </span><br>&#125;  <br>func();  <br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(a); <span class="hljs-comment">//Error  </span><br><span class="hljs-keyword">var</span> t = <span class="hljs-string">&quot;hello2&quot;</span>;  <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fun2</span>(<span class="hljs-params"></span>) &#123;  <br>    <span class="hljs-keyword">var</span> t = <span class="hljs-string">&quot;helllo3&quot;</span>;  <br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(t); <span class="hljs-comment">//hello3  </span><br>&#125;  <br><br></code></pre></td></tr></table></figure><p>在这段代码中，我们先声明了函数fun，在函数内部我们声明了变量a，此时a的作用域为函数作用域，之后我们在switch中输出，尽管我们的switch被大括号包裹，但是我们依然可以访问，说明函数作用域可以在函数的任意位置范围，之后在函数之外，我们输出变量a，此时就会出错，因为变量a的作用域为函数作用域，在函数为无法访问。在fun2中，我们声明了一个与全局变量同名的变量t，此时函数作用域中的t为覆盖全局作用域的t，这里的规则是子作用域覆盖父作用域，而全局作用域做为所有作用域的顶层作用域，一定会被子作用域的同名变量覆盖。</p><h3 id="3、块级作用域"><a href="#3、块级作用域" class="headerlink" title="3、块级作用域"></a><a href="#3%E3%80%81%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F" title="3、块级作用域"></a>3、块级作用域</h3><p>在ES6中，JavaScript引入了块级作用域，块级作用域的作用域范围为代码块。如下代码所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-meta">&quot;use strict&quot;</span>  <br>&#123;      <br>    <span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>;  <br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <br>&#125;  <br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">//Error</span><br></code></pre></td></tr></table></figure><p>在上面代码中，我们使用use strict启用ES6，此时块级作用域起效，在之后的代码块中，变量a为块级作用域，在代码中访问正常，而在代码我们无法访问，与函数作用域类似，我们依然可以访问父作用域的变量，当发生变量重名是会覆盖父作用域的变量。</p><h3 id="4、例子"><a href="#4、例子" class="headerlink" title="4、例子"></a><a href="#4%E3%80%81%E4%BE%8B%E5%AD%90" title="4、例子"></a>4、例子</h3><p>与作用域相关的问题中，大多出在for中，如下代码所示：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> funcs = [];  <br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++) &#123;  <br>    funcs.<span class="hljs-built_in">push</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;  <br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(i);  <br>    &#125;);  <br>&#125;  <br>funcs.forEach(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;  <br>    fun();  <br>&#125;);  <br><br></code></pre></td></tr></table></figure><p>我们执行这段代码，此时我们期望输出0、1、2、3，但是在实际运行时，我们输出了4、4、4、4，这是因为var声明的变量只能是全局作用域或函数作用域，如果我们这段代码运行在全局作用域的，那么变量i的作用域就是全局作用域，在整个作用域中变量i只有一个值，也就是在funs中我们引用的变量i和全局作用域的i是同一个并且只有一个，当循环结束后，变量的值变成了4，我们在执行funs，那么输出的就是变量i的值4。那么很明显这个问题是作用域没有独立引起的，解决办法就是新建一样作用域。</p><h4 id="4-1-方法1"><a href="#4-1-方法1" class="headerlink" title="4.1 方法1"></a><a href="#4-1-%E6%96%B9%E6%B3%951" title="4.1 方法1"></a>4.1 方法1</h4><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> funcs = [];<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;  <br>    funcs.<span class="hljs-built_in">push</span>((<span class="hljs-keyword">function</span> (<span class="hljs-params">in_i</span>) &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  <br>            <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(in_i);  <br>        &#125;  <br>    &#125;)(i));  <br>&#125;  <br>funcs.forEach(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  <br>    fun();  <br>&#125;);<br></code></pre></td></tr></table></figure><p>如上面的代码所示，我们使用闭包，闭包就是一个立即执行的函数，此时我们使用闭包新建了一个函数作用域，并把变量i参入，在闭包内部会拷贝一份变量i到in_i，此时for内部不再是单一作用域，做个作用域有多个in_i。</p><h4 id="4-2-方法2"><a href="#4-2-方法2" class="headerlink" title="4.2 方法2"></a><a href="#4-2-%E6%96%B9%E6%B3%952" title="4.2 方法2"></a>4.2 方法2</h4><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> funcs = [];<span class="hljs-keyword">for</span>(let i = <span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++) &#123;  <br>    funcs.<span class="hljs-built_in">push</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;  <br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(i);  <br>    &#125;);  <br>&#125;  <br>funcs.forEach(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;  <br>    fun();  <br>&#125;);<br></code></pre></td></tr></table></figure><p>如上代码所示，我们将var替换成了let，let是ES6声明变量的方法，此时let声明后i变成了块级作用域变量，也就是新建了一个块级作用域，在for内部i不再是同一个，而是在一个作用域中一个变量i。</p>]]></content>
    
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
      <tag>前端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「Hadoop」Hadoop常用命令</title>
    <link href="/2023/07/27/%E3%80%8CHadoop%E3%80%8DHadoop%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2023/07/27/%E3%80%8CHadoop%E3%80%8DHadoop%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h3 id="FS-Shell"><a href="#FS-Shell" class="headerlink" title="FS Shell"></a><a href="#FS-Shell" title="FS Shell"></a>FS Shell</h3><p>调用文件系统(FS)Shell命令应使用 bin&#x2F;hadoop fs 的形式。 所有的的FS shell命令使用URI路径作为参数。URI格式是scheme:&#x2F;&#x2F;authority&#x2F;path。对HDFS文件系统，scheme是hdfs，对本地文件系统，scheme是file。其中scheme和authority参数都是可选的，如果未加指定，就会使用配置中指定的默认scheme。一个HDFS文件或目录比如&#x2F;parent&#x2F;child可以表示成hdfs:&#x2F;&#x2F;namenode:namenodeport&#x2F;parent&#x2F;child，或者更简单的&#x2F;parent&#x2F;child（假设你配置文件中的默认值是namenode:namenodeport）。大多数FS Shell命令的行为和对应的Unix Shell命令类似，不同之处会在下面介绍各命令使用详情时指出。出错信息会输出到stderr，其他信息输出到stdout。  </p><h5 id="cat"><a href="#cat" class="headerlink" title="cat"></a><a href="#cat" title="cat"></a>cat</h5><p>使用方法：hadoop fs -cat URI [URI …]<br>将路径指定文件的内容输出到stdout。<br>示例：</p><ul><li>hadoop fs -cat hdfs:&#x2F;&#x2F;host1:port1&#x2F;file1 hdfs:&#x2F;&#x2F;host2:port2&#x2F;file2</li><li>hadoop fs -cat file:&#x2F;&#x2F;&#x2F;file3 &#x2F;user&#x2F;hadoop&#x2F;file4<br>返回值：成功返回0，失败返回-1。</li></ul><h5 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a><a href="#chgrp" title="chgrp"></a>chgrp</h5><p>使用方法：hadoop fs -chgrp [-R] GROUP URI [URI …] Change group association of files. With -R, make the change recursively through the directory structure. The user must be the owner of files, or else a super-user. Additional information is in the Permissions User Guide. –&gt;<br>改变文件所属的组。使用-R将使改变在目录结构下递归进行。命令的使用者必须是文件的所有者或者超级用户。更多的信息请参见HDFS权限用户指南。</p><h5 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a><a href="#chmod" title="chmod"></a>chmod</h5><p>使用方法：hadoop fs -chmod [-R] &lt;MODE[,MODE]… | OCTALMODE&gt; URI [URI …]<br>改变文件的权限。使用-R将使改变在目录结构下递归进行。命令的使用者必须是文件的所有者或者超级用户。更多的信息请参见HDFS权限用户指南。</p><h6 id="chown"><a href="#chown" class="headerlink" title="chown"></a><a href="#chown" title="chown"></a>chown</h6><p>使用方法：hadoop fs -chown [-R] [OWNER][:[GROUP]] URI [URI ]<br>改变文件的拥有者。使用-R将使改变在目录结构下递归进行。命令的使用者必须是超级用户。更多的信息请参见HDFS权限用户指南。</p><h5 id="copyFromLocal"><a href="#copyFromLocal" class="headerlink" title="copyFromLocal"></a><a href="#copyFromLocal" title="copyFromLocal"></a>copyFromLocal</h5><p>使用方法：hadoop fs -copyFromLocal URI<br>除了限定源路径是一个本地文件外，和put命令相似。</p><h5 id="copyToLocal"><a href="#copyToLocal" class="headerlink" title="copyToLocal"></a><a href="#copyToLocal" title="copyToLocal"></a>copyToLocal</h5><p>使用方法：hadoop fs -copyToLocal [-ignorecrc] [-crc] URI<br>除了限定目标路径是一个本地文件外，和get命令类似。</p><h5 id="cp"><a href="#cp" class="headerlink" title="cp"></a><a href="#cp" title="cp"></a>cp</h5><p>使用方法：hadoop fs -cp URI [URI …]<br>将文件从源路径复制到目标路径。这个命令允许有多个源路径，此时目标路径必须是一个目录。<br>示例：</p><ul><li>hadoop fs -cp &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2</li><li>hadoop fs -cp &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2 &#x2F;user&#x2F;hadoop&#x2F;dir<br>返回值：成功返回0，失败返回-1。</li></ul><h5 id="du"><a href="#du" class="headerlink" title="du"></a><a href="#du" title="du"></a>du</h5><p>使用方法：hadoop fs -du URI [URI …]<br>显示目录中所有文件的大小，或者当只指定一个文件时，显示此文件的大小。<br>示例：</p><ul><li>hadoop fs -du &#x2F;user&#x2F;hadoop&#x2F;dir1 &#x2F;user&#x2F;*   hadoop&#x2F;file1 hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;dir1<br>返回值：成功返回0，失败返回-1。</li></ul><h5 id="dus"><a href="#dus" class="headerlink" title="dus"></a><a href="#dus" title="dus"></a>dus</h5><p>使用方法：hadoop fs -dus<br>显示文件的大小。</p><h5 id="expunge"><a href="#expunge" class="headerlink" title="expunge"></a><a href="#expunge" title="expunge"></a>expunge</h5><p>使用方法：hadoop fs -expunge<br>清空回收站。请参考HDFS设计文档以获取更多关于回收站特性的信息。</p><h5 id="get"><a href="#get" class="headerlink" title="get"></a><a href="#get" title="get"></a>get</h5><p>使用方法：hadoop fs -get [-ignorecrc] [-crc]<br>复制文件到本地文件系统。可用-ignorecrc选项复制CRC校验失败的文件。使用-crc选项复制文件以及CRC信息。<br>示例：</p><ul><li>hadoop fs -get &#x2F;user&#x2F;hadoop&#x2F;file localfile</li><li>hadoop fs -get hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;file localfile<br>返回值：成功返回0，失败返回-1。</li></ul><h5 id="getmerge"><a href="#getmerge" class="headerlink" title="getmerge"></a><a href="#getmerge" title="getmerge"></a>getmerge</h5><p>使用方法：hadoop fs -getmerge [addnl]<br>接受一个源目录和一个目标文件作为输入，并且将源目录中所有的文件连接成本地目标文件。addnl是可选的，用于指定在每个文件结尾添加一个换行符。</p><h5 id="ls"><a href="#ls" class="headerlink" title="ls"></a><a href="#ls" title="ls"></a>ls</h5><p>使用方法：hadoop fs -ls<br>如果是文件，则按照如下格式返回文件信息：<br>文件名 &lt;副本数&gt; 文件大小 修改日期 修改时间 权限 用户ID 组ID<br>如果是目录，则返回它直接子文件的一个列表，就像在Unix中一样。目录返回列表的信息如下：<br>目录名</p><p>修改日期 修改时间 权限 用户ID 组ID<br>示例：</p><ul><li>hadoop fs -ls &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2 hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;dir1 &#x2F;nonexistentfile<br>返回值：成功返回0，失败返回-1。</li></ul><h5 id="lsr"><a href="#lsr" class="headerlink" title="lsr"></a><a href="#lsr" title="lsr"></a>lsr</h5><p>使用方法：hadoop fs -lsr<br>ls命令的递归版本。类似于Unix中的ls -R。</p><h5 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a><a href="#mkdir" title="mkdir"></a>mkdir</h5><p>使用方法：hadoop fs -mkdir<br>接受路径指定的uri作为参数，创建这些目录。其行为类似于Unix的mkdir -p，它会创建路径中的各级父目录。<br>示例：</p><ul><li>hadoop fs -mkdir &#x2F;user&#x2F;hadoop&#x2F;dir1 &#x2F;user&#x2F;hadoop&#x2F;dir2</li><li>hadoop fs -mkdir hdfs:&#x2F;&#x2F;host1:port1&#x2F;user&#x2F;hadoop&#x2F;dir hdfs:&#x2F;&#x2F;host2:port2&#x2F;user&#x2F;hadoop&#x2F;dir<br>返回值：成功返回0，失败返回-1。</li></ul><h5 id="movefromLocal"><a href="#movefromLocal" class="headerlink" title="movefromLocal"></a><a href="#movefromLocal" title="movefromLocal"></a>movefromLocal</h5><p>使用方法：dfs -moveFromLocal<br>输出一个”not implemented“信息。</p><h6 id="mv"><a href="#mv" class="headerlink" title="mv"></a><a href="#mv" title="mv"></a>mv</h6><p>使用方法：hadoop fs -mv URI [URI …]<br>将文件从源路径移动到目标路径。这个命令允许有多个源路径，此时目标路径必须是一个目录。不允许在不同的文件系统间移动文件。<br>示例：</p><ul><li>hadoop fs -mv &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2</li><li>hadoop fs -mv hdfs:&#x2F;&#x2F;host:port&#x2F;file1 hdfs:&#x2F;&#x2F;host:port&#x2F;file2 hdfs:&#x2F;&#x2F;host:port&#x2F;file3 hdfs:&#x2F;&#x2F;host:port&#x2F;dir1<br>返回值：成功返回0，失败返回-1。</li></ul><h6 id="put"><a href="#put" class="headerlink" title="put"></a><a href="#put" title="put"></a>put</h6><p>使用方法：hadoop fs -put …<br>从本地文件系统中复制单个或多个源路径到目标文件系统。也支持从标准输入中读取输入写入目标文件系统。</p><ul><li>hadoop fs -put localfile &#x2F;user&#x2F;hadoop&#x2F;hadoopfile</li><li>hadoop fs -put localfile1 localfile2 &#x2F;user&#x2F;hadoop&#x2F;hadoopdir</li><li>hadoop fs -put localfile hdfs:&#x2F;&#x2F;host:port&#x2F;hadoop&#x2F;hadoopfile</li><li>hadoop fs -put - hdfs:&#x2F;&#x2F;host:port&#x2F;hadoop&#x2F;hadoopfile<br>从标准输入中读取输入。<br>返回值：成功返回0，失败返回-1。</li></ul><h6 id="rm"><a href="#rm" class="headerlink" title="rm"></a><a href="#rm" title="rm"></a>rm</h6><p>使用方法：hadoop fs -rm URI [URI …]<br>删除指定的文件。只删除非空目录和文件。请参考rmr命令了解递归删除。<br>示例：</p><ul><li>hadoop fs -rm hdfs:&#x2F;&#x2F;host:port&#x2F;file &#x2F;user&#x2F;hadoop&#x2F;emptydir<br>返回值：成功返回0，失败返回-1。</li></ul><h6 id="rmr"><a href="#rmr" class="headerlink" title="rmr"></a><a href="#rmr" title="rmr"></a>rmr</h6><p>使用方法：hadoop fs -rmr URI [URI …]<br>delete的递归版本。<br>示例：</p><ul><li>hadoop fs -rmr &#x2F;user&#x2F;hadoop&#x2F;dir</li><li>hadoop fs -rmr hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;dir<br>返回值：成功返回0，失败返回-1。</li></ul><h6 id="setrep"><a href="#setrep" class="headerlink" title="setrep"></a><a href="#setrep" title="setrep"></a>setrep</h6><p>使用方法：hadoop fs -setrep [-R]<br>改变一个文件的副本系数。-R选项用于递归改变目录下所有文件的副本系数。<br>示例：</p><ul><li>hadoop fs -setrep -w 3 -R &#x2F;user&#x2F;hadoop&#x2F;dir1<br>返回值：成功返回0，失败返回-1。</li></ul><h6 id="stat"><a href="#stat" class="headerlink" title="stat"></a><a href="#stat" title="stat"></a>stat</h6><p>使用方法：hadoop fs -stat URI [URI …]<br>返回指定路径的统计信息。<br>示例：</p><ul><li>hadoop fs -stat path<br>返回值：成功返回0，失败返回-1。</li></ul><h6 id="tail"><a href="#tail" class="headerlink" title="tail"></a><a href="#tail" title="tail"></a>tail</h6><p>使用方法：hadoop fs -tail [-f] URI<br>将文件尾部1K字节的内容输出到stdout。支持-f选项，行为和Unix中一致。<br>示例：</p><ul><li>hadoop fs -tail pathname<br>返回值：成功返回0，失败返回-1。</li></ul><h6 id="test"><a href="#test" class="headerlink" title="test"></a><a href="#test" title="test"></a>test</h6><p>使用方法：hadoop fs -test -[ezd] URI<br>选项：<br>    -e 检查文件是否存在。如果存在则返回0。<br>    -z 检查文件是否是0字节。如果是则返回0。<br>    -d 如果路径是个目录，则返回1，否则返回0。<br>示例：</p><ul><li>hadoop fs -test -e filename</li></ul><h6 id="text"><a href="#text" class="headerlink" title="text"></a><a href="#text" title="text"></a>text</h6><p>使用方法：hadoop fs -text<br>将源文件输出为文本格式。允许的格式是zip和TextRecordInputStream。</p><h6 id="touchz"><a href="#touchz" class="headerlink" title="touchz"></a><a href="#touchz" title="touchz"></a>touchz</h6><p>使用方法：hadoop fs -touchz URI [URI …]<br>创建一个0字节的空文件。<br>示例：</p><ul><li>hadoop fs -touchz pathname<br>返回值：成功返回0，失败返回-1。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>大数据</tag>
      
      <tag>Hadoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>「SQLServer」灵活的DBContext生命周期管理</title>
    <link href="/2023/07/27/%E3%80%8CSQLServer%E3%80%8D%E7%81%B5%E6%B4%BB%E7%9A%84DBContext%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86/"/>
    <url>/2023/07/27/%E3%80%8CSQLServer%E3%80%8D%E7%81%B5%E6%B4%BB%E7%9A%84DBContext%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>我们在开发过程中总是回遇到的许多架构上的问题，在这些架构问题中，最常见的是 DbContext 生命周期的管理以及跨域调用时遇到的 request 上下文限制的问题。  </p><p> <br>首先说说 DBContext的Scope 定义问题。根据微软的建议， DBContext是一个轻量级的，类似于 Unit of work模式的实体上下文，其生命周期对应一次业务操作，比如一次 REST API 调用，一次线程中的批处理业务等等，但总的原则是其生命周期应该尽可能短，另外 DBContext的生命周期也隐含地对应一次数据库事务。<br> <br>DBContext生命周期定义有许多的方式，如在一个 DAO函数中创建 DBContext，并在离开函数前销毁的模式，或者在HTTP request开头创建，在 HTTP request结尾销毁的模式，这些模式各有利弊，在一个 DAO函数中创建 DBContext这中模式较好地避免了死锁的发生，但是频繁且碎片化的生命周期导致事务完全失效且对性能有一定的影响，HTTP request的方式灵活性较差，一旦脱离 web上下文，就难以找到更合适的粒度，并且完全依赖运行环境上下文的模式为业务的在不同环境下的复用带来了较大的限制。 这个DBContext的模式有一个共同的问题，就是 DBContext生命周期的定义是不可变的，不能根据业务的需要进行覆盖和重新定义 ，这也是导致我们目前开发中遇到各种问题和障碍的主要原因。<br> <br>DBContext以及其对应的生命周期归根到底是一种资源（类似于 Session），既然是资源，就应该被灵活使用， 在不同的运行环境中拥有不同的行为，而在我们开发 Service和业务逻辑时，并不能完全确定资源的使用方式，我们可以定义 DBContext在当前业务下的生命周期，但是当局部的业务逻辑被放到更大或者完全不同的业务层面中时，作为资源（ Session）是需要被重新定义以适应新的业务上下文的。所以，我们需要一种可以在任何粒度下使用，并可以按需覆盖的 DBContext生命周期管理架构，以便我们在任何业务上下文中都能灵活控制事务和生命周期。<br> <br>针对这个需求，目前已经有不少成熟的思路和解决方案，比较好的是DbContextScope模式和其对应的开源代码，可以参考其在 GitHub上的工程：<a href="https://github.com/mehdime/DbContextScope">https://github.com/mehdime/DbContextScope</a><br> <br>DbContextScope使用.Net 的CallContext机制（<a href="http://www.cnblogs.com/vwxyzh/archive/2009/02/21/1395416.html">http://www.cnblogs.com/vwxyzh/archive/2009/02/21/1395416.html</a> ）来实现同一调用上下文中资源的共享，其典型的调用方式如下面的截图所示：<br><img src="/2023/07/27/%E3%80%8CSQLServer%E3%80%8D%E7%81%B5%E6%B4%BB%E7%9A%84DBContext%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86/282A72E2-72B7-4CA1-891C-4F403D54C9E9.png"><br>使用中在 Service层中每个可能被单独调用的方法中显示声明 DBContextScope，当同一AppDomain 中如果有嵌套调用，最外部的 scope会保证所有内部的scope都使用同一个 DBContext，保证了事务和生命周期能被灵活的管理，大家还可以根据不同的业务来选择最合适的 scope，但是即使大家没有精力考虑生命周期的合理定义，也只需要简单的在所有函数中都加上 DBContextScope，就能保证适应绝大多数的调用场景。使用这种模式后，大家也不再需要依赖 HTTP Request或者将Service 声明为多实例，为开发提供更多的灵活性。<br> <br>另外针对跨域调用的限制， CallContext也是解决该问题的合理方案， Plugin Framework随后会提供一套统一的框架共大家在跨域调用时将必要的资源上下文通过 CallContext跨域传递给被调用方，包括在 Web Controller中对跨同一AppDomain 的service多次调用的 DBContext的生命周期进行统一管理，以及提供方法让大家将 HTTP Context中的必要信息传递给跨域的 Service层。</p>]]></content>
    
    
    
    <tags>
      
      <tag>SQLServer</tag>
      
      <tag>C#</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
